import{_ as U}from"./AgentPageShell.vue.DS72lrn9.js";import{m as M,I as J,o as s,c as o,A as C,u as t,a as e,n as N,J as H,t as d,p as u,K as X,L as G,f as O,T as W,b as f,q as Y,w as B,X as Z,s as R,v as A,x as Q,k as L,y as ee,F as k,C as S}from"./entry.C3vEAWma.js";import{u as te}from"./useAgentEditorStore.q8CjWIk4.js";import{L as $}from"./link.KDvRW_f5.js";import{C as se}from"./chevron-down.DLd4eCDv.js";import{L as oe}from"./loader-2.C7JGwsi9.js";import{D as ie}from"./database.BwuKnyaf.js";import"./useAuth.aSDdTJTL.js";import"./usePermissions.kc3596Ar.js";import"./AuthModal.vue.TJWQo2PL.js";import"./eye.DZxrhfv6.js";import"./alert-circle.CL9BFDlJ.js";import"./check.CwYc9Emf.js";import"./useAgents.lyQ9pZ6U.js";import"./index.B9hQrX5B.js";const le={class:"flex items-center justify-between gap-4"},ne={class:"flex items-center gap-4"},ae={class:"flex items-center gap-2"},re={class:"font-bold text-slate-900"},de={class:"text-xs text-slate-500 mt-0.5"},ue={class:"flex items-center gap-3"},ce={key:2,class:"px-4 py-2 bg-slate-50 text-slate-400 rounded-xl text-xs font-bold border border-slate-100 cursor-default"},pe={key:0,class:"mt-6 pt-6 border-t border-indigo-100/50 space-y-4"},xe={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},me={key:0,class:"bg-white/50 rounded-xl p-3 border border-indigo-100/30"},be={class:"text-xs text-slate-700 mt-1 font-medium truncate"},ge={key:1,class:"bg-white/50 rounded-xl p-3 border border-indigo-100/30"},fe={class:"text-xs text-slate-700 mt-1 font-medium"},V=M({__name:"IntegrationCard",props:{title:{},description:{},status:{},icon:{default:()=>$},statusLabel:{},host:{},lastSync:{},error:{}},emits:["enable","disable"],setup(h){const c=h,{title:v,description:y,status:l,icon:b,statusLabel:p,host:x,lastSync:m,error:w}=J(c),_=G(()=>b.value||$);return(n,r)=>(s(),o("div",{class:C(["rounded-2xl border transition-all duration-300",[t(l)==="active"||t(l)==="error"?"border-indigo-100 bg-indigo-50/30 p-6 shadow-sm":"border-slate-100 bg-white p-5 hover:border-slate-200 shadow-sm"]])},[e("div",le,[e("div",ne,[e("div",{class:C(["w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0",[t(l)==="active"||t(l)==="error"?"bg-indigo-600 text-white shadow-md shadow-indigo-100":"bg-slate-50 text-slate-400 border border-slate-100",t(l)==="soon"?"opacity-50":""]])},[(s(),N(H(_.value),{class:"w-6 h-6"}))],2),e("div",null,[e("div",ae,[e("h4",re,d(t(v)),1),t(p)?(s(),o("span",{key:0,class:C(["text-[10px] font-bold uppercase tracking-widest px-2 py-0.5 rounded-full",[t(l)==="error"?"bg-red-50 text-red-600":t(l)==="active"?"bg-emerald-50 text-emerald-600":"bg-slate-100 text-slate-400"]])},d(t(p)),3)):u("",!0)]),e("p",de,d(t(y)),1)])]),e("div",ue,[t(l)==="inactive"?(s(),o("button",{key:0,onClick:r[0]||(r[0]=D=>n.$emit("enable")),class:"px-5 py-2 bg-indigo-600 text-white rounded-xl text-sm font-bold hover:bg-indigo-700 transition-all shadow-sm shadow-indigo-100"}," Подключить ")):t(l)==="active"||t(l)==="error"?(s(),o("button",{key:1,onClick:r[1]||(r[1]=D=>n.$emit("disable")),class:"px-5 py-2 bg-white border border-red-100 text-red-600 rounded-xl text-sm font-bold hover:bg-red-50 transition-all"}," Отключить ")):t(l)==="soon"?(s(),o("span",ce," В разработке ")):u("",!0)])]),(t(l)==="active"||t(l)==="error")&&(t(x)||t(m)||t(w))?(s(),o("div",pe,[e("div",xe,[t(x)?(s(),o("div",me,[r[2]||(r[2]=e("p",{class:"text-[10px] uppercase tracking-widest text-slate-400 font-bold"},"Host",-1)),e("p",be,d(t(x)),1)])):u("",!0),t(m)?(s(),o("div",ge,[r[3]||(r[3]=e("p",{class:"text-[10px] uppercase tracking-widest text-slate-400 font-bold"},"Синхронизация",-1)),e("p",fe,d(t(m)),1)])):u("",!0)]),X(n.$slots,"extra"),r[4]||(r[4]=e("p",{class:"text-[10px] text-slate-400 leading-relaxed italic"}," Безопасное соединение активно. Ключ хранится на сервере. Все запросы используют Bearer-авторизацию. ",-1))])):u("",!0)],2))}}),ve={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center px-4 py-6 sm:px-6","aria-modal":"true",role:"dialog"},ye={class:"flex items-center justify-between mb-6"},_e={key:0,class:"text-sm text-red-600"},he={class:"flex items-center justify-between gap-3"},we=["disabled"],ke={key:0},Se={key:1},$e=M({__name:"SQNSModal",props:{isOpen:{type:Boolean},isSubmitting:{type:Boolean}},emits:["close","submit"],setup(h,{emit:c}){const v=h,y=c,l=L(""),b=L(""),p=L(""),x=()=>{m(),y("close")},m=()=>{l.value="",b.value="",p.value=""},w=()=>{if(p.value="",!l.value.trim()){p.value="Введите email";return}if(!b.value.trim()){p.value="Введите пароль";return}y("submit",{email:l.value,password:b.value})};return O(()=>v.isOpen,_=>{_||m()}),(_,n)=>(s(),N(W,{to:"body"},[f(Y,{name:"modal-fade"},{default:B(()=>[h.isOpen?(s(),o("div",ve,[e("div",{class:"fixed inset-0 bg-black/40 backdrop-blur-sm",onClick:x}),e("div",{class:"relative w-full max-w-lg overflow-hidden rounded-2xl bg-white py-8 px-6 shadow-xl shadow-indigo-900/20 ring-1 ring-indigo-100",onClick:n[2]||(n[2]=R(()=>{},["stop"]))},[e("div",ye,[n[3]||(n[3]=e("div",null,[e("h2",{class:"text-lg font-bold text-slate-900"},"Включить SQNS"),e("p",{class:"text-sm text-slate-500 mt-1"},"Подключите CRM через защищённый ключ")],-1)),e("button",{"aria-label":"Закрыть",class:"text-slate-400 hover:text-slate-600",onClick:x},[f(t(Z),{class:"h-5 w-5"})])]),e("form",{onSubmit:R(w,["prevent"]),class:"space-y-5"},[e("div",null,[n[4]||(n[4]=e("label",{class:"text-sm font-medium text-slate-700"},"Email*",-1)),A(e("input",{"onUpdate:modelValue":n[0]||(n[0]=r=>l.value=r),type:"email",required:"",placeholder:"admin@clinic.com",class:"mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-900 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100"},null,512),[[Q,l.value,void 0,{trim:!0}]])]),e("div",null,[n[5]||(n[5]=e("label",{class:"text-sm font-medium text-slate-700"},"Пароль*",-1)),A(e("input",{"onUpdate:modelValue":n[1]||(n[1]=r=>b.value=r),type:"password",autocomplete:"new-password",required:"",placeholder:"••••••••",class:"mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-900 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100"},null,512),[[Q,b.value]]),n[6]||(n[6]=e("p",{class:"mt-1 text-xs text-slate-500"}," Учетные данные используются для получения токена доступа. ",-1))]),p.value?(s(),o("p",_e,d(p.value),1)):u("",!0),e("div",he,[e("button",{type:"button",class:"flex-1 rounded-xl border border-slate-200 px-4 py-3 text-sm font-medium text-slate-600 hover:bg-slate-100",onClick:x}," Отмена "),e("button",{type:"submit",class:"flex-1 rounded-xl bg-indigo-600 px-4 py-3 text-sm font-medium text-white shadow hover:bg-indigo-700 disabled:cursor-not-allowed disabled:opacity-60",disabled:v.isSubmitting},[v.isSubmitting?(s(),o("span",ke,"Сохраняем...")):(s(),o("span",Se,"Включить SQNS"))],8,we)])],32)])])):u("",!0)]),_:1})]))}}),qe={class:"bg-background rounded-md border border-border p-4 sm:p-5 space-y-5"},Ce={class:"space-y-5"},Le={key:0,class:"space-y-4 pt-4 border-t border-indigo-100/30"},Te={class:"space-y-3"},je={class:"grid gap-3"},Me={class:"flex items-center justify-between p-3 cursor-pointer hover:bg-indigo-50/30 transition-colors list-none"},Ne={class:"flex items-center gap-2"},De={class:"text-xs font-bold text-slate-700"},Fe={key:0,class:"flex gap-1"},Be={key:0,class:"text-[8px] text-slate-400"},Ee={class:"px-3 pb-3 space-y-2"},Ie={class:"text-xs text-slate-600 leading-normal"},Re={key:0,class:"flex flex-wrap gap-1.5 pt-1"},Ae={key:0,class:"flex flex-wrap gap-4 pt-2"},Qe={key:0,class:"space-y-2"},Ve={class:"flex flex-wrap gap-1.5"},He={key:1,class:"space-y-2"},Oe={class:"flex flex-wrap gap-1.5"},Pe={class:"mt-10 pt-10 border-t border-slate-100"},ze={key:0,class:"flex justify-center py-12"},Ke={key:1,class:"text-center py-12 bg-slate-50 rounded-lg border border-dashed border-slate-200"},Ue={key:2,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Je={class:"flex gap-4"},Xe={class:"w-10 h-10 bg-white border border-slate-100 rounded-md flex items-center justify-center"},Ge={class:"font-bold text-slate-900 text-sm"},We={class:"text-xs text-slate-500 mt-1 line-clamp-2"},Ye=["onClick"],Ze=M({__name:"AgentConnectionsPanel",setup(h){const c=te(),{agent:v,availableTools:y,boundTools:l,isLoadingTools:b,sqnsStatus:p,sqnsResources:x,sqnsServices:m,sqnsToolsList:w,isSqnsEnabled:_,sqnsStatusLabel:n,sqnsHostLabel:r,formattedSqnsSyncAt:D,sqnsErrorMessage:P}=ee(c),T=L(!1),F=L(!1);O(v,async j=>{j&&(await c.ensureSqnsStatusLoaded(),await c.ensureSqnsHints(),await c.ensureToolsLoaded())},{immediate:!0});const z=async j=>{F.value=!0;try{await c.enableSqnsIntegration(j)&&(await c.ensureSqnsHints(),T.value=!1)}finally{F.value=!1}},K=async()=>{await c.disableSqnsIntegration()};return(j,a)=>{var E;return s(),o("div",qe,[a[8]||(a[8]=e("div",{class:"mb-6"},[e("h3",{class:"text-lg font-bold text-slate-900"},"Инструменты и подключения"),e("p",{class:"text-sm text-slate-500 mt-1"}," Подключите внешние инструменты и API для расширения возможностей вашего агента. Мы поддерживаем различные CRM-системы и сервисы. ")],-1)),e("div",Ce,[f(V,{title:"SQNS",description:"Интеграция с CRM для управления визитами и бронированием.",status:t(_)?((E=t(p))==null?void 0:E.sqnsStatus)==="error"?"error":"active":"inactive","status-label":t(n),host:t(r),"last-sync":t(D),error:t(P),icon:t($),onEnable:a[0]||(a[0]=i=>T.value=!0),onDisable:K},{extra:B(()=>[t(_)&&t(w).length?(s(),o("div",Le,[e("div",Te,[a[3]||(a[3]=e("div",{class:"flex items-center justify-between"},[e("p",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"Доступные инструменты SQNS")],-1)),e("div",je,[(s(!0),o(k,null,S(t(w),i=>{var g,I;return s(),o("details",{key:i.name,class:"group rounded-md border border-indigo-100/30 bg-white/50 overflow-hidden"},[e("summary",Me,[e("div",Ne,[e("p",De,d(i.displayName),1),(g=i.requiredFields)!=null&&g.length?(s(),o("div",Fe,[(s(!0),o(k,null,S(i.requiredFields.slice(0,2),q=>(s(),o("span",{key:q,class:"rounded-full bg-indigo-50 px-1.5 py-0.5 text-[8px] text-indigo-600 font-medium"},d(q),1))),128)),i.requiredFields.length>2?(s(),o("span",Be,"...")):u("",!0)])):u("",!0)]),f(t(se),{class:"w-3.5 h-3.5 text-slate-400 group-open:rotate-180 transition-transform"})]),e("div",Ee,[e("p",Ie,d(i.description),1),(I=i.requiredFields)!=null&&I.length?(s(),o("div",Re,[a[2]||(a[2]=e("p",{class:"text-[9px] text-slate-400 w-full font-medium uppercase tracking-wider"},"Обязательные поля:",-1)),(s(!0),o(k,null,S(i.requiredFields,q=>(s(),o("span",{key:q,class:"rounded-full border border-indigo-100/50 bg-indigo-50/50 px-2 py-0.5 text-[9px] text-indigo-600 font-medium"},d(q),1))),128))])):u("",!0)])])}),128))])]),t(x).length||t(m).length?(s(),o("div",Ae,[t(x).length?(s(),o("div",Qe,[a[4]||(a[4]=e("div",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"Ресурсы",-1)),e("div",Ve,[(s(!0),o(k,null,S(t(x),i=>(s(),o("span",{key:i.id,class:"rounded-full border border-indigo-100/50 bg-indigo-50/50 px-2 py-0.5 text-[9px] text-indigo-700 font-medium"},d(i.name),1))),128))])])):u("",!0),t(m).length?(s(),o("div",He,[a[5]||(a[5]=e("div",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"Услуги",-1)),e("div",Oe,[(s(!0),o(k,null,S(t(m),i=>(s(),o("span",{key:i.id,class:"rounded-full border border-emerald-100/50 bg-emerald-50/50 px-2 py-0.5 text-[9px] text-emerald-700 font-medium"},d(i.name),1))),128))])])):u("",!0)])):u("",!0)])):u("",!0)]),_:1},8,["status","status-label","host","last-sync","error","icon"]),f(V,{title:"Klientiks CRM",description:"Эффективный инструмент для управления медицинской клиникой и медицинскими работниками.",status:"soon","status-label":"скоро",icon:t($)},null,8,["icon"])]),e("div",Pe,[a[7]||(a[7]=e("div",{class:"mb-6"},[e("h3",{class:"text-lg font-bold text-slate-900"},"Пользовательские инструменты"),e("p",{class:"text-sm text-slate-500 mt-1"},"Подключите вебхуки или другие API инструменты.")],-1)),t(b)?(s(),o("div",ze,[f(t(oe),{class:"w-8 h-8 animate-spin text-indigo-600"})])):t(y).length===0?(s(),o("div",Ke,[f(t($),{class:"w-12 h-12 text-slate-300 mx-auto mb-4"}),a[6]||(a[6]=e("p",{class:"text-slate-500"},'Нет доступных инструментов. Создайте их в разделе "Инструменты".',-1))])):(s(),o("div",Ue,[(s(!0),o(k,null,S(t(y),i=>(s(),o("div",{key:i.id,class:C(["p-5 border rounded-lg transition-all flex items-start justify-between group",[t(l).some(g=>g.tool_id===i.id)?"border-indigo-100 bg-indigo-50/30":"border-slate-100 bg-white hover:border-slate-200"]])},[e("div",Je,[e("div",Xe,[(s(),N(H(i.execution_type==="http_webhook"?t($):t(ie)),{class:"w-5 h-5 text-slate-600"}))]),e("div",null,[e("h4",Ge,d(i.name),1),e("p",We,d(i.description||"Нет описания"),1)])]),e("button",{onClick:g=>t(c).toggleTool(i),class:C(["px-3 py-1.5 rounded-lg text-xs font-bold transition-all",[t(l).some(g=>g.tool_id===i.id)?"bg-indigo-600 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"]])},d(t(l).some(g=>g.tool_id===i.id)?"Подключено":"Подключить"),11,Ye)],2))),128))]))]),f($e,{"is-open":T.value,"is-submitting":F.value,onClose:a[1]||(a[1]=i=>T.value=!1),onSubmit:z},null,8,["is-open","is-submitting"])])}}}),bt=M({__name:"connections",setup(h){return(c,v)=>(s(),N(U,{title:"Подключения","hide-actions":!0},{default:B(()=>[f(Ze)]),_:1}))}});export{bt as default};
