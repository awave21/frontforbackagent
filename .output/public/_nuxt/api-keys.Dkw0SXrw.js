import{M as T,_ as U,K as I}from"./DashboardSidebar.vue.CApj98zs.js";import{_ as B}from"./AuthModal.vue.BC9qfAFg.js";import{bd as k,k as x,m as z,B as K,f as N,c as a,a as e,b as m,u as i,p,w as q,q as O,d as A,s as R,v as C,x as j,F as P,C as $,n as X,t as v,o,X as G,bL as H,A as J}from"./entry.O09EqozO.js";import{a as S,u as Q}from"./useAuth.neUI44RN.js";import{A as W}from"./alert-circle.Du6JAHUu.js";import{P as Y}from"./plus.O__j7ujZ.js";import{L as Z}from"./loader-2.Co8TrG4J.js";import"./nuxt-link.Br_LdvxN.js";import"./index.D3uoxhKM.js";import"./chevron-right.Dlh3V1cy.js";import"./link.DmRsociT.js";import"./database.DRXp7gyz.js";import"./cpu.CR1fSKWh.js";import"./message-square.DFkAKvgI.js";import"./settings.C9le7tdi.js";import"./eye.CLKq6yp0.js";const ee=()=>{S();const w=Q(),n=x(!1),d=x(null),r=x([]),b=async u=>{try{n.value=!0,d.value=null;const l=new URLSearchParams;u!=null&&u.include_revoked&&l.append("include_revoked","true");const _=await w("/api-keys",{query:Object.fromEntries(l)});return r.value=_,_}catch(l){throw d.value=l.message||"Ошибка загрузки API-ключей",l}finally{n.value=!1}},f=async u=>{try{n.value=!0,d.value=null;const l=await w("/api-keys",{method:"POST",headers:{"Content-Type":"application/json"},body:u});return r.value.unshift(l),l}catch(l){throw d.value=l.message||"Ошибка создания API-ключа",l}finally{n.value=!1}},h=async u=>{try{n.value=!0,d.value=null,await w(`/api-keys/${u}`,{method:"DELETE"}),r.value=r.value.filter(l=>l.id!==u)}catch(l){throw d.value=l.message||"Ошибка удаления API-ключа",l}finally{n.value=!1}};return{apiKeys:k(r),isLoading:k(n),error:k(d),fetchApiKeys:b,createApiKey:f,revokeApiKey:h}},te={class:"min-h-screen bg-slate-50"},se={class:"lg:hidden bg-white border-b border-slate-200 px-4 py-3"},le={class:"flex items-center justify-between"},oe={class:"flex"},ae={key:0,class:"lg:hidden fixed inset-0 z-50 w-full"},ne={class:"flex-1 bg-slate-50 p-4 sm:p-6 lg:p-10"},ie={class:"max-w-4xl mx-auto"},re={key:0,class:"mb-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4"},de={class:"flex items-center justify-between"},ue={class:"flex items-center"},ce={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 lg:mb-8"},me={key:1,class:"bg-white rounded-xl border border-slate-200 p-6 mb-8"},pe={class:"flex items-center justify-between mb-6"},ve={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},xe={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},be=["value"],fe={class:"ml-2 text-sm text-slate-700"},ge={class:"flex gap-3"},ye=["disabled"],we={key:2,class:"flex justify-center py-12"},he={key:3,class:"text-center py-12"},_e={key:4,class:"space-y-4"},ke={class:"flex items-start justify-between"},Ae={class:"flex-1"},Ce={class:"flex items-center gap-3 mb-2"},Pe={class:"text-lg font-semibold text-slate-900"},$e={class:"mb-3"},Le={class:"text-xs bg-slate-100 px-2 py-1 rounded font-mono break-all"},Ie={class:"mb-3"},je={class:"flex flex-wrap gap-1"},Se={class:"text-xs text-slate-500"},Me={key:0},Fe={class:"flex flex-col gap-2 ml-4"},Ve=["onClick"],We=z({__name:"api-keys",setup(w){const n=x(!1),d=x(!1),r=x(!1),b=x(!1),{isAuthenticated:f}=S(),{apiKeys:h,fetchApiKeys:u,createApiKey:l,revokeApiKey:_,isLoading:M}=ee(),c=x({name:"",scopes:[],expires_in_days:365}),F=[{value:"agents:read",label:"Чтение агентов"},{value:"agents:write",label:"Создание агентов"},{value:"tools:read",label:"Чтение инструментов"},{value:"tools:write",label:"Создание инструментов"},{value:"runs:read",label:"Чтение запусков"},{value:"runs:write",label:"Запуск агентов"}];K(async()=>{if(f.value)try{await u()}catch(g){console.error("Failed to load API keys:",g)}}),N(f,async g=>{g&&await u()});const V=async()=>{try{b.value=!0,await l({name:c.value.name||void 0,scopes:c.value.scopes,expires_in_days:c.value.expires_in_days}),c.value={name:"",scopes:[],expires_in_days:365},r.value=!1}catch(g){console.error("Error creating API key:",g)}finally{b.value=!1}},D=()=>{d.value=!1};return(g,t)=>{const L=U,E=B;return o(),a("div",te,[e("div",se,[e("div",le,[t[12]||(t[12]=e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center"},[e("span",{class:"text-white font-bold text-xs"},"М")]),e("span",{class:"text-slate-900 font-bold"},"МедиАИ")],-1)),e("button",{onClick:t[0]||(t[0]=s=>n.value=!n.value),class:"p-2 rounded-lg text-slate-600 hover:bg-slate-100"},[m(i(T),{class:"h-5 w-5"})])])]),e("div",oe,[m(L,{class:"hidden lg:block"}),n.value?(o(),a("div",{key:0,class:"lg:hidden fixed inset-0 z-40 bg-black bg-opacity-50",onClick:t[1]||(t[1]=s=>n.value=!1)})):p("",!0),m(O,{"enter-active-class":"transition-all duration-500 cubic-bezier(0.34, 1.56, 0.64, 1)","enter-from-class":"-translate-x-full opacity-0 scale-95","enter-to-class":"translate-x-0 opacity-100 scale-100","leave-active-class":"transition-all duration-400 ease-in","leave-from-class":"translate-x-0 opacity-100 scale-100","leave-to-class":"-translate-x-full opacity-0 scale-95"},{default:q(()=>[n.value?(o(),a("div",ae,[m(L,{onClose:t[2]||(t[2]=s=>n.value=!1)})])):p("",!0)]),_:1}),e("main",ne,[e("div",ie,[i(f)?p("",!0):(o(),a("div",re,[e("div",de,[e("div",ue,[m(i(W),{class:"h-5 w-5 text-yellow-400 mr-3"}),t[13]||(t[13]=e("div",null,[e("h3",{class:"text-sm font-medium text-yellow-800"}," Требуется аутентификация "),e("p",{class:"text-sm text-yellow-700 mt-1"}," Войдите в систему для управления API-ключами ")],-1))]),e("button",{onClick:t[3]||(t[3]=s=>d.value=!0),class:"px-4 py-2 bg-yellow-600 text-white text-sm font-medium rounded-lg hover:bg-yellow-700 transition-colors"}," Войти ")])])),e("div",ce,[t[15]||(t[15]=e("div",{class:"mb-4 sm:mb-0"},[e("h1",{class:"text-2xl sm:text-3xl font-bold text-slate-900"}," API Ключи "),e("p",{class:"text-slate-600 mt-1 sm:mt-2 text-sm sm:text-base"}," Управление вашими API-ключами для доступа к системе ")],-1)),i(f)&&!r.value?(o(),a("button",{key:0,onClick:t[4]||(t[4]=s=>r.value=!0),class:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors"},[m(i(Y),{class:"h-4 w-4"}),t[14]||(t[14]=A(" Создать ключ ",-1))])):p("",!0)]),r.value?(o(),a("div",me,[e("div",pe,[t[16]||(t[16]=e("h2",{class:"text-xl font-bold text-slate-900"},"Создать новый API ключ",-1)),e("button",{onClick:t[5]||(t[5]=s=>r.value=!1),class:"p-2 text-slate-400 hover:text-slate-600 transition-colors"},[m(i(G),{class:"h-5 w-5"})])]),e("form",{onSubmit:R(V,["prevent"]),class:"space-y-6"},[e("div",ve,[e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-slate-700 mb-2"}," Название ключа (опционально) ",-1)),C(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>c.value.name=s),type:"text",class:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Например: Ключ для разработки"},null,512),[[j,c.value.name]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-slate-700 mb-2"}," Срок действия (дни) ",-1)),C(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>c.value.expires_in_days=s),type:"number",min:"1",max:"365",class:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"365"},null,512),[[j,c.value.expires_in_days,void 0,{number:!0}]])])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-slate-700 mb-3"}," Разрешения (scopes) ",-1)),e("div",xe,[(o(),a(P,null,$(F,s=>e("label",{key:s.value,class:"flex items-center"},[C(e("input",{"onUpdate:modelValue":t[8]||(t[8]=y=>c.value.scopes=y),value:s.value,type:"checkbox",class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-slate-300 rounded"},null,8,be),[[H,c.value.scopes]]),e("span",fe,v(s.label),1)])),64))])]),e("div",ge,[e("button",{type:"button",onClick:t[9]||(t[9]=s=>r.value=!1),class:"flex-1 px-4 py-2 text-slate-700 bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors"}," Отмена "),e("button",{type:"submit",disabled:b.value,class:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"},[b.value?(o(),X(i(Z),{key:0,class:"h-4 w-4 animate-spin"})):p("",!0),A(" "+v(b.value?"Создание...":"Создать ключ"),1)],8,ye)])],32)])):p("",!0),i(M)?(o(),a("div",we,[...t[20]||(t[20]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"},null,-1)])])):i(h).length===0?(o(),a("div",he,[m(i(I),{class:"h-12 w-12 text-slate-400 mx-auto mb-4"}),t[21]||(t[21]=e("h3",{class:"text-lg font-medium text-slate-900 mb-2"},"Нет API ключей",-1)),t[22]||(t[22]=e("p",{class:"text-slate-600 mb-4"},"Создайте свой первый API ключ для доступа к системе",-1)),i(f)?(o(),a("button",{key:0,onClick:t[10]||(t[10]=s=>r.value=!0),class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"}," Создать ключ ")):p("",!0)])):(o(),a("div",_e,[(o(!0),a(P,null,$(i(h),s=>(o(),a("div",{key:s.id,class:"bg-white rounded-xl border border-slate-200 p-6"},[e("div",ke,[e("div",Ae,[e("div",Ce,[m(i(I),{class:"h-5 w-5 text-slate-600"}),e("h3",Pe,v(s.name||`Ключ ${s.id.slice(-8)}`),1),e("span",{class:J(["px-2 py-1 text-xs font-medium rounded-full",s.revoked_at?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},v(s.revoked_at?"Отозван":"Активен"),3)]),e("div",$e,[t[23]||(t[23]=e("p",{class:"text-sm text-slate-600 mb-1"},"API Ключ:",-1)),e("code",Le,v(s.key),1)]),e("div",Ie,[t[24]||(t[24]=e("p",{class:"text-sm text-slate-600 mb-2"},"Разрешения:",-1)),e("div",je,[(o(!0),a(P,null,$(s.scopes,y=>(o(),a("span",{key:y,class:"px-2 py-1 bg-slate-100 text-slate-700 text-xs rounded-full"},v(y),1))),128))])]),e("div",Se,[A(" Создан: "+v(new Date(s.created_at).toLocaleString("ru-RU"))+" ",1),s.expires_at?(o(),a("span",Me," • Истекает: "+v(new Date(s.expires_at).toLocaleString("ru-RU")),1)):p("",!0)])]),e("div",Fe,[s.revoked_at?p("",!0):(o(),a("button",{key:0,onClick:y=>i(_)(s.id),class:"px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors text-sm"}," Отозвать ",8,Ve))])])]))),128))]))])])]),m(E,{"is-open":d.value,onClose:t[11]||(t[11]=s=>d.value=!1),onAuthenticated:D},null,8,["is-open"])])}}});export{We as default};
