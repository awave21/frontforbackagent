import{_ as H}from"./AgentPageShell.vue.Bd250u5J.js";import{m as L,I as Q,o,c as n,A as $,u as e,a as t,n as T,J as N,t as p,p as v,K as F,L as O,f as A,T as P,b as g,q as z,w as M,X as K,s as B,v as D,x as E,k as C,y as U,F as J,C as X}from"./entry.BA9w_SP9.js";import{u as G}from"./useAgentEditorStore.bKkyPdW3.js";import{L as w}from"./link.Do8E_aLf.js";import{L as W}from"./loader-2.aQU5n6yP.js";import{D as Y}from"./database.CszPfu5e.js";import"./useAuth.BL67409K.js";import"./usePermissions.Be4uXYcE.js";import"./AuthModal.vue.CuY5Yc90.js";import"./eye.JnJgym4e.js";import"./alert-circle.D8R5WmeZ.js";import"./check.Ci-hEIGR.js";import"./useAgents.D5E_YnIF.js";import"./index.CUi6o2uQ.js";const Z={class:"flex items-center justify-between gap-4"},tt={class:"flex items-center gap-4"},et={class:"flex items-center gap-2"},st={class:"font-bold text-slate-900"},ot={class:"text-xs text-slate-500 mt-0.5"},it={class:"flex items-center gap-3"},at={key:2,class:"px-4 py-1.5 bg-slate-50 text-slate-400 rounded-md text-xs font-medium border border-border cursor-default"},nt={key:0,class:"mt-6 pt-6 border-t border-indigo-100/50 space-y-4"},rt={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},lt={key:0,class:"bg-white/50 rounded-md p-3 border border-indigo-100/30"},dt={class:"text-xs text-slate-700 mt-1 font-medium truncate"},ut={key:1,class:"bg-white/50 rounded-md p-3 border border-indigo-100/30"},ct={class:"text-xs text-slate-700 mt-1 font-medium"},I=L({__name:"IntegrationCard",props:{title:{},description:{},status:{},icon:{default:()=>w},statusLabel:{},host:{},lastSync:{},error:{}},emits:["enable","disable"],setup(y){const r=y,{title:b,description:f,status:s,icon:c,statusLabel:d,host:m,lastSync:x,error:k}=Q(r),_=O(()=>c.value||w);return(i,a)=>(o(),n("div",{class:$(["rounded-md border transition-all duration-300",[e(s)==="active"||e(s)==="error"?"border-indigo-100 bg-indigo-50/30 p-6":"border-border bg-background p-5 hover:border-slate-200"]])},[t("div",Z,[t("div",tt,[t("div",{class:$(["w-10 h-10 rounded-md flex items-center justify-center flex-shrink-0",[e(s)==="active"||e(s)==="error"?"bg-indigo-600 text-white":"bg-slate-50 text-slate-400 border border-border",e(s)==="soon"?"opacity-50":""]])},[(o(),T(N(_.value),{class:"w-6 h-6"}))],2),t("div",null,[t("div",et,[t("h4",st,p(e(b)),1),e(d)?(o(),n("span",{key:0,class:$(["text-[10px] font-bold uppercase tracking-widest px-2 py-0.5 rounded-full",[e(s)==="error"?"bg-red-50 text-red-600":e(s)==="active"?"bg-emerald-50 text-emerald-600":"bg-slate-100 text-slate-400"]])},p(e(d)),3)):v("",!0)]),t("p",ot,p(e(f)),1)])]),t("div",it,[e(s)==="inactive"?(o(),n("button",{key:0,onClick:a[0]||(a[0]=S=>i.$emit("enable")),class:"px-4 py-1.5 bg-indigo-600 text-white rounded-md text-sm font-medium hover:bg-indigo-700 transition-all"}," Подключить ")):e(s)==="active"||e(s)==="error"?(o(),n("button",{key:1,onClick:a[1]||(a[1]=S=>i.$emit("disable")),class:"px-4 py-1.5 bg-white border border-red-200 text-red-600 rounded-md text-sm font-medium hover:bg-red-50 transition-all"}," Отключить ")):e(s)==="soon"?(o(),n("span",at," В разработке ")):v("",!0)])]),(e(s)==="active"||e(s)==="error")&&(e(m)||e(x)||e(k))?(o(),n("div",nt,[t("div",rt,[e(m)?(o(),n("div",lt,[a[2]||(a[2]=t("p",{class:"text-[10px] uppercase tracking-widest text-slate-400 font-bold"},"Host",-1)),t("p",dt,p(e(m)),1)])):v("",!0),e(x)?(o(),n("div",ut,[a[3]||(a[3]=t("p",{class:"text-[10px] uppercase tracking-widest text-slate-400 font-bold"},"Синхронизация",-1)),t("p",ct,p(e(x)),1)])):v("",!0)]),F(i.$slots,"extra"),a[4]||(a[4]=t("p",{class:"text-[10px] text-slate-400 leading-relaxed italic"}," Безопасное соединение активно. Ключ хранится на сервере. Все запросы используют Bearer-авторизацию. ",-1))])):v("",!0)],2))}}),mt={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center px-4 py-6 sm:px-6","aria-modal":"true",role:"dialog"},pt={class:"flex items-center justify-between mb-6"},bt={key:0,class:"text-sm text-red-600"},xt={class:"flex items-center justify-between gap-3"},gt=["disabled"],ft={key:0},vt={key:1},yt=L({__name:"SQNSModal",props:{isOpen:{type:Boolean},isSubmitting:{type:Boolean}},emits:["close","submit"],setup(y,{emit:r}){const b=y,f=r,s=C(""),c=C(""),d=C(""),m=()=>{x(),f("close")},x=()=>{s.value="",c.value="",d.value=""},k=()=>{if(d.value="",!s.value.trim()){d.value="Введите email";return}if(!c.value.trim()){d.value="Введите пароль";return}f("submit",{email:s.value,password:c.value})};return A(()=>b.isOpen,_=>{_||x()}),(_,i)=>(o(),T(P,{to:"body"},[g(z,{name:"modal-fade"},{default:M(()=>[y.isOpen?(o(),n("div",mt,[t("div",{class:"fixed inset-0 bg-black/40 backdrop-blur-sm",onClick:m}),t("div",{class:"relative w-full max-w-lg overflow-hidden rounded-2xl bg-white py-8 px-6 shadow-xl shadow-indigo-900/20 ring-1 ring-indigo-100",onClick:i[2]||(i[2]=B(()=>{},["stop"]))},[t("div",pt,[i[3]||(i[3]=t("div",null,[t("h2",{class:"text-lg font-bold text-slate-900"},"Включить SQNS"),t("p",{class:"text-sm text-slate-500 mt-1"},"Подключите CRM через защищённый ключ")],-1)),t("button",{"aria-label":"Закрыть",class:"text-slate-400 hover:text-slate-600",onClick:m},[g(e(K),{class:"h-5 w-5"})])]),t("form",{onSubmit:B(k,["prevent"]),class:"space-y-5"},[t("div",null,[i[4]||(i[4]=t("label",{class:"text-sm font-medium text-slate-700"},"Email*",-1)),D(t("input",{"onUpdate:modelValue":i[0]||(i[0]=a=>s.value=a),type:"email",required:"",placeholder:"admin@clinic.com",class:"mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-900 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100"},null,512),[[E,s.value,void 0,{trim:!0}]])]),t("div",null,[i[5]||(i[5]=t("label",{class:"text-sm font-medium text-slate-700"},"Пароль*",-1)),D(t("input",{"onUpdate:modelValue":i[1]||(i[1]=a=>c.value=a),type:"password",autocomplete:"new-password",required:"",placeholder:"••••••••",class:"mt-1 w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-900 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100"},null,512),[[E,c.value]]),i[6]||(i[6]=t("p",{class:"mt-1 text-xs text-slate-500"}," Учетные данные используются для получения токена доступа. ",-1))]),d.value?(o(),n("p",bt,p(d.value),1)):v("",!0),t("div",xt,[t("button",{type:"button",class:"flex-1 rounded-xl border border-slate-200 px-4 py-3 text-sm font-medium text-slate-600 hover:bg-slate-100",onClick:m}," Отмена "),t("button",{type:"submit",class:"flex-1 rounded-xl bg-indigo-600 px-4 py-3 text-sm font-medium text-white shadow hover:bg-indigo-700 disabled:cursor-not-allowed disabled:opacity-60",disabled:b.isSubmitting},[b.isSubmitting?(o(),n("span",ft,"Сохраняем...")):(o(),n("span",vt,"Включить SQNS"))],8,gt)])],32)])])):v("",!0)]),_:1})]))}}),_t={class:"bg-background rounded-md border border-border p-4 sm:p-5 space-y-5"},ht={class:"space-y-5"},wt={class:"mt-10 pt-10 border-t border-slate-100"},kt={key:0,class:"flex justify-center py-12"},St={key:1,class:"text-center py-12 bg-slate-50 rounded-md border border-dashed border-border"},$t={key:2,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ct={class:"flex gap-4"},qt={class:"w-9 h-9 bg-background border border-border rounded-md flex items-center justify-center"},Lt={class:"font-bold text-slate-900 text-sm"},Tt={class:"text-xs text-slate-500 mt-1 line-clamp-2"},Mt=["onClick"],jt=L({__name:"AgentConnectionsPanel",setup(y){const r=G(),{agent:b,availableTools:f,boundTools:s,isLoadingTools:c,sqnsStatus:d,isSqnsEnabled:m,sqnsStatusLabel:x,sqnsHostLabel:k,formattedSqnsSyncAt:_,sqnsErrorMessage:i}=U(r),a=C(!1),S=C(!1);A(b,async q=>{q&&(await r.ensureSqnsStatusLoaded(),await r.ensureSqnsHints(),await r.ensureToolsLoaded())},{immediate:!0});const R=async q=>{S.value=!0;try{await r.enableSqnsIntegration(q)&&(await r.ensureSqnsHints(),a.value=!1)}finally{S.value=!1}},V=async()=>{await r.disableSqnsIntegration()};return(q,l)=>{var j;return o(),n("div",_t,[l[5]||(l[5]=t("div",{class:"mb-6"},[t("h3",{class:"text-lg font-bold text-slate-900"},"Инструменты и подключения"),t("p",{class:"text-sm text-slate-500 mt-1"}," Подключите внешние инструменты и API для расширения возможностей вашего агента. Мы поддерживаем различные CRM-системы и сервисы. ")],-1)),t("div",ht,[g(I,{title:"SQNS",description:"Интеграция с CRM для управления визитами и бронированием.",status:e(m)?((j=e(d))==null?void 0:j.sqnsStatus)==="error"?"error":"active":"inactive","status-label":e(x),host:e(k),"last-sync":e(_),error:e(i),icon:e(w),onEnable:l[0]||(l[0]=u=>a.value=!0),onDisable:V},{extra:M(()=>[...l[2]||(l[2]=[])]),_:1},8,["status","status-label","host","last-sync","error","icon"]),g(I,{title:"Klientiks CRM",description:"Эффективный инструмент для управления медицинской клиникой и медицинскими работниками.",status:"soon","status-label":"скоро",icon:e(w)},null,8,["icon"])]),t("div",wt,[l[4]||(l[4]=t("div",{class:"mb-6"},[t("h3",{class:"text-lg font-bold text-slate-900"},"Пользовательские инструменты"),t("p",{class:"text-sm text-slate-500 mt-1"},"Подключите вебхуки или другие API инструменты.")],-1)),e(c)?(o(),n("div",kt,[g(e(W),{class:"w-8 h-8 animate-spin text-indigo-600"})])):e(f).length===0?(o(),n("div",St,[g(e(w),{class:"w-12 h-12 text-slate-300 mx-auto mb-4"}),l[3]||(l[3]=t("p",{class:"text-slate-500"},'Нет доступных инструментов. Создайте их в разделе "Инструменты".',-1))])):(o(),n("div",$t,[(o(!0),n(J,null,X(e(f),u=>(o(),n("div",{key:u.id,class:$(["p-4 border rounded-md transition-all flex items-start justify-between group",[e(s).some(h=>h.tool_id===u.id)?"border-indigo-100 bg-indigo-50/30":"border-slate-100 bg-white hover:border-slate-200"]])},[t("div",Ct,[t("div",qt,[(o(),T(N(u.execution_type==="http_webhook"?e(w):e(Y)),{class:"w-5 h-5 text-slate-600"}))]),t("div",null,[t("h4",Lt,p(u.name),1),t("p",Tt,p(u.description||"Нет описания"),1)])]),t("button",{onClick:h=>e(r).toggleTool(u),class:$(["px-3 py-1.5 rounded-md text-xs font-medium transition-all",[e(s).some(h=>h.tool_id===u.id)?"bg-indigo-600 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"]])},p(e(s).some(h=>h.tool_id===u.id)?"Подключено":"Подключить"),11,Mt)],2))),128))]))]),g(yt,{"is-open":a.value,"is-submitting":S.value,onClose:l[1]||(l[1]=u=>a.value=!1),onSubmit:R},null,8,["is-open","is-submitting"])])}}}),Kt=L({__name:"connections",setup(y){return(r,b)=>(o(),T(H,{title:"Интеграции","hide-actions":!0},{default:M(()=>[g(jt)]),_:1}))}});export{Kt as default};
