import{u as Qe}from"./useLayoutState.sNd_KhK0.js";import{M as Se,k as E,bg as be,bf as Ze,f as Q,b6 as Pe,u as O,L as W,m as ae,o as m,c as D,s as Te,a as i,A as G,n as J,t as q,p as H,d as me,b as B,T as De,w as re,a_ as ze,q as ve,v as Ee,x as je,E as et,H as pe,N as tt,_ as Ce,a5 as Fe,F as ce,C as Ie,J as st,B as qe,D as nt,X as at,P as ot,b$ as lt}from"./entry.B2IFVgKF.js";import{u as it}from"./useAgents.CrbTyjJz.js";import{u as He,g as X}from"./useApiFetch.DTQFO30A.js";import{u as rt}from"./useAuth.Vyp_2ZYp.js";import{g as Ve}from"./authSessionManager.DTJsKR5D.js";import{o as Ge}from"./index.Dj-Vg5LV.js";import{M as ke}from"./message-square.YxiZE0Ei.js";import{M as ct}from"./more-vertical.CWsz16qA.js";import{P as ut}from"./pencil.BP5iUfqE.js";import{T as dt}from"./trash-2.CqUirFt0.js";import{C as gt}from"./chevron-down.mmveU6r2.js";import{C as Je}from"./check.DLWzRKND.js";import{S as ft}from"./search.CsYQl3Fm.js";import{L as Me}from"./loader-2.gphf9FK_.js";import{A as mt}from"./arrow-left.D4qTmew4.js";import{c as vt}from"./safe-markdown._KYjoumJ.js";import{P as pt}from"./play._HLX4evb.js";import{A as Ke}from"./alert-circle.CK50UZ1-.js";import{P as xt}from"./plus.C5FiPnXx.js";import{M as yt}from"./message-circle.CIokyO3i.js";import{U as ht}from"./user-check.CcLpkwPA.js";import{S as bt}from"./send.BgsELO1x.js";import{_ as _t}from"./AuthModal.vue.S1p1aqV_.js";import"./index.CXSSBYp8.js";import"./eye.09w4ag_w.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=Se("ArrowDownIcon",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=Se("ImageIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=Se("MicIcon",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=Se("PauseCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=Se("PauseIcon",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),We=new Set(["active","paused"]),$e=e=>{const s=e.status&&We.has(e.status)?e.status:e.agent_status??"active";return{...e,agent_status:s,status:We.has(e.status)?"NORMAL":e.status||"NORMAL"}},j=E([]),_e=E(!1),ne=E(null),Re=E(null),xe=()=>{const e=He();return{dialogs:j,isLoading:_e,error:ne,currentAgentId:Re,fetchDialogs:async(l,a)=>{if(!l){console.warn("[useDialogs] fetchDialogs called without agentId");return}_e.value=!0,ne.value=null,Re.value=l;try{const r=new URLSearchParams;(a==null?void 0:a.archived)!==void 0&&r.set("archived",String(a.archived));const d=r.toString(),U=`agents/${l}/dialogs${d?`?${d}`:""}`,I=await e(U);let M=[];Array.isArray(I)?M=I:I&&typeof I=="object"&&"dialogs"in I?M=I.dialogs||[]:I&&typeof I=="object"&&"items"in I&&(M=I.items||[]),j.value=M.map($e)}catch(r){console.error("[useDialogs] Error fetching dialogs:",r),console.error("[useDialogs] Error details:",{status:(r==null?void 0:r.statusCode)||(r==null?void 0:r.status),data:r==null?void 0:r.data,message:r==null?void 0:r.message}),ne.value=X(r,"Не удалось загрузить диалоги"),j.value=[]}finally{_e.value=!1}},createDialog:async(l,a)=>{if(!l)return null;_e.value=!0,ne.value=null;try{const r=await e(`agents/${l}/dialogs`,{method:"POST",headers:{"Content-Type":"application/json"},body:a||{}}),d=$e(r);return j.value=[d,...j.value],d}catch(r){return ne.value=X(r,"Не удалось создать диалог"),null}finally{_e.value=!1}},updateDialog:async(l,a,r)=>{if(!l||!a)return null;try{const d=await e(`agents/${l}/dialogs/${encodeURIComponent(a)}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:r}),U=$e(d),I=j.value.findIndex(M=>M.id===a);return I!==-1&&(j.value[I]=U),U}catch(d){return ne.value=X(d,"Не удалось обновить диалог"),null}},deleteDialog:async(l,a)=>{if(!l||!a)return!1;try{return await e(`agents/${l}/dialogs/${encodeURIComponent(a)}`,{method:"DELETE"}),j.value=j.value.filter(r=>r.id!==a),!0}catch(r){return ne.value=X(r,"Не удалось удалить диалог"),!1}},toggleDialogAgentStatus:async(l,a)=>{if(!l||!a)return null;const r=j.value.findIndex(I=>I.id===a),d=r!==-1?j.value[r].agent_status??"active":"active",U=d==="active"?"paused":"active";r!==-1&&(j.value[r]={...j.value[r],agent_status:U});try{return await e(`agents/${l}/dialogs/${encodeURIComponent(a)}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:{status:U}}),U}catch(I){return r!==-1&&(j.value[r]={...j.value[r],agent_status:d}),ne.value=X(I,"Не удалось изменить статус агента"),console.error("[useDialogs] toggleDialogAgentStatus error:",I),null}},upsertDialog:l=>{const a=l.id||l.session_id;if(!a)return;const r=j.value.findIndex(x=>x.id===a),d=r!==-1?j.value[r]:null,U=l.user_info||(d==null?void 0:d.user_info);let I=null;U&&(U.first_name||U.last_name?I=[U.first_name,U.last_name].filter(Boolean).join(" "):U.username&&(I=`@${U.username}`));const M=l.platform||(d==null?void 0:d.platform)||(a.startsWith("telegram:")?"telegram":void 0),c=M==="telegram"||a.startsWith("telegram:")?`Telegram #${a.replace("telegram:","")}`:"Диалог",t=I||(d==null?void 0:d.title)||c,n=$e({...d||{},id:a,title:t,last_message_preview:l.last_message_preview||l.content||(d==null?void 0:d.last_message_preview)||"",last_message_at:l.last_message_at||l.created_at||(d==null?void 0:d.last_message_at)||new Date().toISOString(),unread_count:l.is_new?((d==null?void 0:d.unread_count)??0)+1:(d==null?void 0:d.unread_count)??0,status:l.status||(d==null?void 0:d.status)||"NORMAL",agent_status:l.agent_status||(d==null?void 0:d.agent_status),created_at:l.created_at||(d==null?void 0:d.created_at)||new Date().toISOString(),updated_at:new Date().toISOString(),platform:M,user_info:U||(d==null?void 0:d.user_info)});r!==-1?j.value=[n,...j.value.filter((x,o)=>o!==r)]:j.value=[n,...j.value]},updateDialogStatus:(l,a)=>{const r=j.value.findIndex(d=>d.id===l);r!==-1&&(j.value[r]={...j.value[r],status:a})},updateLastMessage:(l,a,r)=>{const d=j.value.findIndex(U=>U.id===l);if(d!==-1){j.value[d]={...j.value[d],last_message_preview:a,last_message_at:r};const U=j.value.splice(d,1)[0];j.value.unshift(U)}},incrementUnread:l=>{const a=j.value.findIndex(r=>r.id===l);a!==-1&&(j.value[a]={...j.value[a],unread_count:j.value[a].unread_count+1})},markAsRead:l=>{const a=j.value.findIndex(r=>r.id===l);a!==-1&&(j.value[a]={...j.value[a],unread_count:0})},getDialogById:l=>j.value.find(a=>a.id===l),resolveDialogId:l=>{if(!l)return null;const a=String(l),r=j.value.find(U=>U.id===a);if(r)return r.id;const d=j.value.find(U=>U.id.endsWith(`:${a}`));return(d==null?void 0:d.id)??a},clearDialogs:()=>{j.value=[],Re.value=null,ne.value=null}}},F=Ze({}),V=(e,s)=>{F[e]=[...s]},we=E(!1),ie=E(!1),ge=E(!1),fe=E(null),te=E(null),Le=E(new Map),Ct=(e,s)=>{const u=s.isUser??s.is_user,_=s.isAgent??s.is_agent;if(typeof u=="boolean")return u?"user":"agent";if(typeof _=="boolean")return _?"agent":"user";if(typeof e=="string"){const b=e.toLowerCase();if(["user","human","client","customer","visitor","requester"].includes(b))return"user";if(["manager","operator","admin","support"].includes(b))return"manager";if(["agent","assistant","bot","ai","system"].includes(b))return"agent"}return"agent"},At=e=>{if(typeof e=="string"){const s=e.toLowerCase();if(s.includes("image")||s.includes("photo")||s.includes("img"))return"image";if(s.includes("voice")||s.includes("audio")||s.includes("wav")||s.includes("mp3"))return"voice"}return"text"},Rt=e=>{if(typeof e!="string")return"sent";const s=e.toLowerCase();return s==="sending"?"sending":s==="failed"?"failed":s==="streaming"?"streaming":s==="done"?"done":"sent"},wt=new Set(["tool","function","tool_result","function_result","tool_call","function_call","tool_use"]),Lt=new Set(["tool_result","tool_call","function_call","function_result","tool_use"]),Tt=e=>{const s=e.trim();if(s.length<20||!(s.startsWith("{")&&s.endsWith("}")||s.startsWith("[")&&s.endsWith("]")))return!1;try{const _=JSON.parse(s);if(typeof _=="object"&&_!==null)return!0}catch{if(/^\{\s*'[^']+'\s*:/.test(s))return!0}return!1},Be=(e,s)=>{var l;const u=(e==null?void 0:e.role)??(e==null?void 0:e.sender)??(e==null?void 0:e.author)??(e==null?void 0:e.from)??(e==null?void 0:e.direction);if(typeof u=="string"&&wt.has(u.toLowerCase()))return null;const _=(e==null?void 0:e.type)??(e==null?void 0:e.message_type)??(e==null?void 0:e.content_type)??(e==null?void 0:e.kind);if(typeof _=="string"&&Lt.has(_.toLowerCase()))return null;const b=(e==null?void 0:e.content)??(e==null?void 0:e.text)??(e==null?void 0:e.message)??(e==null?void 0:e.body)??(e==null?void 0:e.payload)??((l=e==null?void 0:e.data)==null?void 0:l.content)??"";if(typeof b=="object"&&b!==null)return null;const T=typeof b=="string"?b:String(b);if(Tt(T))return null;const h=(e==null?void 0:e.dialog_id)??(e==null?void 0:e.dialogId)??(e==null?void 0:e.session_id)??(e==null?void 0:e.sessionId)??s,N=(e==null?void 0:e.id)??(e==null?void 0:e.message_id)??(e==null?void 0:e.messageId)??(e==null?void 0:e.uuid)??(e==null?void 0:e._id)??`${h}-${(e==null?void 0:e.created_at)??(e==null?void 0:e.createdAt)??Date.now()}`,A=Ct(u,{isUser:e==null?void 0:e.isUser,is_user:e==null?void 0:e.is_user,isAgent:e==null?void 0:e.isAgent,is_agent:e==null?void 0:e.is_agent}),f=At((e==null?void 0:e.type)??(e==null?void 0:e.message_type)??(e==null?void 0:e.content_type)??(e==null?void 0:e.kind)??(e==null?void 0:e.media_type)),p=(e==null?void 0:e.created_at)??(e==null?void 0:e.createdAt)??(e==null?void 0:e.timestamp)??(e==null?void 0:e.time)??(e==null?void 0:e.created)??new Date().toISOString(),k=Rt(e==null?void 0:e.status),L=(e==null?void 0:e.duration_seconds)??(e==null?void 0:e.durationSeconds)??(e==null?void 0:e.duration),y=typeof L=="number"?L:Number.isFinite(Number(L))?Number(L):void 0;return{id:String(N),dialog_id:String(h),role:A,type:f,content:T,status:k,duration_seconds:y,created_at:String(p)}},Xe=()=>{const e=He(),{updateDialogStatus:s,updateLastMessage:u,resolveDialogId:_}=xe(),b=c=>F[c]||[],T=async(c,t,n)=>{if(!c||!t){console.warn("[useMessages] Missing agentId or dialogId:",{agentId:c,dialogId:t});return}we.value=!0,te.value=null;let x=!1;const o=new URLSearchParams;n!=null&&n.before&&o.set("before",n.before),n!=null&&n.limit&&o.set("limit",String(n.limit));const v=o.toString(),C=encodeURIComponent(t),R=`agents/${c}/dialogs/${C}/messages${v?`?${v}`:""}`;try{console.log("[useMessages] fetchMessages URL:",R);const g=await e(R,{method:"GET"});console.log("[useMessages] fetchMessages raw response:",g),console.log("[useMessages] fetchMessages response type:",typeof g,Array.isArray(g)?"array":"");let w=[];Array.isArray(g)?(w=g,x=!1):g&&typeof g=="object"&&"messages"in g?(w=g.messages||[],x=g.has_more||!1):g&&typeof g=="object"&&"items"in g?(w=g.items||[],x=g.has_more||!1):g&&typeof g=="object"&&"data"in g?(w=g.data||[],x=g.has_more||!1):console.error("[useMessages] Unexpected response format:",g),console.log("[useMessages] rawMessages count:",w.length),w.length>0&&console.log("[useMessages] first raw message sample:",w[0]);const $=[];for(const S of w){const P=Be(S,t);P?$.push(P):console.warn("[useMessages] Message filtered out by normalizeMessage:",{id:S==null?void 0:S.id,role:(S==null?void 0:S.role)??(S==null?void 0:S.sender),type:(S==null?void 0:S.type)??(S==null?void 0:S.message_type),content_type:typeof(S==null?void 0:S.content),content_preview:typeof(S==null?void 0:S.content)=="string"?S.content.slice(0,80):typeof(S==null?void 0:S.content)})}const z=F[t]||[];n!=null&&n.before?V(t,[...$,...z]):V(t,$),Le.value.set(t,x),console.log("[useMessages] Final messages count for dialog",t,":",(F[t]||[]).length)}catch(g){console.error("[useMessages] fetchMessages error:",g),console.error("[useMessages] fetchMessages error details:",{status:(g==null?void 0:g.statusCode)||(g==null?void 0:g.status),data:g==null?void 0:g.data,message:g==null?void 0:g.message,url:R}),te.value=X(g,"Не удалось загрузить сообщения")}finally{we.value=!1}},h=async(c,t,n,x="text",o=!0)=>{if(!c||!t||!n.trim())return null;ie.value=!0,te.value=null;const v=`temp-${Date.now()}`,C={id:v,dialog_id:t,role:"user",type:x,content:n.trim(),status:"sending",created_at:new Date().toISOString()},R=F[t]||[];V(t,[...R,C]);try{const g={content:n.trim(),type:x},w=encodeURIComponent(t),$=await e(`agents/${c}/dialogs/${w}/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:g}),z=F[t]||[],S=z.findIndex(P=>P.id===v);if(S!==-1){const P=[...z];P[S]={...P[S],status:"sent"},V(t,P)}if(u(t,n.trim().slice(0,100),$.created_at||new Date().toISOString()),o){const P=($==null?void 0:$.id)||($==null?void 0:$.message_id);P&&await a(c,t,P)}return $}catch(g){const w=F[t]||[],$=w.findIndex(z=>z.id===v);if($!==-1){const z=[...w];z[$]={...z[$],status:"failed",error_message:X(g,"Ошибка отправки")},V(t,z)}return te.value=X(g,"Не удалось отправить сообщение"),null}finally{ie.value=!1}},N=async(c,t,n,x=!0)=>{const o=F[t]||[],v=o.find(C=>C.id===n);!v||v.status!=="failed"||(V(t,o.filter(C=>C.id!==n)),await h(c,t,v.content,v.type,x))},A=async(c,t,n)=>{if(!c||!t||!n.trim())return null;ie.value=!0,te.value=null;const x=`temp-mgr-${Date.now()}`,o={id:x,dialog_id:t,role:"manager",type:"text",content:n.trim(),status:"sending",created_at:new Date().toISOString()},v=F[t]||[];V(t,[...v,o]);try{const C={content:n.trim()},R=encodeURIComponent(t);await e(`agents/${c}/dialogs/${R}/manager-message`,{method:"POST",headers:{"Content-Type":"application/json"},body:C});const g=F[t]||[],w=g.findIndex($=>$.id===x);if(w!==-1){const $=[...g];$[w]={...$[w],status:"sent"},V(t,$)}return u(t,n.trim().slice(0,100),new Date().toISOString()),{...o,status:"sent"}}catch(C){const R=F[t]||[],g=R.findIndex(w=>w.id===x);if(g!==-1){const w=[...R];w[g]={...w[g],status:"failed",error_message:X(C,"Ошибка отправки")},V(t,w)}return te.value=X(C,"Не удалось отправить сообщение менеджера"),null}finally{ie.value=!1}},f=(c,t,n="text")=>{const x=`temp-${Date.now()}`,o={id:x,dialog_id:c,role:"user",type:n,content:t.trim(),status:"sending",created_at:new Date().toISOString()},v=F[c]||[];return V(c,[...v,o]),ie.value=!0,x},p=(c,t,n)=>{const x=F[c]||[],o=x.findIndex(v=>v.id===t);if(o!==-1){const v=[...x];v[o]={...v[o],status:"sent"},V(c,v)}ie.value=!1},k=(c,t,n)=>{const x=n||"Не удалось отправить сообщение",o=F[c]||[],v=o.findIndex(C=>C.id===t);if(v!==-1){const C=[...o];C[v]={...C[v],status:"failed",error_message:x},V(c,C)}ie.value=!1,te.value=x},L=(c,t)=>{ge.value=!0;const n=`agent-${c}`;fe.value=n;const x={id:n,dialog_id:t,role:"agent",type:"text",content:"",status:"streaming",created_at:new Date().toISOString()},o=F[t]||[];V(t,[...o,x])},y=(c,t,n)=>{const x=`agent-${c}`,o=F[t]||[],v=o.findIndex(C=>C.id===x);if(v!==-1){const C=[...o];C[v]={...C[v],content:n,status:"done"},V(t,C)}ge.value=!1,fe.value=null},l=(c,t,n)=>{const x=`agent-${c}`,o=F[t]||[],v=o.findIndex(C=>C.id===x);if(v!==-1){const C=[...o];C[v]={...C[v],content:`Ошибка: ${n}`,status:"failed",error_message:n},V(t,C)}ge.value=!1,fe.value=null,te.value=n},a=async(c,t,n)=>{var C,R,g,w,$;ge.value=!0,s(t,"IN_PROGRESS");const x=`agent-${Date.now()}`;fe.value=x;const o={id:x,dialog_id:t,role:"agent",type:"text",content:"",status:"streaming",created_at:new Date().toISOString()},v=F[t]||[];V(t,[...v,o]);try{const z=Ve(),S=encodeURIComponent(t),P=await fetch(`/api/v1/agents/${c}/dialogs/${S}/messages/stream`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"text/event-stream",...z?{Authorization:`Bearer ${z}`}:{}},body:JSON.stringify({user_message_id:n})});if(!P.ok)throw new Error(X({status:P.status},"Не удалось получить ответ агента"));const Z=(C=P.body)==null?void 0:C.getReader();if(!Z)throw new Error("No reader available");const ye=new TextDecoder;let ee="";for(;;){const{done:Y,value:de}=await Z.read();if(Y)break;ee+=ye.decode(de,{stream:!0});const Oe=ee.split(`
`);ee=Oe.pop()||"";for(const Ne of Oe)if(Ne.startsWith("data: ")){const Ue=Ne.slice(6);if(Ue==="[DONE]")continue;try{const se=JSON.parse(Ue);if(se.type==="delta"&&((R=se.data)!=null&&R.content)){const he=F[t]||[],le=he.findIndex(K=>K.id===x);if(le!==-1){const K=[...he];K[le]={...K[le],content:K[le].content+se.data.content},V(t,K)}}else if(se.type==="done"){const he=F[t]||[],le=he.findIndex(K=>K.id===x);if(le!==-1){const K=[...he];K[le]={...K[le],id:((g=se.data)==null?void 0:g.message_id)||x,status:"done"},V(t,K)}}else if(se.type==="error")throw new Error(((w=se.data)==null?void 0:w.error)||"Stream error")}catch(se){console.warn("Failed to parse SSE event:",se)}}}const ue=F[t]||[],oe=ue.findIndex(Y=>Y.id===x||Y.status==="streaming");if(oe!==-1&&ue[oe].status==="streaming"){const Y=[...ue];Y[oe]={...Y[oe],status:"done"},V(t,Y)}const Ae=(($=ue[oe])==null?void 0:$.content)||"";Ae&&u(t,Ae.slice(0,100),new Date().toISOString()),s(t,"NORMAL")}catch(z){console.error("Stream error:",z);const S=F[t]||[],P=S.findIndex(Z=>Z.id===x);if(P!==-1){const Z=S.filter((ye,ee)=>ee!==P);V(t,Z)}s(t,"ERROR"),te.value=X(z,"Не удалось получить ответ агента")}finally{ge.value=!1,fe.value=null}},r=(c,t)=>{const n=_(c)??c,x=F[n]||[];V(n,[...x,{...t,dialog_id:n}])},d=(c,t,n)=>{const x=_(c)??c,o=F[x]||[],v=o.findIndex(C=>C.id===t);if(v!==-1){const C=[...o];C[v]={...C[v],...n},V(x,C)}},U=c=>{const t=_(c)??c;delete F[t],Le.value.delete(t)},I=c=>Le.value.get(c)??!0,M=c=>{const t=(c==null?void 0:c.dialog_id)??(c==null?void 0:c.session_id),n=_(t);if(!n)return;const x=F[n]||[],o=Be({...c,dialog_id:n},n);if(!o||x.some(R=>R.id===o.id))return;const v=Date.now();x.some(R=>R.role===o.role&&R.content.trim()===o.content.trim()&&R.status!=="failed"&&v-new Date(R.created_at).getTime()<15e3)||(V(n,[...x,o]),u(n,o.content.slice(0,100),o.created_at))};return{isLoading:be(we),isSending:be(ie),isStreaming:be(ge),streamingMessageId:be(fe),error:be(te),messagesMap:F,getMessages:b,dialogHasMore:I,fetchMessages:T,sendMessage:h,sendManagerMessage:A,retryMessage:N,addMessage:r,addIncomingMessage:M,updateMessage:d,clearMessages:U,createOptimisticMessage:f,markMessageSent:p,markMessageFailed:k,handleRunStart:L,handleRunResult:y,handleRunError:l,startAgentStream:a}},It={maxAttempts:5,baseDelay:1e3,maxDelay:16e3},Et=(e,s)=>{const u=xe(),_=Xe(),{resolveDialogId:b}=u,T={...It,...s==null?void 0:s.reconnectConfig},h=E("disconnected"),N=E(0),A=E(null),f=E(null),p=E(null);let k=null,L=null,y=null;const l=R=>{if(typeof window>"u")return null;const g=Ve();if(!g)return console.error("[WebSocket] No auth token found"),null;const w=window.location.protocol==="https:"?"wss:":"ws:",$=window.location.host;return`${w}//${$}/api/v1/agents/${R}/ws?token=${g}`},a=R=>{if(!k||k.readyState!==WebSocket.OPEN)return console.warn("[WebSocket] Cannot send - connection not open"),!1;try{return k.send(JSON.stringify(R)),!0}catch(g){return console.error("[WebSocket] Send error:",g),!1}},r=R=>{try{const w=JSON.parse(R.data);switch(w.type){case"message_created":{const $=w.data,z=$.dialog_id??$.session_id,S=b(z)??(z?String(z):null);if(!S){console.warn("[WebSocket] message_created without dialog_id/session_id");break}const P=typeof $.role=="string"?$.role.toLowerCase():"";if(["tool","function","tool_result","function_result","tool_call","function_call","tool_use"].includes(P)||typeof $.content=="object"&&$.content!==null)break;const ye=S===p.value,ee=$.user_info,ue=(ee==null?void 0:ee.platform)||(S.startsWith("telegram:")?"telegram":void 0),oe=typeof $.content=="string"?$.content:"";u.upsertDialog({id:S,session_id:S,last_message_preview:oe,last_message_at:$.created_at,is_new:!ye,platform:ue,user_info:ee});const Y=_.getMessages(S).find(de=>de.status==="sending"&&(de.role==="user"||de.role==="manager")&&de.content.trim()===oe.trim());Y?_.markMessageSent(S,Y.id,$.id):_.addIncomingMessage({...$,dialog_id:S}),ye&&u.markAsRead(S);break}case"dialog_updated":{u.upsertDialog(w.data);break}case"run_start":{const{run_id:$,dialog_id:z}=w.data,S=b(z)??z;A.value=$,f.value=S,_.handleRunStart($,S),u.updateDialogStatus(S,"IN_PROGRESS");break}case"run_result":{const{run_id:$,output:z,dialog_id:S}=w.data,P=b(S)??S,Z=P===p.value;_.handleRunResult($,P,z),u.upsertDialog({id:P,last_message_preview:z.slice(0,100),last_message_at:new Date().toISOString(),is_new:!Z}),u.updateDialogStatus(P,"NORMAL"),Z&&u.markAsRead(P),A.value===$&&(A.value=null,f.value=null);break}case"run_error":{const{run_id:$,error:z,dialog_id:S}=w.data,P=b(S)??S;_.handleRunError($,P,z),u.updateDialogStatus(P,"ERROR"),A.value===$&&(A.value=null,f.value=null);break}case"ping":{a({type:"pong"}),d();break}case"error":{console.error("[WebSocket] Server error:",w.data.message);break}case"status":case"dialog_joined":case"dialog_left":break;default:console.warn("[WebSocket] Unknown message type:",w.type)}}catch(g){console.error("[WebSocket] Error parsing message:",g)}},d=()=>{y&&clearTimeout(y),y=setTimeout(()=>{console.warn("[WebSocket] No ping received in 60s, reconnecting..."),c()},6e4)},U=()=>{if(N.value>=T.maxAttempts){console.error("[WebSocket] Max reconnect attempts reached"),h.value="error";return}const R=Math.min(T.baseDelay*Math.pow(2,N.value),T.maxDelay);L=setTimeout(()=>{N.value++,I()},R)},I=()=>{const R=O(e);if(!R||typeof window>"u"){console.warn("[WebSocket] Cannot connect - no agent ID or not in browser");return}M(!1);const g=l(R);if(g){h.value="connecting";try{k=new WebSocket(g),k.onopen=()=>{h.value="connected",N.value=0,d()},k.onclose=w=>{h.value="disconnected",y&&(clearTimeout(y),y=null),w.code!==1e3&&w.code!==1008?U():w.code===1008&&(console.error("[WebSocket] Unauthorized - invalid token"),h.value="error")},k.onerror=w=>{console.error("[WebSocket] Error:",w),h.value="error"},k.onmessage=r}catch(w){console.error("[WebSocket] Connection error:",w),h.value="error",U()}}},M=(R=!0)=>{R&&L&&(clearTimeout(L),L=null),y&&(clearTimeout(y),y=null),k&&(k.close(1e3,"Client closed"),k=null),p.value=null,R&&(h.value="disconnected",N.value=0)},c=()=>{M(!1),N.value=0,I()},t=(R,g)=>a({type:"send_message",dialog_id:R,content:g}),n=R=>{const g=a({type:"join_dialog",dialog_id:R});return g&&(p.value=R),g},x=R=>{const g=a({type:"leave_dialog",dialog_id:R});return g&&p.value===R&&(p.value=null),g},o=()=>a({type:"get_status"});Q(()=>O(e),(R,g)=>{R!==g&&(R?I():M())},{immediate:(s==null?void 0:s.autoConnect)!==!1}),Pe(()=>{M()});const v=W(()=>h.value==="connected"),C=W(()=>h.value==="connecting");return{connectionState:h,isConnected:v,isConnecting:C,reconnectAttempts:N,connect:I,disconnect:M,reconnect:c,sendMessage:t,joinDialog:n,leaveDialog:x,getStatus:o}},jt={class:"flex-1 min-w-0"},Ot={class:"flex items-center gap-2"},Nt={key:0,class:"px-1.5 py-0.5 text-[10px] font-medium rounded bg-blue-100 text-blue-700"},Ut={key:0,class:"text-xs text-blue-500 truncate"},Wt={class:"text-xs text-slate-500 truncate mt-0.5"},Bt={class:"flex flex-col items-end gap-1 flex-shrink-0"},Pt={class:"text-xs text-slate-400"},zt={key:0,class:"px-1.5 py-0.5 text-[10px] font-medium rounded bg-green-100 text-green-700 flex items-center gap-0.5"},Ft={key:1,class:"px-1.5 py-0.5 text-[10px] font-medium rounded bg-amber-100 text-amber-700 flex items-center gap-0.5"},qt={key:0,class:"fixed inset-0 z-[110] flex items-center justify-center p-4"},Ht={class:"relative bg-white rounded-2xl shadow-xl p-6 max-w-sm w-full"},Vt={class:"flex gap-3 mt-4"},Gt=["disabled"],Jt={key:0,class:"fixed inset-0 z-[110] flex items-center justify-center p-4"},Kt={class:"relative bg-white rounded-2xl shadow-xl p-6 max-w-sm w-full"},Xt={class:"flex gap-3"},Yt=ae({__name:"DialogItem",props:{dialog:{},isSelected:{type:Boolean}},emits:["click","rename","delete"],setup(e,{emit:s}){const u=e,_=s,b=E(!1),T=E(null),h=E({x:0,y:0}),N=E(!1),A=E(""),f=E(null),p=E(!1);Ge(T,()=>{b.value=!1});const k=W(()=>{var t;return u.dialog.platform==="telegram"||((t=u.dialog.id)==null?void 0:t.startsWith("telegram:"))}),L=W(()=>{var t;return((t=u.dialog.user_info)==null?void 0:t.username)||null}),y=W(()=>{const t=u.dialog.user_info;return t!=null&&t.first_name||t!=null&&t.last_name?[t.first_name,t.last_name].filter(Boolean).join(" "):t!=null&&t.username?`@${t.username}`:k.value&&u.dialog.id?`Telegram #${u.dialog.id.replace("telegram:","")}`:"Диалог"}),l=W(()=>{if(!u.dialog.last_message_at)return"";const t=new Date(u.dialog.last_message_at),x=new Date().getTime()-t.getTime(),o=Math.floor(x/(1e3*60*60*24));return o===0?t.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}):o===1?"Вчера":o<7?t.toLocaleDateString("ru-RU",{weekday:"short"}):t.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}),a=W(()=>(u.dialog.agent_status??"active")==="active"),r=W(()=>{const t=u.dialog.status;return t==="IN_PROGRESS"&&!a.value?u.dialog.unread_count>0?"UNREAD":null:t==="IN_PROGRESS"?"IN_PROGRESS":t==="ERROR"?"ERROR":u.dialog.unread_count>0?"UNREAD":t==="NEW"?"NEW":null}),d=t=>{t.preventDefault(),h.value={x:t.clientX,y:t.clientY},b.value=!0},U=()=>{b.value=!1,A.value=u.dialog.title||"",N.value=!0,pe(()=>{var t,n;(t=f.value)==null||t.focus(),(n=f.value)==null||n.select()})},I=()=>{A.value.trim()&&(_("rename",u.dialog.id,A.value.trim()),N.value=!1)},M=()=>{b.value=!1,p.value=!0},c=()=>{_("delete",u.dialog.id),p.value=!1};return(t,n)=>{const x=tt("StatusIndicator");return m(),D("div",{class:"relative group",onContextmenu:Te(d,["prevent"])},[i("button",{onClick:n[0]||(n[0]=o=>t.$emit("click")),class:G(["w-full px-4 py-3 flex items-start gap-3 text-left transition-colors",[e.isSelected?"bg-indigo-50":"hover:bg-slate-50"]])},[i("div",{class:G(["w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",[k.value?e.isSelected?"bg-blue-100":"bg-blue-50":e.isSelected?"bg-indigo-100":"bg-slate-100"]])},[k.value?(m(),D("svg",{key:0,class:G(["w-5 h-5",[e.isSelected?"text-blue-600":"text-blue-500"]]),viewBox:"0 0 24 24",fill:"currentColor"},[...n[6]||(n[6]=[i("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"},null,-1)])],2)):(m(),J(O(ke),{key:1,class:G(["w-5 h-5",[e.isSelected?"text-indigo-600":"text-slate-500"]])},null,8,["class"]))],2),i("div",jt,[i("div",Ot,[i("h3",{class:G(["text-sm font-semibold truncate",[e.isSelected?"text-indigo-900":"text-slate-900"]])},q(y.value),3),k.value?(m(),D("span",Nt," TG ")):H("",!0),r.value?(m(),J(x,{key:1,status:r.value,count:e.dialog.unread_count},null,8,["status","count"])):H("",!0)]),L.value?(m(),D("p",Ut," @"+q(L.value),1)):H("",!0),i("p",Wt,q(e.dialog.last_message_preview||"Нет сообщений"),1)]),i("div",Bt,[i("span",Pt,q(l.value),1),a.value?(m(),D("span",zt,[...n[7]||(n[7]=[i("span",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1),me(" Агент ",-1)])])):(m(),D("span",Ft,[B(O($t),{class:"w-3 h-3"}),n[8]||(n[8]=me(" Пауза ",-1))]))])],2),i("button",{onClick:Te(d,["stop"]),class:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 rounded-lg opacity-0 group-hover:opacity-100 hover:bg-slate-200 transition-opacity lg:block hidden"},[B(O(ct),{class:"w-4 h-4 text-slate-500"})]),(m(),J(De,{to:"body"},[B(ve,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:re(()=>[b.value?(m(),D("div",{key:0,ref_key:"contextMenuRef",ref:T,class:"fixed bg-white rounded-xl shadow-lg border border-slate-200 py-1 z-[100] min-w-[160px]",style:ze({top:`${h.value.y}px`,left:`${h.value.x}px`})},[i("button",{onClick:U,class:"w-full px-4 py-2 text-left text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-2"},[B(O(ut),{class:"w-4 h-4"}),n[9]||(n[9]=me(" Переименовать ",-1))]),i("button",{onClick:M,class:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2"},[B(O(dt),{class:"w-4 h-4"}),n[10]||(n[10]=me(" Удалить ",-1))])],4)):H("",!0)]),_:1})])),(m(),J(De,{to:"body"},[B(ve,{name:"modal-fade"},{default:re(()=>[N.value?(m(),D("div",qt,[i("div",{class:"absolute inset-0 bg-black/50",onClick:n[1]||(n[1]=o=>N.value=!1)}),i("div",Ht,[n[11]||(n[11]=i("h3",{class:"text-lg font-bold text-slate-900 mb-4"},"Переименовать диалог",-1)),Ee(i("input",{"onUpdate:modelValue":n[2]||(n[2]=o=>A.value=o),type:"text",placeholder:"Название диалога",class:"w-full px-4 py-2.5 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent",onKeyup:et(I,["enter"]),ref_key:"renameInputRef",ref:f},null,544),[[je,A.value]]),i("div",Vt,[i("button",{onClick:n[3]||(n[3]=o=>N.value=!1),class:"flex-1 px-4 py-2.5 rounded-xl text-sm font-medium text-slate-600 bg-slate-100 hover:bg-slate-200 transition-colors"}," Отмена "),i("button",{onClick:I,disabled:!A.value.trim(),class:"flex-1 px-4 py-2.5 rounded-xl text-sm font-bold text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-slate-300 disabled:cursor-not-allowed transition-colors"}," Сохранить ",8,Gt)])])])):H("",!0)]),_:1})])),(m(),J(De,{to:"body"},[B(ve,{name:"modal-fade"},{default:re(()=>[p.value?(m(),D("div",Jt,[i("div",{class:"absolute inset-0 bg-black/50",onClick:n[4]||(n[4]=o=>p.value=!1)}),i("div",Kt,[n[12]||(n[12]=i("h3",{class:"text-lg font-bold text-slate-900 mb-2"},"Удалить диалог?",-1)),n[13]||(n[13]=i("p",{class:"text-sm text-slate-500 mb-6"}," Это действие нельзя отменить. Все сообщения будут удалены. ",-1)),i("div",Xt,[i("button",{onClick:n[5]||(n[5]=o=>p.value=!1),class:"flex-1 px-4 py-2.5 rounded-xl text-sm font-medium text-slate-600 bg-slate-100 hover:bg-slate-200 transition-colors"}," Отмена "),i("button",{onClick:c,class:"flex-1 px-4 py-2.5 rounded-xl text-sm font-bold text-white bg-red-600 hover:bg-red-700 transition-colors"}," Удалить ")])])])):H("",!0)]),_:1})]))],32)}}}),Qt=Ce(Yt,[["__scopeId","data-v-1509f877"]]),Zt={class:"h-full flex flex-col"},es={class:"p-4 border-b border-slate-200"},ts={class:"w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0"},ss={class:"text-white font-bold text-sm"},ns={class:"flex-1 text-left min-w-0"},as={class:"text-sm font-semibold text-slate-900 truncate"},os={class:"text-xs text-slate-500"},ls={key:0,class:"absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-lg border border-slate-200 z-50 max-h-64 overflow-y-auto"},is={class:"p-2"},rs=["onClick"],cs={class:"w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0"},us={class:"text-white font-bold text-xs"},ds={class:"text-sm font-medium truncate"},gs={key:0,class:"px-3 py-4 text-center text-sm text-slate-500"},fs={class:"px-4 py-3"},ms={class:"relative"},vs={class:"flex-1 overflow-y-auto"},ps={key:0,class:"flex items-center justify-center py-8"},xs={key:1,class:"px-4 py-8 text-center"},ys={class:"text-sm text-slate-500"},hs=ae({__name:"DialogsSidebar",props:{agents:{},selectedAgentId:{},selectedDialogId:{},isLoading:{type:Boolean}},emits:["select-agent","select-dialog","create-dialog"],setup(e,{emit:s}){const u=e,_=s,{dialogs:b,isLoading:T,updateDialog:h,deleteDialog:N}=xe(),A=E(null),f=E(!1),p=E("");Ge(A,()=>{f.value=!1});const k=W(()=>u.agents.find(M=>M.id===u.selectedAgentId)),L=W(()=>{var M;return((M=k.value)==null?void 0:M.name)||"Выберите агента"}),y=W(()=>{var M;return r(((M=k.value)==null?void 0:M.name)||"")}),l=W(()=>{const M=u.agents.length;return M===1?"агент":M>=2&&M<=4?"агента":"агентов"}),a=W(()=>{if(!p.value.trim())return b.value;const M=p.value.toLowerCase();return b.value.filter(c=>{const t=c.title||"Диалог",n=c.last_message_preview||"";return t.toLowerCase().includes(M)||n.toLowerCase().includes(M)})}),r=M=>M?M.split(" ").map(c=>c.charAt(0)).join("").toUpperCase().slice(0,2):"?",d=M=>{f.value=!1,_("select-agent",M)},U=async(M,c)=>{u.selectedAgentId&&await h(u.selectedAgentId,M,{title:c})},I=async M=>{u.selectedAgentId&&await N(u.selectedAgentId,M)};return Q(()=>u.selectedAgentId,()=>{p.value=""}),(M,c)=>(m(),D("div",Zt,[i("div",es,[i("div",{class:"relative",ref_key:"dropdownRef",ref:A},[i("button",{onClick:c[0]||(c[0]=t=>f.value=!f.value),class:"w-full flex items-center gap-3 px-3 py-2.5 bg-slate-50 hover:bg-slate-100 rounded-xl transition-colors"},[i("div",ts,[i("span",ss,q(y.value),1)]),i("div",ns,[i("p",as,q(L.value),1),i("p",os,q(e.agents.length)+" "+q(l.value),1)]),B(O(gt),{class:G(["w-5 h-5 text-slate-400 transition-transform",{"rotate-180":f.value}])},null,8,["class"])]),B(ve,{"enter-active-class":"transition duration-150 ease-out","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-100 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:re(()=>[f.value?(m(),D("div",ls,[i("div",is,[(m(!0),D(ce,null,Ie(e.agents,t=>(m(),D("button",{key:t.id,onClick:n=>d(t.id),class:G(["w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors",[t.id===e.selectedAgentId?"bg-indigo-50 text-indigo-900":"hover:bg-slate-50 text-slate-700"]])},[i("div",cs,[i("span",us,q(r(t.name)),1)]),i("span",ds,q(t.name),1),t.id===e.selectedAgentId?(m(),J(O(Je),{key:0,class:"w-4 h-4 text-indigo-600 ml-auto flex-shrink-0"})):H("",!0)],10,rs))),128)),e.agents.length===0?(m(),D("div",gs," Нет доступных агентов ")):H("",!0)])])):H("",!0)]),_:1})],512)]),i("div",fs,[i("div",ms,[B(O(ft),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),Ee(i("input",{"onUpdate:modelValue":c[1]||(c[1]=t=>p.value=t),type:"text",placeholder:"Поиск диалогов...",class:"w-full pl-9 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"},null,512),[[je,p.value]])])]),i("div",vs,[e.isLoading||O(T)?(m(),D("div",ps,[B(O(Me),{class:"w-6 h-6 text-indigo-600 animate-spin"})])):a.value.length===0?(m(),D("div",xs,[B(O(ke),{class:"w-12 h-12 text-slate-300 mx-auto mb-3"}),i("p",ys,q(p.value?"Диалоги не найдены":"Нет диалогов"),1),!p.value&&e.selectedAgentId?(m(),D("button",{key:0,onClick:c[2]||(c[2]=t=>M.$emit("create-dialog")),class:"mt-3 text-sm text-indigo-600 hover:text-indigo-700 font-medium"}," Создать первый диалог ")):H("",!0)])):(m(),J(Fe,{key:2,tag:"div",class:"divide-y divide-slate-100",name:"dialog-list"},{default:re(()=>[(m(!0),D(ce,null,Ie(a.value,t=>(m(),J(Qt,{key:t.id,dialog:t,"is-selected":t.id===e.selectedDialogId,onClick:n=>M.$emit("select-dialog",t.id),onRename:U,onDelete:I},null,8,["dialog","is-selected","onClick"]))),128))]),_:1}))])]))}}),bs=Ce(hs,[["__scopeId","data-v-26ed367c"]]),_s={class:"bg-white border-b border-slate-200 px-4 py-3 flex items-center gap-3 flex-shrink-0"},ks={key:0,class:"w-5 h-5 text-blue-600",viewBox:"0 0 24 24",fill:"currentColor"},Ss={key:1,class:"text-white font-bold text-sm"},Ms={class:"flex-1 min-w-0"},$s={class:"text-sm font-semibold text-slate-900 truncate"},Ds={key:0,class:"text-xs text-blue-600 truncate"},Cs={class:"flex items-center gap-1.5 mt-0.5"},As={class:"text-xs text-slate-500"},Rs={class:"text-xs text-slate-500"},ws={class:"flex items-center gap-2"},Ls=["aria-checked","title"],Ts=ae({__name:"ChatHeader",props:{agent:{},dialog:{},isStreaming:{type:Boolean}},emits:["back"],setup(e){const s=e,{toggleDialogAgentStatus:u}=xe(),_=W(()=>{var f;return(((f=s.dialog)==null?void 0:f.agent_status)??"active")==="active"}),b=W(()=>{var f,p,k;return((f=s.dialog)==null?void 0:f.platform)==="telegram"||((k=(p=s.dialog)==null?void 0:p.id)==null?void 0:k.startsWith("telegram:"))}),T=W(()=>{var f,p;return((p=(f=s.dialog)==null?void 0:f.user_info)==null?void 0:p.username)||""}),h=W(()=>{var p,k;const f=(p=s.dialog)==null?void 0:p.user_info;return f!=null&&f.first_name||f!=null&&f.last_name?[f.first_name,f.last_name].filter(Boolean).join(" "):f!=null&&f.username?`@${f.username}`:b.value&&((k=s.dialog)!=null&&k.id)?`Telegram #${s.dialog.id.replace("telegram:","")}`:"Диалог"}),N=W(()=>{var p,k;const f=(p=s.dialog)==null?void 0:p.user_info;if(f!=null&&f.first_name){const L=f.first_name.charAt(0),y=((k=f.last_name)==null?void 0:k.charAt(0))||"";return(L+y).toUpperCase()}return f!=null&&f.username?f.username.charAt(0).toUpperCase():"?"}),A=()=>{var f;(f=s.dialog)!=null&&f.id&&u(s.agent.id,s.dialog.id)};return(f,p)=>(m(),D("div",_s,[i("button",{onClick:p[0]||(p[0]=k=>f.$emit("back")),class:"lg:hidden p-2 -ml-2 rounded-lg text-slate-600 hover:bg-slate-100 transition-colors"},[B(O(mt),{class:"w-5 h-5"})]),i("div",{class:G(["w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",[b.value?"bg-blue-100":"bg-gradient-to-br from-indigo-500 to-purple-600"]])},[b.value?(m(),D("svg",ks,[...p[1]||(p[1]=[i("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"},null,-1)])])):(m(),D("span",Ss,q(N.value),1))],2),i("div",Ms,[i("h2",$s,q(h.value),1),b.value&&T.value?(m(),D("p",Ds," @"+q(T.value),1)):H("",!0),i("div",Cs,[e.isStreaming&&_.value?(m(),D(ce,{key:0},[B(O(Me),{class:"w-3 h-3 text-indigo-600 animate-spin"}),p[2]||(p[2]=i("span",{class:"text-xs text-indigo-600 font-medium"},"В работе...",-1))],64)):_.value?(m(),D(ce,{key:2},[p[4]||(p[4]=i("span",{class:"w-2 h-2 bg-green-500 rounded-full"},null,-1)),i("span",Rs,q(e.agent.name),1)],64)):(m(),D(ce,{key:1},[p[3]||(p[3]=i("span",{class:"w-2 h-2 bg-slate-400 rounded-full"},null,-1)),i("span",As,q(e.agent.name)+" · Выкл.",1)],64))])]),i("div",ws,[i("button",{onClick:A,class:G(["relative w-11 h-6 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",[_.value?"bg-indigo-600":"bg-slate-300"]]),role:"switch","aria-checked":_.value,title:_.value?"Выключить агента":"Включить агента"},[i("span",{class:G(["absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform",[_.value?"translate-x-5":"translate-x-0"]])},null,2)],10,Ls)])]))}}),Is=["innerHTML"],Es=["src"],js={key:2,class:"flex items-center gap-3 min-w-[200px]"},Os={class:"flex-1"},Ns={key:3,class:"flex items-center gap-1 mt-1"},Us={class:"text-[10px] text-slate-400"},Ws={key:2,class:"flex items-center gap-1"},Bs=ae({__name:"MessageBubble",props:{message:{}},emits:["retry","image-click"],setup(e){const s=e,u=vt({linkify:!0,breaks:!0}),_=E(!1),b=E(0),T=E(null),h=W(()=>s.message.role==="agent"),N=W(()=>s.message.role==="manager"),A=W(()=>h.value||N.value),f=W(()=>N.value?"bg-emerald-600 text-white rounded-br-sm":h.value?"bg-indigo-600 text-white rounded-br-sm":"bg-white border border-slate-200 text-slate-900 rounded-bl-sm shadow-sm"),p=W(()=>s.message.type!=="text"?"":u.render(s.message.content)),k=W(()=>new Date(s.message.created_at).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})),L=W(()=>{const l=s.message.duration_seconds||0,a=Math.floor(l/60),r=l%60;return`${a}:${r.toString().padStart(2,"0")}`}),y=()=>{T.value||(T.value=new Audio(s.message.content),T.value.addEventListener("timeupdate",()=>{T.value&&(b.value=T.value.currentTime/T.value.duration*100)}),T.value.addEventListener("ended",()=>{_.value=!1,b.value=0})),_.value?T.value.pause():T.value.play(),_.value=!_.value};return(l,a)=>(m(),D("div",{class:G(["flex",[A.value?"justify-end":"justify-start"]])},[i("div",{class:G(["max-w-[85%] sm:max-w-[70%] lg:max-w-[60%]",[A.value?"order-1":"order-2"]])},[i("div",{class:G(["text-[11px] font-medium mb-1 px-1",[N.value?"text-right text-emerald-600":h.value?"text-right text-indigo-600":"text-left text-slate-500"]])},q(N.value?"Менеджер":h.value?"Агент":"Пользователь"),3),i("div",{class:G(["rounded-2xl px-4 py-2.5 relative",f.value])},[e.message.type==="text"?(m(),D("div",{key:0,class:G(["text-sm whitespace-pre-wrap break-words prose prose-sm max-w-none",[A.value?"prose-invert":""]]),innerHTML:p.value},null,10,Is)):e.message.type==="image"?(m(),D("img",{key:1,src:e.message.content,alt:"Image",class:"rounded-lg max-w-full cursor-pointer hover:opacity-90 transition-opacity",onClick:a[0]||(a[0]=r=>l.$emit("image-click",e.message.content))},null,8,Es)):e.message.type==="voice"?(m(),D("div",js,[i("button",{onClick:y,class:G(["w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 transition-colors",[A.value?"bg-white/20 hover:bg-white/30 text-white":"bg-slate-200 hover:bg-slate-300 text-slate-700"]])},[_.value?(m(),J(O(Dt),{key:0,class:"w-5 h-5"})):(m(),J(O(pt),{key:1,class:"w-5 h-5 ml-0.5"}))],2),i("div",Os,[i("div",{class:G(["h-1 rounded-full overflow-hidden",[A.value?"bg-white/30":"bg-slate-300"]])},[i("div",{class:G(["h-full transition-all",[A.value?"bg-white":"bg-slate-600"]]),style:ze({width:`${b.value}%`})},null,6)],2),i("span",{class:G(["text-xs mt-1 block",[A.value?"text-white/70":"text-slate-500"]])},q(L.value),3)])])):H("",!0),e.message.status==="streaming"?(m(),D("div",Ns,[...a[2]||(a[2]=[i("span",{class:"w-1.5 h-1.5 bg-current rounded-full animate-pulse opacity-60"},null,-1)])])):H("",!0)],2),i("div",{class:G(["flex items-center gap-2 mt-1 px-1",[A.value?"justify-end":"justify-start"]])},[i("span",Us,q(k.value),1),A.value?(m(),D(ce,{key:0},[e.message.status==="sending"?(m(),J(O(Me),{key:0,class:"w-3 h-3 text-slate-400 animate-spin"})):e.message.status==="sent"?(m(),J(O(Je),{key:1,class:"w-3 h-3 text-slate-400"})):e.message.status==="failed"?(m(),D("div",Ws,[B(O(Ke),{class:"w-3 h-3 text-red-500"}),i("button",{onClick:a[1]||(a[1]=r=>l.$emit("retry")),class:"text-[10px] text-red-500 hover:text-red-600 font-medium"}," Повторить ")])):H("",!0)],64)):H("",!0)],2)],2)],2))}}),Ps=Ce(Bs,[["__scopeId","data-v-44947884"]]),zs={class:"flex-1 flex items-center justify-center p-8"},Fs={class:"text-center max-w-sm"},qs={class:"w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6"},Hs={class:"text-lg font-semibold text-slate-900 mb-2"},Vs={class:"text-sm text-slate-500 mb-6"},Ye=ae({__name:"DialogsEmptyState",props:{type:{default:"no-dialog"},errorMessage:{}},emits:["create","retry"],setup(e){const s=e,u=W(()=>{switch(s.type){case"no-agent":return{icon:ke,title:"Выберите агента",description:"Выберите агента из списка слева, чтобы начать диалог.",showAction:!1,actionLabel:""};case"no-dialog":return{icon:yt,title:"Выберите диалог",description:"Выберите существующий диалог или создайте новый, чтобы начать общение с агентом.",showAction:!0,actionLabel:"Новый диалог"};case"no-messages":return{icon:ke,title:"Начните диалог",description:"Напишите сообщение, чтобы начать общение с агентом.",showAction:!1,actionLabel:""};case"error":return{icon:Ke,title:"Ошибка загрузки",description:s.errorMessage||"Не удалось загрузить данные. Попробуйте обновить страницу.",showAction:!0,actionLabel:"Повторить"};default:return{icon:ke,title:"Нет данных",description:"Данные отсутствуют.",showAction:!1,actionLabel:""}}}),_=W(()=>u.value.icon),b=W(()=>u.value.title),T=W(()=>u.value.description),h=W(()=>u.value.showAction),N=W(()=>u.value.actionLabel);return(A,f)=>(m(),D("div",zs,[i("div",Fs,[i("div",qs,[(m(),J(st(_.value),{class:"w-10 h-10 text-slate-400"}))]),i("h3",Hs,q(b.value),1),i("p",Vs,q(T.value),1),h.value?(m(),D("button",{key:0,onClick:f[0]||(f[0]=p=>A.$emit("create")),class:"inline-flex items-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-sm font-semibold transition-colors"},[B(O(xt),{class:"w-4 h-4"}),me(" "+q(N.value),1)])):H("",!0)])]))}}),Gs={key:0,class:"flex justify-center py-3"},Js={key:1,class:"flex justify-center py-3"},Ks={key:2,class:"h-full flex items-center justify-center"},Xs={key:4,class:"flex items-center gap-2 py-2 px-3 text-slate-500"},Ys=["src"],Qs=ae({__name:"MessagesFeed",props:{dialogId:{},messages:{},isLoading:{type:Boolean},isStreaming:{type:Boolean},hasMore:{type:Boolean}},emits:["load-more","retry"],setup(e){const s=e,u=E(null),_=E(!1),b=E(!0),T=E(null),h=E(!1),N=()=>{if(!u.value)return;const{scrollTop:y,scrollHeight:l,clientHeight:a}=u.value,r=l-y-a;b.value=r<100,b.value&&(_.value=!1)},A=(y=!0)=>{u.value&&(u.value.scrollTo({top:u.value.scrollHeight,behavior:y?"smooth":"auto"}),_.value=!1)},f=()=>{A(!0)};Q(()=>s.messages.length,(y,l)=>{if(y>l){!h.value&&l>0&&(h.value=!0);const a=s.messages[s.messages.length-1];b.value||(a==null?void 0:a.role)==="user"||(a==null?void 0:a.role)==="manager"?pe(()=>A(!1)):(a==null?void 0:a.role)==="agent"&&(_.value=!0)}}),Q(()=>s.dialogId,()=>{h.value=!1}),Q(()=>s.isStreaming,y=>{y&&b.value&&pe(()=>A(!1))});const p=y=>{T.value=y,document.body.style.overflow="hidden"},k=()=>{T.value=null,document.body.style.overflow=""},L=y=>{y.key==="Escape"&&T.value&&k()};return qe(()=>{window.addEventListener("keydown",L),pe(()=>A(!1))}),Pe(()=>{window.removeEventListener("keydown",L),document.body.style.overflow=""}),(y,l)=>(m(),D("div",{ref_key:"scrollContainerRef",ref:u,class:"flex-1 overflow-y-auto px-4 py-4",onScroll:N},[e.hasMore&&!e.isLoading?(m(),D("div",Gs,[i("button",{onClick:l[0]||(l[0]=a=>y.$emit("load-more")),class:"text-sm text-indigo-600 hover:text-indigo-700 font-medium"}," Загрузить ранние сообщения ")])):H("",!0),e.isLoading&&e.messages.length>0?(m(),D("div",Js,[B(O(Me),{class:"w-5 h-5 text-indigo-600 animate-spin"})])):H("",!0),!e.isLoading&&e.messages.length===0?(m(),D("div",Ks,[B(Ye,{type:"no-messages"})])):(m(),J(Fe,{key:3,tag:"div",class:"space-y-4",name:h.value?"msg":"",css:h.value},{default:re(()=>[(m(!0),D(ce,null,Ie(e.messages,a=>(m(),J(Ps,{key:a.id,message:a,onRetry:r=>y.$emit("retry",a.id),onImageClick:p},null,8,["message","onRetry"]))),128))]),_:1},8,["name","css"])),e.isStreaming?(m(),D("div",Xs,[...l[2]||(l[2]=[nt('<div class="flex gap-1" data-v-50b57f6b><span class="w-2 h-2 bg-indigo-400 rounded-full animate-bounce" style="animation-delay:0ms;" data-v-50b57f6b></span><span class="w-2 h-2 bg-indigo-400 rounded-full animate-bounce" style="animation-delay:150ms;" data-v-50b57f6b></span><span class="w-2 h-2 bg-indigo-400 rounded-full animate-bounce" style="animation-delay:300ms;" data-v-50b57f6b></span></div><span class="text-xs" data-v-50b57f6b>Агент печатает...</span>',2)])])):H("",!0),B(ve,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"opacity-0 translate-y-4","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition duration-150 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-4"},{default:re(()=>[_.value?(m(),D("button",{key:0,onClick:f,class:"fixed bottom-24 left-1/2 -translate-x-1/2 lg:left-auto lg:translate-x-0 lg:right-8 px-4 py-2 bg-indigo-600 text-white rounded-full text-sm font-medium shadow-lg hover:bg-indigo-700 transition-colors flex items-center gap-2 z-10"},[B(O(kt),{class:"w-4 h-4"}),l[3]||(l[3]=me(" Новые сообщения ",-1))])):H("",!0)]),_:1}),(m(),J(De,{to:"body"},[B(ve,{name:"lightbox-fade"},{default:re(()=>[T.value?(m(),D("div",{key:0,class:"fixed inset-0 z-[200] bg-black/90 flex items-center justify-center p-4",onClick:k},[i("button",{onClick:k,class:"absolute top-4 right-4 p-2 text-white/80 hover:text-white transition-colors"},[B(O(at),{class:"w-6 h-6"})]),i("img",{src:T.value,class:"max-w-full max-h-full object-contain",onClick:l[1]||(l[1]=Te(()=>{},["stop"]))},null,8,Ys)])):H("",!0)]),_:1})]))],544))}}),Zs=Ce(Qs,[["__scopeId","data-v-50b57f6b"]]),en={class:"bg-white border-t border-slate-200 px-4 py-3 flex-shrink-0"},tn={key:0,class:"mb-3 px-3 py-2 bg-emerald-50 border border-emerald-200 rounded-lg flex items-center gap-2"},sn={class:"flex items-end gap-2"},nn=["disabled"],an={class:"flex-1 relative"},on=["disabled"],ln={disabled:!0,class:"p-2.5 rounded-xl text-slate-400 cursor-not-allowed transition-colors flex-shrink-0",title:"Голосовое сообщение (скоро)"},rn=["disabled"],cn={key:1,class:"mt-1 text-right"},un=ae({__name:"MessageComposer",props:{isSending:{type:Boolean},isStreaming:{type:Boolean},agentEnabled:{type:Boolean}},emits:["send","attach-image"],setup(e,{emit:s}){const u=e,_=s,b=E(null),T=E(null),h=E(""),N=W(()=>h.value.trim().length>0&&h.value.length<=4e3&&!u.isSending&&!u.isStreaming),A=()=>{N.value&&(_("send",h.value.trim()),h.value="",pe(()=>{var y;p(),(y=b.value)==null||y.focus()}))},f=y=>{y.key==="Enter"&&!y.shiftKey&&(y.preventDefault(),A())},p=()=>{b.value&&(b.value.style.height="auto",b.value.style.height=`${Math.min(b.value.scrollHeight,150)}px`)},k=()=>{var y;(y=T.value)==null||y.click()},L=y=>{var r;const l=y.target,a=(r=l.files)==null?void 0:r[0];a&&_("attach-image",a),l.value=""};return Q(h,y=>{y||pe(p)}),(y,l)=>(m(),D("div",en,[e.agentEnabled?H("",!0):(m(),D("div",tn,[B(O(ht),{class:"w-4 h-4 text-emerald-600 flex-shrink-0"}),l[1]||(l[1]=i("span",{class:"text-xs text-emerald-700"}," Режим менеджера. Сообщения будут отправлены от вашего имени. ",-1))])),i("div",sn,[i("button",{onClick:k,disabled:e.isSending||e.isStreaming,class:"p-2.5 rounded-xl text-slate-500 hover:text-slate-700 hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex-shrink-0",title:"Прикрепить изображение"},[B(O(St),{class:"w-5 h-5"})],8,nn),i("input",{ref_key:"fileInputRef",ref:T,type:"file",accept:"image/*",class:"hidden",onChange:L},null,544),i("div",an,[Ee(i("textarea",{ref_key:"textareaRef",ref:b,"onUpdate:modelValue":l[0]||(l[0]=a=>h.value=a),onKeydown:f,onInput:p,disabled:e.isSending||e.isStreaming,placeholder:"Напишите сообщение...",rows:"1",class:"w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm resize-none placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed transition-all",style:{maxHeight:"150px"}},null,40,on),[[je,h.value]])]),i("button",ln,[B(O(Mt),{class:"w-5 h-5"})]),i("button",{onClick:A,disabled:!N.value,class:"p-2.5 rounded-xl bg-indigo-600 text-white hover:bg-indigo-700 disabled:bg-slate-300 disabled:cursor-not-allowed transition-colors flex-shrink-0",title:"Отправить"},[e.isSending?(m(),J(O(Me),{key:0,class:"w-5 h-5 animate-spin"})):(m(),J(O(bt),{key:1,class:"w-5 h-5"}))],8,rn)]),h.value.length>500?(m(),D("div",cn,[i("span",{class:G(["text-xs",h.value.length>4e3?"text-red-500":"text-slate-400"])},q(h.value.length)+" / 4000 ",3)])):H("",!0)]))}}),dn={class:"flex-1 flex flex-col h-full overflow-hidden"},gn={key:0,class:"px-4 py-2 bg-red-50 border-b border-red-200 text-red-700 text-sm flex items-center gap-2"},fn=ae({__name:"ChatArea",props:{dialogId:{},agent:{},wsSendMessage:{type:Function},isWsConnected:{type:Boolean}},emits:["back"],setup(e){const s=e,{messagesMap:u,fetchMessages:_,sendMessage:b,sendManagerMessage:T,retryMessage:h,createOptimisticMessage:N,markMessageFailed:A,isLoading:f,isSending:p,isStreaming:k,error:L,dialogHasMore:y}=Xe(),{markAsRead:l,getDialogById:a}=xe(),r=W(()=>u[s.dialogId]??[]),d=W(()=>a(s.dialogId)),U=W(()=>y(s.dialogId)),I=W(()=>{var o;return(((o=d.value)==null?void 0:o.agent_status)??"active")==="active"}),M=async()=>{console.log("[ChatArea] loadMessages for dialog:",s.dialogId,"agent:",s.agent.id),await _(s.agent.id,s.dialogId,{limit:50}),console.log("[ChatArea] Messages loaded, count:",r.value.length,"error:",L.value),l(s.dialogId)},c=async()=>{const o=r.value[0];o&&await _(s.agent.id,s.dialogId,{before:o.id,limit:30})},t=async o=>{if(!I.value){await T(s.agent.id,s.dialogId,o);return}if(s.isWsConnected&&s.wsSendMessage){const v=N(s.dialogId,o,"text");s.wsSendMessage(s.dialogId,o)||A(s.dialogId,v,"WebSocket отключен")}else await b(s.agent.id,s.dialogId,o,"text",I.value)},n=async o=>{},x=async o=>{await h(s.agent.id,s.dialogId,o,I.value)};return Q(()=>s.dialogId,()=>M(),{immediate:!0}),(o,v)=>(m(),D("div",dn,[B(Ts,{agent:e.agent,dialog:d.value,"is-streaming":O(k),onBack:v[0]||(v[0]=C=>o.$emit("back"))},null,8,["agent","dialog","is-streaming"]),O(L)?(m(),D("div",gn,[v[1]||(v[1]=i("span",{class:"font-medium"},"Ошибка загрузки:",-1)),i("span",null,q(O(L)),1),i("button",{onClick:M,class:"ml-auto text-red-600 hover:text-red-800 underline text-xs"}," Повторить ")])):H("",!0),B(Zs,{"dialog-id":e.dialogId,messages:r.value,"is-loading":O(f),"is-streaming":O(k),"has-more":U.value,onLoadMore:c,onRetry:x},null,8,["dialog-id","messages","is-loading","is-streaming","has-more"]),B(un,{"is-sending":O(p),"is-streaming":O(k),"agent-enabled":I.value,onSend:t,onAttachImage:n},null,8,["is-sending","is-streaming","agent-enabled"])]))}}),mn={class:"fixed inset-0 top-[60px] lg:left-16 xl:left-64 flex overflow-hidden bg-muted transition-all duration-300"},Pn=ae({__name:"dialogs",setup(e){const{pageTitle:s}=Qe(),{isAuthenticated:u}=rt(),_=E(!1),b=ot(),T=lt(),{agents:h,isLoading:N,fetchAgents:A}=it(),{fetchDialogs:f,createDialog:p}=xe(),k=E(b.query.agentId||null),L=E(b.query.dialogId||null),y=E(!L.value),l=E(null),{isConnected:a,sendMessage:r,joinDialog:d,leaveDialog:U}=Et(W(()=>k.value)),I=W(()=>{if(k.value)return h.value.find(o=>o.id===k.value)}),M=async o=>{k.value=o,L.value=null,T.push({query:{...b.query,agentId:o,dialogId:void 0}}),await f(o)},c=o=>{L.value=o,y.value=!1,T.push({query:{...b.query,dialogId:o}})};Q(()=>b.query.agentId,o=>{k.value=typeof o=="string"?o:null}),Q(()=>b.query.dialogId,o=>{L.value=typeof o=="string"?o:null,L.value&&(y.value=!1)}),Q([a,L],([o,v])=>{if(!o){l.value=null;return}l.value&&l.value!==v&&(U(l.value),l.value=null),v&&l.value!==v&&(d(v)?l.value=v:console.warn("[Page] Failed to join dialog (WebSocket not ready):",v))},{immediate:!0});const t=async()=>{if(!k.value){h.value.length>0&&await M(h.value[0].id);return}const o=await p(k.value);o&&c(o.id)},n=()=>{_.value=!1,x()},x=async()=>{await A(),k.value?await f(k.value):h.value.length>0&&await M(h.value[0].id)};return Q(u,o=>{o&&x()}),qe(()=>{s.value="Диалоги",u.value?x():_.value=!0}),(o,v)=>(m(),D("div",mn,[i("div",{class:G(["w-full lg:w-80 xl:w-96 flex-shrink-0 border-r border-border bg-background",!y.value&&L.value?"hidden lg:flex lg:flex-col":"flex flex-col"])},[B(bs,{agents:O(h),"selected-agent-id":k.value,"selected-dialog-id":L.value,"is-loading":O(N),onSelectAgent:M,onSelectDialog:c,onCreateDialog:t},null,8,["agents","selected-agent-id","selected-dialog-id","is-loading"])],2),i("div",{class:G(["flex-1 flex flex-col bg-muted",y.value&&L.value?"hidden lg:flex":"flex"])},[L.value&&I.value?(m(),J(fn,{key:L.value,"dialog-id":L.value,agent:I.value,"ws-send-message":O(r),"is-ws-connected":O(a),onBack:v[0]||(v[0]=C=>y.value=!0)},null,8,["dialog-id","agent","ws-send-message","is-ws-connected"])):(m(),J(Ye,{key:1,type:"no-dialog",onCreate:t}))],2),B(_t,{"is-open":_.value,onClose:v[1]||(v[1]=C=>_.value=!1),onAuthenticated:n},null,8,["is-open"])]))}});export{Pn as default};
