import{_ as ve}from"./AgentPageShell.vue.DIWqlvF6.js";import{bY as L,m as F,o as n,c as a,a as t,b as m,u as s,A as v,F as O,C as z,t as p,p as x,s as ge,n as b,d as h,w as j,L as P,y as ye,z as be,f as Q,B as xe,b3 as he,v as we,x as ke,k as M,H as _e}from"./entry.y5yLHWNp.js";import{u as $e}from"./usePermissions.CdRrkOuC.js";import{u as Ce}from"./useAgentEditorStore.B19qal5-.js";import{C as H}from"./chevron-down.B16oYdGw.js";import{L as V}from"./loader-2.DOh2Ovky.js";import{_ as Le,d as Te,a as Se,b as Pe,c as De,T as Ae}from"./SheetDescription.vue.BF67whMY.js";import{c as Me}from"./index.DZzovHIe.js";import{C as X}from"./check.Cvom3qkX.js";import"./useAuth.BWm64aWw.js";import"./AuthModal.vue.B5p-6TVv.js";import"./eye.U_jQ_ycW.js";import"./alert-circle.SgXs8mYp.js";import"./useAgents.DCcoAIAU.js";import"./index.DzpPhL5B.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=L("BracesIcon",[["path",{d:"M8 3H7a2 2 0 0 0-2 2v5a2 2 0 0 1-2 2 2 2 0 0 1 2 2v5c0 1.1.9 2 2 2h1",key:"ezmyqa"}],["path",{d:"M16 21h1a2 2 0 0 0 2-2v-5c0-1.1.9-2 2-2a2 2 0 0 1-2-2V5a2 2 0 0 0-2-2h-1",key:"e1hn23"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=L("Code2Icon",[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=L("HashIcon",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=L("LayoutTemplateIcon",[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"9",height:"7",x:"3",y:"14",rx:"1",key:"jqznyg"}],["rect",{width:"5",height:"7",x:"16",y:"14",rx:"1",key:"q5h2i8"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=L("Maximize2Icon",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=L("Minimize2Icon",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=L("PanelRightCloseIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"15",x2:"15",y1:"3",y2:"21",key:"1hpv9i"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=L("PanelRightOpenIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"15",x2:"15",y1:"3",y2:"21",key:"1hpv9i"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=L("RotateCcwIcon",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),ee={create:"Создание агента",update:"Обновление",publish:"Публикация",manual:"Ручное изменение"},Fe={class:"flex flex-col min-h-0"},Ie={class:"overflow-hidden"},Ne={class:"p-4 pt-0 space-y-3"},Ue={key:0,class:"flex justify-center py-4"},qe={key:1,class:"text-[11px] text-muted-foreground text-center py-2"},Ye=["onClick"],Ge={class:"flex justify-between items-start mb-0.5"},We={class:"text-xs font-medium text-foreground"},Je={class:"text-[10px] text-muted-foreground font-mono"},Ke={class:"flex items-center gap-1.5 mb-1"},Qe={key:0,class:"text-[9px] font-bold text-primary uppercase"},Xe={key:0,class:"text-[11px] text-muted-foreground line-clamp-2 mb-1"},Ze={class:"text-[10px] text-muted-foreground/60"},et=["onClick","disabled"],tt=["disabled"],ot=F({__name:"SystemPromptHistorySection",props:{isOpen:{type:Boolean},versions:{},isLoading:{type:Boolean},isLoadingMore:{type:Boolean},isActivating:{type:Boolean},hasMore:{type:Boolean}},emits:["toggle","preview","activate","load-more"],setup(l,{emit:u}){const g=u,w=()=>{g("toggle")},y=c=>ee[c]??c,B=c=>{const d=new Date(c);if(Number.isNaN(d.getTime()))return c;const r=new Date,f=d.toDateString()===r.toDateString(),T=new Date(r);T.setDate(T.getDate()-1);const D=d.toDateString()===T.toDateString(),A=d.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"});return f?`Сегодня, ${A}`:D?`Вчера, ${A}`:d.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})+`, ${A}`};return(c,d)=>(n(),a("div",Fe,[t("button",{onClick:w,class:"w-full flex items-center justify-between p-4 hover:bg-muted/10 transition-colors shrink-0"},[d[1]||(d[1]=t("h3",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wider"},"История версий",-1)),m(s(H),{class:v(["w-4 h-4 text-muted-foreground transition-transform duration-200",{"rotate-180":l.isOpen}])},null,8,["class"])]),t("div",{class:v(["grid transition-all duration-300 ease-in-out",l.isOpen?"grid-rows-[1fr] opacity-100":"grid-rows-[0fr] opacity-0"])},[t("div",Ie,[t("div",Ne,[l.isLoading?(n(),a("div",Ue,[m(s(V),{class:"w-4 h-4 animate-spin text-muted-foreground"})])):l.versions.length?(n(),a(O,{key:2},[(n(!0),a(O,null,z(l.versions,r=>(n(),a("div",{key:r.id,class:v(["relative pl-4 pb-3 last:pb-0 cursor-pointer group",r.is_active?"border-l-2 border-primary":"border-l-2 border-muted"]),onClick:f=>c.$emit("preview",r)},[t("div",{class:v(["absolute -left-[5px] top-0.5 w-2 h-2 rounded-full",r.is_active?"bg-primary border-2 border-primary":"bg-background border-2 border-muted-foreground/50"])},null,2),t("div",Ge,[t("span",We,p(B(r.created_at)),1),t("span",Je,"v."+p(r.version_number),1)]),t("div",Ke,[t("span",{class:v(["text-[9px] font-semibold uppercase tracking-wider px-1 py-0.5 rounded",{"bg-emerald-100 text-emerald-700":r.triggered_by==="publish","bg-blue-100 text-blue-700":r.triggered_by==="update","bg-violet-100 text-violet-700":r.triggered_by==="manual","bg-slate-100 text-slate-600":r.triggered_by==="create"}])},p(y(r.triggered_by)),3),r.is_active?(n(),a("span",Qe,"Активна")):x("",!0)]),r.change_summary?(n(),a("p",Xe,p(r.change_summary),1)):x("",!0),t("p",Ze,p(r.prompt_length)+" симв.",1),r.is_active?x("",!0):(n(),a("button",{key:1,onClick:ge(f=>c.$emit("activate",r),["stop"]),disabled:l.isActivating,class:"mt-1 text-[10px] font-medium text-primary hover:underline disabled:opacity-50"}," Восстановить ",8,et))],10,Ye))),128)),l.hasMore?(n(),a("button",{key:0,onClick:d[0]||(d[0]=r=>c.$emit("load-more")),disabled:l.isLoadingMore,class:"w-full text-center text-[10px] font-medium text-primary hover:underline disabled:opacity-50 py-2"},[l.isLoadingMore?(n(),b(s(V),{key:0,class:"w-3 h-3 animate-spin inline mr-1"})):x("",!0),d[2]||(d[2]=h(" Загрузить ещё ",-1))],8,tt)):x("",!0)],64)):(n(),a("p",qe," История промпта пока пуста "))])])],2)]))}}),st={key:0},nt={key:0,class:"ml-1 text-primary font-bold"},rt={key:0,class:"flex justify-center py-12"},it={key:0,class:"text-sm text-muted-foreground mt-4 mb-2 italic"},at={class:"mt-4 p-3 rounded-md bg-muted/30 border border-border max-h-[60vh] overflow-y-auto"},lt={class:"text-xs text-foreground whitespace-pre-wrap font-mono leading-relaxed"},dt={key:1,class:"mt-6 flex gap-3"},ct=["disabled"],ut=F({__name:"SystemPromptVersionPreview",props:{open:{type:Boolean},version:{},isLoading:{type:Boolean},isActivating:{type:Boolean},canActivate:{type:Boolean}},emits:["update:open","activate"],setup(l,{emit:u}){const g=l,w=u,y=P({get:()=>g.open,set:d=>w("update:open",d)}),B=d=>ee[d]??d,c=d=>{const r=new Date(d);if(Number.isNaN(r.getTime()))return d;const f=new Date,T=r.toDateString()===f.toDateString(),D=new Date(f);D.setDate(D.getDate()-1);const A=r.toDateString()===D.toDateString(),$=r.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"});return T?`Сегодня, ${$}`:A?`Вчера, ${$}`:r.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})+`, ${$}`};return(d,r)=>(n(),b(s(Le),{open:y.value,"onUpdate:open":r[1]||(r[1]=f=>y.value=f)},{default:j(()=>[m(s(Te),{side:"right",class:"w-full sm:max-w-lg overflow-y-auto"},{default:j(()=>[m(s(Se),null,{default:j(()=>[m(s(Pe),null,{default:j(()=>{var f;return[h(" Версия #"+p((f=l.version)==null?void 0:f.version_number),1)]}),_:1}),m(s(De),null,{default:j(()=>[l.version?(n(),a("span",st,[h(p(c(l.version.created_at))+" · "+p(B(l.version.triggered_by))+" ",1),l.version.is_active?(n(),a("span",nt,"(активна)")):x("",!0)])):x("",!0)]),_:1})]),_:1}),l.isLoading?(n(),a("div",rt,[m(s(V),{class:"w-5 h-5 animate-spin text-muted-foreground"})])):l.version?(n(),a(O,{key:1},[l.version.change_summary?(n(),a("p",it," « "+p(l.version.change_summary)+" » ",1)):x("",!0),t("div",at,[t("pre",lt,p(l.version.system_prompt),1)]),!l.version.is_active&&l.canActivate?(n(),a("div",dt,[t("button",{onClick:r[0]||(r[0]=f=>d.$emit("activate")),disabled:l.isActivating,class:"flex-1 px-4 py-2.5 bg-primary text-primary-foreground rounded-lg text-sm font-medium hover:bg-primary/90 disabled:opacity-50 transition-colors flex items-center justify-center gap-2"},[l.isActivating?(n(),b(s(V),{key:0,class:"w-4 h-4 animate-spin"})):(n(),b(s(Z),{key:1,class:"w-4 h-4"})),r[2]||(r[2]=h(" Восстановить эту версию ",-1))],8,ct)])):x("",!0)],64)):x("",!0)]),_:1})]),_:1},8,["open"]))}}),mt={class:"flex-1 flex flex-col bg-background rounded-md border border-border overflow-hidden min-w-0 min-h-0"},pt={class:"flex items-center justify-between px-4 py-3 border-b border-border bg-background"},ft={class:"flex items-center gap-2"},vt={type:"button",disabled:"",class:"inline-flex items-center justify-center gap-2 px-3 py-1.5 bg-primary/10 text-primary rounded-md text-xs font-medium opacity-50 cursor-not-allowed"},gt={type:"button",disabled:"",class:"inline-flex items-center justify-center gap-2 px-3 py-1.5 bg-background border border-border text-muted-foreground rounded-md text-xs font-medium opacity-50 cursor-not-allowed"},yt={class:"flex items-center gap-1"},bt=["title"],xt=["title"],ht={class:"px-6 py-2 bg-muted/50 border-b border-border flex justify-between items-center"},wt={class:"flex items-center gap-3"},kt={key:0,class:"flex items-center gap-1.5 text-[10px] text-blue-600"},_t={key:1,class:"flex items-center gap-1.5 text-[10px] text-amber-600"},$t={key:2,class:"flex items-center gap-1.5 text-[10px] text-green-600"},Ct={class:"text-[10px] text-muted-foreground font-mono"},Lt={class:"border-b border-border"},Tt={class:"flex items-center gap-1.5 text-[10px] font-semibold text-muted-foreground uppercase tracking-wider"},St={class:"px-4 py-3 bg-muted/10 space-y-2.5"},Pt={class:"flex flex-wrap gap-1"},Dt=["onClick"],At={key:0,class:"absolute top-full left-1/2 -translate-x-1/2 mt-1.5 px-2.5 py-1 bg-white border border-slate-200 text-slate-600 text-[10px] rounded-md shadow-md whitespace-nowrap opacity-0 invisible group-hover/tag:opacity-100 group-hover/tag:visible transition-all duration-150 pointer-events-none z-50"},Mt={class:"flex-1 relative bg-background"},Ot=["disabled"],Bt={key:0,class:"flex items-center justify-between px-4 py-2 border-t border-border bg-background"},jt={class:"text-xs text-muted-foreground"},Vt={class:"flex items-center gap-2"},Rt=["disabled"],zt={class:"min-w-0 overflow-hidden"},Et={class:"w-80 bg-card rounded-md border border-border text-card-foreground flex flex-col overflow-hidden max-w-full h-full"},Ht={class:"flex-1 overflow-y-auto flex flex-col"},Ft={class:"border-b border-border"},It={class:"overflow-hidden"},Nt={class:"p-4 pt-0 bg-muted/30"},Ut={class:"space-y-1"},qt=["onClick"],Yt={class:"text-xs text-primary font-medium bg-primary/10 px-1.5 py-0.5 rounded"},Gt={class:"text-[10px] text-muted-foreground"},Wt={key:0,class:"border-b border-border"},Jt={class:"overflow-hidden"},Kt={class:"p-4 pt-0 bg-muted/30"},Qt={class:"space-y-1"},Xt=["onClick"],Zt={class:"text-xs text-emerald-600 font-medium bg-emerald-500/10 px-1.5 py-0.5 rounded"},eo=F({__name:"AgentPromptPanel",setup(l){const u=Ce(),{form:g,agent:w,isPromptFullscreen:y,promptSidebarTools:B,promptHistory:c}=ye(u),{canEditAgents:d}=$e(),{success:r,error:f}=be(),T=P(()=>w.value?g.value.system_prompt!==w.value.system_prompt:!1),D=()=>{u.isPromptFocused=!0},A=async()=>{u.isPromptFocused=!1,T.value&&d.value&&await u.autoSavePrompt()},$=M(!0),I=M(!0);let N=null;Q($,o=>{N&&clearTimeout(N),o?N=setTimeout(()=>{I.value=!0},320):I.value=!1});const R=M(typeof window<"u"&&window.innerWidth<1024),_=M(["history"]),E=M(!1),S=M(null),U=M(!1),te=P(()=>{var o;return((o=c.value)==null?void 0:o.versions)??[]}),oe=P(()=>{var o;return((o=c.value)==null?void 0:o.isLoading)??!1}),se=P(()=>{var o;return((o=c.value)==null?void 0:o.isLoadingMore)??!1}),G=P(()=>{var o;return((o=c.value)==null?void 0:o.isActivating)??!1}),ne=P(()=>{var e;const o=(e=c.value)==null?void 0:e.nextCursor;return o!=null}),re=[{id:"markdown",label:"Markdown",color:"blue",tags:[{label:"# Заголовок",value:"# ",hint:"Заголовок первого уровня"},{label:"## Подзаголовок",value:"## ",hint:"Заголовок второго уровня"}]},{id:"structure",label:"Структура",color:"violet",tags:[{label:"goal",value:`<goal>

</goal>`,cursorOffset:7,hint:"Цель и задача агента"},{label:"role",value:`<role>

</role>`,cursorOffset:7,hint:"Роль и персона агента"},{label:"context",value:`<context>

</context>`,cursorOffset:10,hint:"Контекст и знания"},{label:"instructions",value:`<instructions>

</instructions>`,cursorOffset:15,hint:"Инструкции поведения"},{label:"examples",value:`<examples>

</examples>`,cursorOffset:11,hint:"Примеры диалогов"},{label:"format",value:`<output_format>

</output_format>`,cursorOffset:16,hint:"Формат ответов"}]},{id:"behavior",label:"Поведение",color:"emerald",tags:[{label:"style",value:`<style>

</style>`,cursorOffset:8,hint:"Стиль общения"},{label:"constraints",value:`<constraints>

</constraints>`,cursorOffset:14,hint:"Ограничения и запреты"},{label:"flow",value:`<flow>

</flow>`,cursorOffset:7,hint:"Сценарий диалога"},{label:"fallback",value:`<fallback>

</fallback>`,cursorOffset:11,hint:"Действия при ошибках"},{label:"tools",value:`<tools>

</tools>`,cursorOffset:8,hint:"Описание инструментов"}]},{id:"custom",label:"Свой",color:"neutral",tags:[{label:"Свой тег",value:`<>

</>`,cursorOffset:1,hint:"Пустой тег — впишите своё название"}]}],ie=[{name:"{client_name}",description:"Имя клиента"},{name:"{clinic_phone}",description:"Телефон клиники"},{name:"{service_list}",description:"Список услуг"},{name:"{current_date}",description:"Текущая дата"}],ae=P(()=>{const o=g.value.system_prompt||"";if(!o)return 0;const e=(o.match(/[\u0400-\u04FF]/g)||[]).length,k=o.length-e;return Math.ceil(e/1.5+k/4)}),q=(o,e)=>{const k=document.querySelector('textarea[placeholder="Ты — дружелюбный и профессиональный ассистент клиники..."]');if(k){const i=k.selectionStart,C=k.selectionEnd,W=k.scrollTop,J=g.value.system_prompt;g.value.system_prompt=J.substring(0,i)+o+J.substring(C),_e(()=>{k.focus({preventScroll:!0}),k.scrollTop=W;const K=i+(e!==void 0?e:o.length);k.setSelectionRange(K,K)})}else g.value.system_prompt+=(g.value.system_prompt?`
`:"")+o},le=(o,e)=>{q(`${o}()`),r("Инструмент добавлен",`Инструмент ${o}() вставлен`)},de=o=>{q(o.value,o.cursorOffset),r("Тег добавлен",`${o.label} вставлен`)},Y=async o=>{const e=_.value.indexOf(o);e===-1?_.value.push(o):_.value.splice(e,1),o==="functions"&&(await u.ensureToolsLoaded(),await u.ensureSqnsStatusLoaded())},ce=async()=>{await Y("history"),_.value.includes("history")&&await u.ensurePromptHistoryLoaded()},ue=()=>{var o;(o=c.value)==null||o.fetchMore()},me=async o=>{if(c.value){E.value=!0,U.value=!0,S.value=null;try{const e=await c.value.fetchVersionDetail(o.id);S.value=e}catch(e){f("Версия не найдена",e.message||""),E.value=!1}finally{U.value=!1}}},pe=async o=>{if(c.value&&confirm(`Текущий промпт будет заменён на версию #${o.version_number}. Продолжить?`))try{const e=await c.value.activateVersion(o.id);e&&(g.value.system_prompt=e.system_prompt,w.value&&(w.value.system_prompt=e.system_prompt),r("Версия восстановлена",`Активирована версия #${e.version_number}`))}catch(e){f("Не удалось активировать",e.message||"")}},fe=async()=>{if(!(!c.value||!S.value)&&confirm(`Текущий промпт будет заменён на версию #${S.value.version_number}. Продолжить?`))try{const o=await c.value.activateVersion(S.value.id);o&&(g.value.system_prompt=o.system_prompt,w.value&&(w.value.system_prompt=o.system_prompt),S.value={...S.value,is_active:!0},r("Версия восстановлена",`Активирована версия #${o.version_number}`))}catch(o){f("Не удалось активировать",o.message||"")}};if(typeof window<"u"){const o=e=>{e.key==="Escape"&&y.value&&(y.value=!1)};xe(()=>window.addEventListener("keydown",o)),he(()=>{window.removeEventListener("keydown",o),y.value=!1})}return Q(w,o=>{o&&(u.ensureToolsLoaded(),u.ensureSqnsStatusLoaded(),_.value.includes("history")&&u.ensurePromptHistoryLoaded())},{immediate:!0}),(o,e)=>{var k;return n(),a("div",{class:v(["flex flex-col lg:flex-row gap-4 transition-all duration-300",s(y)?"fixed inset-0 z-[100] bg-slate-50 p-4 lg:p-6":"h-[calc(100vh-280px)] min-h-[600px]"])},[t("div",mt,[t("div",pt,[t("div",ft,[t("button",vt,[m(s(Me),{class:"h-3.5 w-3.5"}),e[10]||(e[10]=h(" Улучшить с AI ",-1))]),t("button",gt,[m(s(Ve),{class:"h-3.5 w-3.5"}),e[11]||(e[11]=h(" Шаблоны ",-1))])]),t("div",yt,[t("button",{type:"button",onClick:e[0]||(e[0]=i=>s(u).resetPrompt()),class:"inline-flex items-center justify-center gap-2 px-3 py-1.5 text-muted-foreground hover:text-foreground hover:bg-accent rounded-md text-xs font-medium transition-colors",title:"Сбросить"},[m(s(Z),{class:"h-3.5 w-3.5"}),e[12]||(e[12]=t("span",{class:"hidden sm:inline"},"Сбросить",-1))]),t("button",{type:"button",onClick:e[1]||(e[1]=i=>R.value=!R.value),class:"inline-flex items-center justify-center p-1.5 text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors",title:R.value?"Показать панель":"Скрыть панель"},[R.value?(n(),b(s(He),{key:0,class:"h-3.5 w-3.5"})):(n(),b(s(Ee),{key:1,class:"h-3.5 w-3.5"}))],8,bt),t("button",{type:"button",onClick:e[2]||(e[2]=i=>y.value=!s(y)),class:"inline-flex items-center justify-center p-1.5 text-muted-foreground hover:text-foreground hover:bg-accent rounded-md transition-colors",title:s(y)?"Свернуть":"Развернуть"},[s(y)?(n(),b(s(ze),{key:0,class:"h-3.5 w-3.5"})):(n(),b(s(Re),{key:1,class:"h-3.5 w-3.5"}))],8,xt)])]),t("div",ht,[e[16]||(e[16]=t("span",{class:"text-[10px] font-bold text-muted-foreground uppercase tracking-widest"},"Редактор подсказок",-1)),t("div",wt,[s(u).isAutoSaving?(n(),a("span",kt,[m(s(V),{class:"h-3 w-3 animate-spin"}),e[13]||(e[13]=h(" Сохранение... ",-1))])):T.value?(n(),a("span",_t,[...e[14]||(e[14]=[t("div",{class:"h-1.5 w-1.5 bg-amber-400 rounded-full animate-pulse"},null,-1),h(" Несохранено ",-1)])])):s(u).lastAutoSavedAt?(n(),a("span",$t,[m(s(X),{class:"h-3 w-3"}),e[15]||(e[15]=h(" Сохранено ",-1))])):x("",!0),t("span",Ct,"~"+p(ae.value)+" токенов",1)])]),t("div",Lt,[t("button",{onClick:e[3]||(e[3]=i=>$.value=!$.value),class:"w-full flex items-center justify-between px-4 py-2 bg-muted/20 hover:bg-muted/30 transition-colors"},[t("span",Tt,[m(s(Ae),{class:"w-3 h-3"}),e[17]||(e[17]=h(" Быстрые теги ",-1))]),m(s(H),{class:v(["w-3.5 h-3.5 text-muted-foreground transition-transform duration-200",{"rotate-180":$.value}])},null,8,["class"])]),t("div",{class:v(["grid transition-all duration-300 ease-in-out",$.value?"grid-rows-[1fr] opacity-100":"grid-rows-[0fr] opacity-0"])},[t("div",{class:v(I.value?"overflow-visible":"overflow-hidden")},[t("div",St,[(n(),a(O,null,z(re,i=>t("div",{key:i.id,class:"flex items-start gap-2"},[t("span",{class:v(["shrink-0 mt-0.5 text-[9px] font-semibold uppercase tracking-wider w-[70px] text-right",{"text-blue-500":i.color==="blue","text-violet-500":i.color==="violet","text-emerald-500":i.color==="emerald","text-muted-foreground":i.color==="neutral"}])},p(i.label),3),t("div",Pt,[(n(!0),a(O,null,z(i.tags,C=>(n(),a("div",{key:C.label,class:"relative group/tag"},[t("button",{onClick:W=>de(C),class:v(["inline-flex items-center gap-1 px-2 py-0.5 rounded border text-[10px] font-medium transition-colors",{"border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100 dark:border-blue-800 dark:bg-blue-950 dark:text-blue-300 dark:hover:bg-blue-900":i.color==="blue","border-violet-200 bg-violet-50 text-violet-700 hover:bg-violet-100 dark:border-violet-800 dark:bg-violet-950 dark:text-violet-300 dark:hover:bg-violet-900":i.color==="violet","border-emerald-200 bg-emerald-50 text-emerald-700 hover:bg-emerald-100 dark:border-emerald-800 dark:bg-emerald-950 dark:text-emerald-300 dark:hover:bg-emerald-900":i.color==="emerald","border-border bg-background text-muted-foreground hover:bg-accent hover:text-accent-foreground":i.color==="neutral"}])},[i.color==="blue"?(n(),b(s(je),{key:0,class:"w-2.5 h-2.5"})):i.color==="violet"||i.color==="emerald"?(n(),b(s(Be),{key:1,class:"w-2.5 h-2.5"})):(n(),b(s(Oe),{key:2,class:"w-2.5 h-2.5"})),h(" "+p(C.label),1)],10,Dt),C.hint?(n(),a("div",At,[h(p(C.hint)+" ",1),e[18]||(e[18]=t("div",{class:"absolute bottom-full left-1/2 -translate-x-1/2 border-4 border-transparent border-b-white drop-shadow-sm"},null,-1))])):x("",!0)]))),128))])])),64))])],2)],2)]),t("div",Mt,[we(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=i=>s(g).system_prompt=i),disabled:!s(d),onFocus:D,onBlur:A,class:"w-full h-full p-6 text-sm text-foreground leading-relaxed resize-none focus:outline-none focus:ring-0 border-0 bg-transparent font-mono placeholder:text-muted-foreground",placeholder:"Ты — дружелюбный и профессиональный ассистент клиники...",spellcheck:"false"},null,40,Ot),[[ke,s(g).system_prompt]])]),s(y)&&s(d)?(n(),a("div",Bt,[t("span",jt,p((k=s(w))==null?void 0:k.name),1),t("div",Vt,[t("button",{onClick:e[5]||(e[5]=i=>y.value=!1),class:"px-4 py-1.5 text-xs text-muted-foreground hover:text-foreground transition-colors"}," Свернуть "),t("button",{onClick:e[6]||(e[6]=i=>s(u).saveAgent()),disabled:s(u).isSaving,class:"px-5 py-1.5 bg-indigo-600 text-white rounded-md text-xs font-medium hover:bg-indigo-700 disabled:opacity-50 transition-colors flex items-center gap-1.5"},[s(u).isSaving?(n(),b(s(V),{key:0,class:"h-3 w-3 animate-spin"})):(n(),b(s(X),{key:1,class:"h-3 w-3"})),e[19]||(e[19]=h(" Сохранить ",-1))],8,Rt)])])):x("",!0)]),t("div",{class:v(["grid transition-all duration-300 ease-out shrink-0 overflow-hidden",R.value?"grid-cols-[0fr] opacity-0":"grid-cols-[1fr] opacity-100"])},[t("div",zt,[t("div",Et,[t("div",Ht,[t("div",Ft,[t("button",{onClick:e[7]||(e[7]=i=>Y("variables")),class:"w-full flex items-center justify-between p-4 bg-muted/30 hover:bg-muted/50 transition-colors"},[e[20]||(e[20]=t("h3",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wider"},"Переменные",-1)),m(s(H),{class:v(["w-4 h-4 text-muted-foreground transition-transform duration-200",{"rotate-180":_.value.includes("variables")}])},null,8,["class"])]),t("div",{class:v(["grid transition-all duration-300 ease-in-out",_.value.includes("variables")?"grid-rows-[1fr] opacity-100":"grid-rows-[0fr] opacity-0"])},[t("div",It,[t("div",Nt,[t("div",Ut,[(n(),a(O,null,z(ie,i=>t("button",{key:i.name,onClick:C=>q(i.name),class:"w-full flex items-center justify-between px-2 py-1.5 rounded hover:bg-background group transition-colors text-left"},[t("code",Yt,p(i.name),1),t("span",Gt,p(i.description),1)],8,qt)),64))])])])],2)]),s(B).length?(n(),a("div",Wt,[t("button",{onClick:e[8]||(e[8]=i=>Y("functions")),class:"w-full flex items-center justify-between p-4 bg-muted/30 hover:bg-muted/50 transition-colors"},[e[21]||(e[21]=t("h3",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wider"},"Функции",-1)),m(s(H),{class:v(["w-4 h-4 text-muted-foreground transition-transform duration-200",{"rotate-180":_.value.includes("functions")}])},null,8,["class"])]),t("div",{class:v(["grid transition-all duration-300 ease-in-out",_.value.includes("functions")?"grid-rows-[1fr] opacity-100":"grid-rows-[0fr] opacity-0"])},[t("div",Jt,[t("div",Kt,[t("div",Qt,[(n(!0),a(O,null,z(s(B),i=>(n(),a("button",{key:i.name,onClick:C=>le(i.name,i.description),class:"w-full flex items-center justify-between px-2 py-1.5 rounded hover:bg-background group transition-colors text-left"},[t("code",Zt,p(i.name)+"()",1),e[22]||(e[22]=t("span",{class:"text-[10px] text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"},"+ вставить",-1))],8,Xt))),128))])])])],2)])):x("",!0),m(s(ot),{"is-open":_.value.includes("history"),versions:te.value,"is-loading":oe.value,"is-loading-more":se.value,"is-activating":G.value,"has-more":ne.value,onToggle:ce,onPreview:me,onActivate:pe,onLoadMore:ue},null,8,["is-open","versions","is-loading","is-loading-more","is-activating","has-more"]),m(s(ut),{open:E.value,"onUpdate:open":e[9]||(e[9]=i=>E.value=i),version:S.value,"is-loading":U.value,"is-activating":G.value,"can-activate":s(d),onActivate:fe},null,8,["open","version","is-loading","is-activating","can-activate"])])])])],2)],2)}}}),yo=F({__name:"prompt",setup(l){return(u,g)=>(n(),b(ve,{title:"Системный промпт","hide-actions":!0},{default:j(()=>[m(eo)]),_:1}))}});export{yo as default};
