import{M as N,_ as z,K as S}from"./DashboardSidebar.vue.B26z5fa-.js";import{_ as K}from"./AuthModal.vue.BSzxuO2s.js";import{bg as k,k as x,m as q,B as O,f as R,c as a,a as e,t as m,u as n,b as p,p as v,w as X,q as G,d as A,s as H,v as C,x as M,F as P,C as $,n as J,o,X as Q,bN as W,A as Y}from"./entry.Dw2909n2.js";import{u as F}from"./useAuth.jgUYoTAC.js";import{u as Z}from"./useApiFetch.sBSRwplN.js";import{A as ee}from"./alert-circle.CFB8cae4.js";import{P as te}from"./plus.DTMN2fIW.js";import{L as se}from"./loader-2.D-f1OOw-.js";import"./nuxt-link.t2uHRS69.js";import"./index.DT79k1l5.js";import"./floating-ui.vue.VILNG3-i.js";import"./chevron-right.Dt1o7IKv.js";import"./chevrons-up-down.C2VhQO3Y.js";import"./settings.DdVzARvN.js";import"./sparkles.CVmRtpTC.js";import"./link.DpqSbqvX.js";import"./database.CDLRhh8b.js";import"./code.CqfGPh0g.js";import"./cpu.BtB-GUA5.js";import"./message-square.C2TtVjfK.js";import"./eye.B5oT6PQ0.js";import"./authSessionManager.CAWbIGEs.js";const le=()=>{F();const _=Z(),i=x(!1),d=x(null),r=x([]),b=async u=>{try{i.value=!0,d.value=null;const l=new URLSearchParams;u!=null&&u.include_revoked&&l.append("include_revoked","true");const w=await _("/api-keys",{query:Object.fromEntries(l)});return r.value=w,w}catch(l){throw d.value=l.message||"Ошибка загрузки API-ключей",l}finally{i.value=!1}},f=async u=>{try{i.value=!0,d.value=null;const l=await _("/api-keys",{method:"POST",headers:{"Content-Type":"application/json"},body:u});return r.value.unshift(l),l}catch(l){throw d.value=l.message||"Ошибка создания API-ключа",l}finally{i.value=!1}},y=async u=>{try{i.value=!0,d.value=null,await _(`/api-keys/${u}`,{method:"DELETE"}),r.value=r.value.filter(l=>l.id!==u)}catch(l){throw d.value=l.message||"Ошибка удаления API-ключа",l}finally{i.value=!1}};return{apiKeys:k(r),isLoading:k(i),error:k(d),fetchApiKeys:b,createApiKey:f,revokeApiKey:y}},oe={class:"h-screen flex flex-col bg-slate-50 overflow-hidden"},ae={class:"lg:hidden bg-white border-b border-slate-200 px-4 py-3 shrink-0"},ne={class:"flex items-center justify-between"},ie={class:"flex items-center gap-2"},re={class:"w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center"},de={class:"text-white font-bold text-xs"},ue={class:"text-slate-900 font-bold"},ce={class:"flex flex-1 min-h-0"},me={key:0,class:"lg:hidden fixed inset-0 z-50 w-full"},pe={class:"flex-1 min-w-0 bg-slate-50 overflow-y-auto p-4 sm:p-6 lg:p-10"},ve={class:"max-w-4xl mx-auto"},xe={key:0,class:"mb-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4"},be={class:"flex items-center justify-between"},fe={class:"flex items-center"},ge={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 lg:mb-8"},ye={key:1,class:"bg-white rounded-xl border border-slate-200 p-6 mb-8"},he={class:"flex items-center justify-between mb-6"},_e={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},we={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},ke=["value"],Ae={class:"ml-2 text-sm text-slate-700"},Ce={class:"flex gap-3"},Pe=["disabled"],$e={key:2,class:"flex justify-center py-12"},Ie={key:3,class:"text-center py-12"},Le={key:4,class:"space-y-4"},je={class:"flex items-start justify-between"},Se={class:"flex-1"},Me={class:"flex items-center gap-3 mb-2"},Fe={class:"text-lg font-semibold text-slate-900"},Ue={class:"mb-3"},Ve={class:"text-xs bg-slate-100 px-2 py-1 rounded font-mono break-all"},De={class:"mb-3"},Ee={class:"flex flex-wrap gap-1"},Te={class:"text-xs text-slate-500"},Be={key:0},Ne={class:"flex flex-col gap-2 ml-4"},ze=["onClick"],ut=q({__name:"api-keys",setup(_){const i=x(!1),d=x(!1),r=x(!1),b=x(!1),{isAuthenticated:f,tenant:y}=F(),{apiKeys:u,fetchApiKeys:l,createApiKey:w,revokeApiKey:U,isLoading:V}=le(),c=x({name:"",scopes:[],expires_in_days:365}),D=[{value:"agents:read",label:"Чтение агентов"},{value:"agents:write",label:"Создание агентов"},{value:"tools:read",label:"Чтение инструментов"},{value:"tools:write",label:"Создание инструментов"},{value:"runs:read",label:"Чтение запусков"},{value:"runs:write",label:"Запуск агентов"}];O(async()=>{if(f.value)try{await l()}catch(g){console.error("Failed to load API keys:",g)}}),R(f,async g=>{g&&await l()});const E=async()=>{try{b.value=!0,await w({name:c.value.name||void 0,scopes:c.value.scopes,expires_in_days:c.value.expires_in_days}),c.value={name:"",scopes:[],expires_in_days:365},r.value=!1}catch(g){console.error("Error creating API key:",g)}finally{b.value=!1}},T=()=>{d.value=!1};return(g,t)=>{var L,j;const I=z,B=K;return o(),a("div",oe,[e("div",ae,[e("div",ne,[e("div",ie,[e("div",re,[e("span",de,m((L=n(y))!=null&&L.name?n(y).name.charAt(0).toUpperCase():"О"),1)]),e("span",ue,m(((j=n(y))==null?void 0:j.name)||"Организация"),1)]),e("button",{onClick:t[0]||(t[0]=s=>i.value=!i.value),class:"p-2 rounded-lg text-slate-600 hover:bg-slate-100"},[p(n(N),{class:"h-5 w-5"})])])]),e("div",ce,[p(I,{class:"hidden lg:flex"}),i.value?(o(),a("div",{key:0,class:"lg:hidden fixed inset-0 z-40 bg-black bg-opacity-50",onClick:t[1]||(t[1]=s=>i.value=!1)})):v("",!0),p(G,{"enter-active-class":"transition-all duration-500 cubic-bezier(0.34, 1.56, 0.64, 1)","enter-from-class":"-translate-x-full opacity-0 scale-95","enter-to-class":"translate-x-0 opacity-100 scale-100","leave-active-class":"transition-all duration-400 ease-in","leave-from-class":"translate-x-0 opacity-100 scale-100","leave-to-class":"-translate-x-full opacity-0 scale-95"},{default:X(()=>[i.value?(o(),a("div",me,[p(I,{onClose:t[2]||(t[2]=s=>i.value=!1)})])):v("",!0)]),_:1}),e("main",pe,[e("div",ve,[n(f)?v("",!0):(o(),a("div",xe,[e("div",be,[e("div",fe,[p(n(ee),{class:"h-5 w-5 text-yellow-400 mr-3"}),t[12]||(t[12]=e("div",null,[e("h3",{class:"text-sm font-medium text-yellow-800"}," Требуется аутентификация "),e("p",{class:"text-sm text-yellow-700 mt-1"}," Войдите в систему для управления API-ключами ")],-1))]),e("button",{onClick:t[3]||(t[3]=s=>d.value=!0),class:"px-4 py-2 bg-yellow-600 text-white text-sm font-medium rounded-lg hover:bg-yellow-700 transition-colors"}," Войти ")])])),e("div",ge,[t[14]||(t[14]=e("div",{class:"mb-4 sm:mb-0"},[e("h1",{class:"text-2xl sm:text-3xl font-bold text-slate-900"}," API Ключи "),e("p",{class:"text-slate-600 mt-1 sm:mt-2 text-sm sm:text-base"}," Управление вашими API-ключами для доступа к системе ")],-1)),n(f)&&!r.value?(o(),a("button",{key:0,onClick:t[4]||(t[4]=s=>r.value=!0),class:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors"},[p(n(te),{class:"h-4 w-4"}),t[13]||(t[13]=A(" Создать ключ ",-1))])):v("",!0)]),r.value?(o(),a("div",ye,[e("div",he,[t[15]||(t[15]=e("h2",{class:"text-xl font-bold text-slate-900"},"Создать новый API ключ",-1)),e("button",{onClick:t[5]||(t[5]=s=>r.value=!1),class:"p-2 text-slate-400 hover:text-slate-600 transition-colors"},[p(n(Q),{class:"h-5 w-5"})])]),e("form",{onSubmit:H(E,["prevent"]),class:"space-y-6"},[e("div",_e,[e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-slate-700 mb-2"}," Название ключа (опционально) ",-1)),C(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>c.value.name=s),type:"text",class:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Например: Ключ для разработки"},null,512),[[M,c.value.name]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-slate-700 mb-2"}," Срок действия (дни) ",-1)),C(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>c.value.expires_in_days=s),type:"number",min:"1",max:"365",class:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"365"},null,512),[[M,c.value.expires_in_days,void 0,{number:!0}]])])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-slate-700 mb-3"}," Разрешения (scopes) ",-1)),e("div",we,[(o(),a(P,null,$(D,s=>e("label",{key:s.value,class:"flex items-center"},[C(e("input",{"onUpdate:modelValue":t[8]||(t[8]=h=>c.value.scopes=h),value:s.value,type:"checkbox",class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-slate-300 rounded"},null,8,ke),[[W,c.value.scopes]]),e("span",Ae,m(s.label),1)])),64))])]),e("div",Ce,[e("button",{type:"button",onClick:t[9]||(t[9]=s=>r.value=!1),class:"flex-1 px-4 py-2 text-slate-700 bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors"}," Отмена "),e("button",{type:"submit",disabled:b.value,class:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"},[b.value?(o(),J(n(se),{key:0,class:"h-4 w-4 animate-spin"})):v("",!0),A(" "+m(b.value?"Создание...":"Создать ключ"),1)],8,Pe)])],32)])):v("",!0),n(V)?(o(),a("div",$e,[...t[19]||(t[19]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"},null,-1)])])):n(u).length===0?(o(),a("div",Ie,[p(n(S),{class:"h-12 w-12 text-slate-400 mx-auto mb-4"}),t[20]||(t[20]=e("h3",{class:"text-lg font-medium text-slate-900 mb-2"},"Нет API ключей",-1)),t[21]||(t[21]=e("p",{class:"text-slate-600 mb-4"},"Создайте свой первый API ключ для доступа к системе",-1)),n(f)?(o(),a("button",{key:0,onClick:t[10]||(t[10]=s=>r.value=!0),class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"}," Создать ключ ")):v("",!0)])):(o(),a("div",Le,[(o(!0),a(P,null,$(n(u),s=>(o(),a("div",{key:s.id,class:"bg-white rounded-xl border border-slate-200 p-6"},[e("div",je,[e("div",Se,[e("div",Me,[p(n(S),{class:"h-5 w-5 text-slate-600"}),e("h3",Fe,m(s.name||`Ключ ${s.id.slice(-8)}`),1),e("span",{class:Y(["px-2 py-1 text-xs font-medium rounded-full",s.revoked_at?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},m(s.revoked_at?"Отозван":"Активен"),3)]),e("div",Ue,[t[22]||(t[22]=e("p",{class:"text-sm text-slate-600 mb-1"},"API Ключ:",-1)),e("code",Ve,m(s.key),1)]),e("div",De,[t[23]||(t[23]=e("p",{class:"text-sm text-slate-600 mb-2"},"Разрешения:",-1)),e("div",Ee,[(o(!0),a(P,null,$(s.scopes,h=>(o(),a("span",{key:h,class:"px-2 py-1 bg-slate-100 text-slate-700 text-xs rounded-full"},m(h),1))),128))])]),e("div",Te,[A(" Создан: "+m(new Date(s.created_at).toLocaleString("ru-RU"))+" ",1),s.expires_at?(o(),a("span",Be," • Истекает: "+m(new Date(s.expires_at).toLocaleString("ru-RU")),1)):v("",!0)])]),e("div",Ne,[s.revoked_at?v("",!0):(o(),a("button",{key:0,onClick:h=>n(U)(s.id),class:"px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors text-sm"}," Отозвать ",8,ze))])])]))),128))]))])])]),p(B,{"is-open":d.value,onClose:t[11]||(t[11]=s=>d.value=!1),onAuthenticated:T},null,8,["is-open"])])}}});export{ut as default};
