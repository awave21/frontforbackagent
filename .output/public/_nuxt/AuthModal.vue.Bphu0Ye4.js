import{m as M,n as R,f as F,p as u,b as P,w as q,T as A,y as X,o as r,c,q as j,a as s,u as i,X as Z,A as g,s as v,v as C,t as k,x as d,aj as _,d as L,r as f,N as G}from"./entry.DvavCQ8-.js";import{a as H}from"./useAuth.CA-oUVg2.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=M("EyeOffIcon",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=M("EyeIcon",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=M("Loader2Icon",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),J={class:"p-6"},K={class:"flex items-center justify-between mb-6"},Q={class:"flex mb-6 bg-slate-100 rounded-lg p-1"},W={key:0,class:"mt-1 text-sm text-red-600"},Y={class:"relative"},ee=["type"],te={class:"relative"},se=["type"],le={key:0,class:"mt-1 text-sm text-red-600"},ae={key:1,class:"mt-1 text-sm text-red-600"},oe=["disabled"],re={key:0,class:"mt-1 text-sm text-red-600"},ie={class:"relative"},ne=["type"],de=["disabled"],ce=R({__name:"AuthModal",props:{isOpen:{type:Boolean}},emits:["close","authenticated"],setup(E,{emit:T}){const z=E,h=T,{register:B,login:N,isLoading:x}=H(),{error:o,success:U}=G(),l=f({}),p=f("register"),n=f({email:"",password:""}),a=f({email:"",password:"",confirmPassword:"",full_name:"",tenant_name:""}),y=f(!1),b=f(!1),w=f(!1),I=async()=>{if(l.value={},a.value.password!==a.value.confirmPassword){o("Ошибка валидации","Пароли не совпадают"),l.value.confirmPassword=["Пароли не совпадают"];return}try{await B(a.value),U("Успешно","Вы успешно зарегистрированы"),h("authenticated"),h("close")}catch(m){const e=m.apiError||{error:"unknown_error",message:m.message||"Ошибка регистрации"};if(e.details)l.value=e.details,o("Ошибка регистрации",e.message);else if(e.error==="email_exists")o("Ошибка регистрации","Пользователь с таким email уже существует");else if(e.error==="rate_limit_exceeded"){const t=e.retry_after||60;o("Превышен лимит запросов",`Попробуйте снова через ${t} секунд`)}else e.error==="bad_gateway"||e.error==="service_unavailable"||e.error==="gateway_timeout"?o("Сервер недоступен",e.message):e.error==="network_error"?o("Ошибка сети",e.message):o("Ошибка регистрации",e.message)}},S=async()=>{if(l.value={},!n.value.email||!n.value.password){o("Ошибка валидации","Пожалуйста, заполните все поля");return}if(n.value.password.length<8){o("Ошибка валидации","Пароль должен содержать минимум 8 символов"),l.value.password=["Пароль должен содержать минимум 8 символов"];return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.value.email)){o("Ошибка валидации","Пожалуйста, введите корректный email адрес"),l.value.email=["Некорректный формат email"];return}try{await N({email:n.value.email,password:n.value.password}),U("Успешно","Вы успешно вошли в систему"),h("authenticated"),h("close")}catch(e){const t=e.apiError||{error:"unknown_error",message:e.message||"Ошибка входа"};if(t.details)l.value=t.details,o("Ошибка входа",t.message);else if(t.error==="invalid_credentials")o("Ошибка входа","Неверный email или пароль");else if(t.error==="account_inactive")o("Ошибка входа","Аккаунт неактивен");else if(t.error==="rate_limit_exceeded"){const D=t.retry_after||60;o("Превышен лимит запросов",`Слишком много попыток входа. Попробуйте снова через ${D} секунд`)}else t.error==="bad_gateway"||t.error==="service_unavailable"||t.error==="gateway_timeout"?o("Сервер недоступен",t.message):t.error==="network_error"?o("Ошибка сети",t.message):o("Ошибка входа",t.message)}};return F(()=>z.isOpen,m=>{m||(n.value={email:"",password:""},a.value={email:"",password:"",confirmPassword:"",full_name:"",tenant_name:""},l.value={},y.value=!1,b.value=!1,w.value=!1,p.value="register")}),(m,e)=>(r(),u(X,{to:"body"},[P(A,{"enter-active-class":"transition-opacity duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-300","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:q(()=>[E.isOpen?(r(),c("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:e[14]||(e[14]=t=>m.$emit("close"))},[P(A,{"enter-active-class":"transition-all duration-300","enter-from-class":"opacity-0 scale-95 translate-y-4","enter-to-class":"opacity-100 scale-100 translate-y-0","leave-active-class":"transition-all duration-300","leave-from-class":"opacity-100 scale-100 translate-y-0","leave-to-class":"opacity-0 scale-95 translate-y-4"},{default:q(()=>[E.isOpen?(r(),c("div",{key:0,class:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4",onClick:e[13]||(e[13]=j(()=>{},["stop"]))},[s("div",J,[s("div",K,[e[15]||(e[15]=s("h2",{class:"text-xl font-bold text-slate-900"}," Вход в систему ",-1)),s("button",{onClick:e[0]||(e[0]=t=>m.$emit("close")),class:"p-2 text-slate-400 hover:text-slate-600 transition-colors"},[P(i(Z),{class:"h-5 w-5"})])]),s("div",Q,[s("button",{onClick:e[1]||(e[1]=t=>p.value="register"),class:g(["flex-1 py-2 px-3 text-sm font-medium rounded-md transition-colors",p.value==="register"?"bg-white text-slate-900 shadow-sm":"text-slate-600 hover:text-slate-900"])}," Регистрация ",2),s("button",{onClick:e[2]||(e[2]=t=>p.value="login"),class:g(["flex-1 py-2 px-3 text-sm font-medium rounded-md transition-colors",p.value==="login"?"bg-white text-slate-900 shadow-sm":"text-slate-600 hover:text-slate-900"])}," Вход ",2)]),p.value==="register"?(r(),c("form",{key:0,onSubmit:j(I,["prevent"]),class:"space-y-4"},[s("div",null,[e[16]||(e[16]=s("label",{class:"block text-sm font-medium text-slate-700 mb-2"}," Email * ",-1)),v(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.email=t),type:"email",required:"",class:g(["w-full px-3 py-2 text-slate-900 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",l.value.email?"border-red-500":"border-slate-300"]),placeholder:"user@example.com"},null,2),[[C,a.value.email]]),l.value.email?(r(),c("div",W,k(l.value.email.join(", ")),1)):d("",!0)]),s("div",null,[e[17]||(e[17]=s("label",{class:"block text-sm font-medium text-slate-700 mb-2"}," Пароль * ",-1)),s("div",Y,[v(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.password=t),type:y.value?"text":"password",required:"",minlength:"8",maxlength:"128",class:g(["w-full px-3 py-2 pr-10 text-slate-900 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",l.value.password?"border-red-500":"border-slate-300"]),placeholder:"Минимум 8 символов"},null,10,ee),[[_,a.value.password]]),s("button",{type:"button",onClick:e[5]||(e[5]=t=>y.value=!y.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center"},[y.value?(r(),u(i(V),{key:0,class:"h-4 w-4 text-slate-400"})):(r(),u(i($),{key:1,class:"h-4 w-4 text-slate-400"}))])])]),s("div",null,[e[18]||(e[18]=s("label",{class:"block text-sm font-medium text-slate-700 mb-2"}," Подтвердить пароль * ",-1)),s("div",te,[v(s("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.confirmPassword=t),type:b.value?"text":"password",required:"",minlength:"8",maxlength:"128",class:"w-full px-3 py-2 pr-10 text-slate-900 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Повторите пароль"},null,8,se),[[_,a.value.confirmPassword]]),s("button",{type:"button",onClick:e[7]||(e[7]=t=>b.value=!b.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center"},[b.value?(r(),u(i(V),{key:0,class:"h-4 w-4 text-slate-400"})):(r(),u(i($),{key:1,class:"h-4 w-4 text-slate-400"}))])]),a.value.password&&a.value.confirmPassword&&a.value.password!==a.value.confirmPassword?(r(),c("div",le," Пароли не совпадают ")):d("",!0),l.value.confirmPassword?(r(),c("div",ae,k(l.value.confirmPassword.join(", ")),1)):d("",!0)]),s("div",null,[e[19]||(e[19]=s("label",{class:"block text-sm font-medium text-slate-700 mb-2"}," Полное имя ",-1)),v(s("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>a.value.full_name=t),type:"text",maxlength:"200",class:"w-full px-3 py-2 text-slate-900 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Иван Иванов"},null,512),[[C,a.value.full_name]])]),s("div",null,[e[20]||(e[20]=s("label",{class:"block text-sm font-medium text-slate-700 mb-2"}," Название организации ",-1)),v(s("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>a.value.tenant_name=t),type:"text",maxlength:"200",class:"w-full px-3 py-2 text-slate-900 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Моя Компания"},null,512),[[C,a.value.tenant_name]]),e[21]||(e[21]=s("p",{class:"text-xs text-slate-500 mt-1"}," Если не указано, будет сгенерировано автоматически ",-1))]),s("button",{type:"submit",disabled:i(x),class:"w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"},[i(x)?(r(),u(i(O),{key:0,class:"h-4 w-4 animate-spin"})):d("",!0),L(" "+k(i(x)?"Регистрация...":"Зарегистрироваться"),1)],8,oe)],32)):d("",!0),p.value==="login"?(r(),c("form",{key:1,onSubmit:j(S,["prevent"]),class:"space-y-4"},[s("div",null,[e[22]||(e[22]=s("label",{class:"block text-sm font-medium text-slate-700 mb-2"}," Email ",-1)),v(s("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>n.value.email=t),type:"email",required:"",class:g(["w-full px-3 py-2 text-slate-900 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",l.value.email?"border-red-500":"border-slate-300"]),placeholder:"Введите ваш email"},null,2),[[C,n.value.email]]),l.value.email?(r(),c("div",re,k(l.value.email.join(", ")),1)):d("",!0)]),s("div",null,[e[23]||(e[23]=s("label",{class:"block text-sm font-medium text-slate-700 mb-2"}," Пароль ",-1)),s("div",ie,[v(s("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>n.value.password=t),type:w.value?"text":"password",required:"",minlength:"8",maxlength:"128",class:g(["w-full px-3 py-2 pr-10 text-slate-900 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",l.value.password?"border-red-500":"border-slate-300"]),placeholder:"Минимум 8 символов"},null,10,ne),[[_,n.value.password]]),s("button",{type:"button",onClick:e[12]||(e[12]=t=>w.value=!w.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center"},[w.value?(r(),u(i(V),{key:0,class:"h-4 w-4 text-slate-400"})):(r(),u(i($),{key:1,class:"h-4 w-4 text-slate-400"}))])])]),s("button",{type:"submit",disabled:i(x),class:"w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"},[i(x)?(r(),u(i(O),{key:0,class:"h-4 w-4 animate-spin"})):d("",!0),L(" "+k(i(x)?"Вход...":"Войти"),1)],8,de)],32)):d("",!0)])])):d("",!0)]),_:1})])):d("",!0)]),_:1})]))}});export{O as L,ce as _};
