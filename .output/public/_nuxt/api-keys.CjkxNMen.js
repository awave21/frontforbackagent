import{_ as T}from"./AuthModal.vue.DxMXnGuG.js";import{bg as k,k as v,m as U,B,f as D,c as a,u as d,a as e,b as g,p as f,v as A,x as L,F as C,C as P,n as N,d as I,t as p,s as K,o,X as R,bN as q,A as O}from"./entry.CBkKRCnV.js";import{u as z}from"./useLayoutState.B8IzXTUd.js";import{u as S}from"./useAuth.CHSuA4zA.js";import{u as X}from"./useApiFetch.B9YviUBz.js";import{A as G}from"./alert-circle.DcUsP5Lj.js";import{L as H}from"./loader-2.CrTaI3Us.js";import{K as $}from"./key.DnUSL3Nn.js";import"./eye.DUCx08TH.js";import"./authSessionManager.BK0upO_P.js";const J=()=>{S();const _=X(),c=v(!1),n=v(null),r=v([]),m=async i=>{try{c.value=!0,n.value=null;const l=new URLSearchParams;i!=null&&i.include_revoked&&l.append("include_revoked","true");const w=await _("/api-keys",{query:Object.fromEntries(l)});return r.value=w,w}catch(l){throw n.value=l.message||"Ошибка загрузки API-ключей",l}finally{c.value=!1}},x=async i=>{try{c.value=!0,n.value=null;const l=await _("/api-keys",{method:"POST",headers:{"Content-Type":"application/json"},body:i});return r.value.unshift(l),l}catch(l){throw n.value=l.message||"Ошибка создания API-ключа",l}finally{c.value=!1}},h=async i=>{try{c.value=!0,n.value=null,await _(`/api-keys/${i}`,{method:"DELETE"}),r.value=r.value.filter(l=>l.id!==i)}catch(l){throw n.value=l.message||"Ошибка удаления API-ключа",l}finally{c.value=!1}};return{apiKeys:k(r),isLoading:k(c),error:k(n),fetchApiKeys:m,createApiKey:x,revokeApiKey:h}},Q={class:"w-full px-5 py-5 flex flex-col gap-5"},W={key:0,class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},Y={class:"flex items-center justify-between"},Z={class:"flex items-center"},ee={key:1,class:"bg-background rounded-xl border border-border p-6"},te={class:"flex items-center justify-between mb-6"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},le={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},oe=["value"],ae={class:"ml-2 text-sm text-slate-700"},ne={class:"flex gap-3"},re=["disabled"],ie={key:2,class:"flex justify-center py-12"},de={key:3,class:"text-center py-12"},ue={key:4,class:"space-y-4"},ce={class:"flex items-start justify-between"},pe={class:"flex-1"},me={class:"flex items-center gap-3 mb-2"},ve={class:"text-lg font-semibold text-slate-900"},xe={class:"mb-3"},be={class:"text-xs bg-slate-100 px-2 py-1 rounded font-mono break-all"},fe={class:"mb-3"},ye={class:"flex flex-wrap gap-1"},ge={class:"text-xs text-slate-500"},_e={key:0},he={class:"flex flex-col gap-2 ml-4"},we=["onClick"],Ve=U({__name:"api-keys",setup(_){const{pageTitle:c}=z(),n=v(!1),r=v(!1),m=v(!1),{isAuthenticated:x}=S(),{apiKeys:h,fetchApiKeys:i,createApiKey:l,revokeApiKey:w,isLoading:j}=J(),u=v({name:"",scopes:[],expires_in_days:365}),F=[{value:"agents:read",label:"Чтение агентов"},{value:"agents:write",label:"Создание агентов"},{value:"tools:read",label:"Чтение инструментов"},{value:"tools:write",label:"Создание инструментов"},{value:"runs:read",label:"Чтение запусков"},{value:"runs:write",label:"Запуск агентов"}];B(async()=>{if(c.value="API Ключи",x.value)try{await i()}catch(b){console.error("Failed to load API keys:",b)}}),D(x,async b=>{b&&await i()});const V=async()=>{try{m.value=!0,await l({name:u.value.name||void 0,scopes:u.value.scopes,expires_in_days:u.value.expires_in_days}),u.value={name:"",scopes:[],expires_in_days:365},r.value=!1}catch(b){console.error("Error creating API key:",b)}finally{m.value=!1}},E=()=>{n.value=!1};return(b,t)=>{const M=T;return o(),a("div",Q,[d(x)?f("",!0):(o(),a("div",W,[e("div",Y,[e("div",Z,[g(d(G),{class:"h-5 w-5 text-yellow-400 mr-3"}),t[8]||(t[8]=e("div",null,[e("h3",{class:"text-sm font-medium text-yellow-800"}," Требуется аутентификация "),e("p",{class:"text-sm text-yellow-700 mt-1"}," Войдите в систему для управления API-ключами ")],-1))]),e("button",{onClick:t[0]||(t[0]=s=>n.value=!0),class:"px-4 py-2 bg-yellow-600 text-white text-sm font-medium rounded-lg hover:bg-yellow-700 transition-colors"}," Войти ")])])),r.value?(o(),a("div",ee,[e("div",te,[t[9]||(t[9]=e("h2",{class:"text-xl font-bold text-foreground"},"Создать новый API ключ",-1)),e("button",{onClick:t[1]||(t[1]=s=>r.value=!1),class:"p-2 text-slate-400 hover:text-slate-600 transition-colors"},[g(d(R),{class:"h-5 w-5"})])]),e("form",{onSubmit:K(V,["prevent"]),class:"space-y-6"},[e("div",se,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-slate-700 mb-2"}," Название ключа (опционально) ",-1)),A(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>u.value.name=s),type:"text",class:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Например: Ключ для разработки"},null,512),[[L,u.value.name]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-slate-700 mb-2"}," Срок действия (дни) ",-1)),A(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>u.value.expires_in_days=s),type:"number",min:"1",max:"365",class:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"365"},null,512),[[L,u.value.expires_in_days,void 0,{number:!0}]])])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-slate-700 mb-3"}," Разрешения (scopes) ",-1)),e("div",le,[(o(),a(C,null,P(F,s=>e("label",{key:s.value,class:"flex items-center"},[A(e("input",{"onUpdate:modelValue":t[4]||(t[4]=y=>u.value.scopes=y),value:s.value,type:"checkbox",class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-slate-300 rounded"},null,8,oe),[[q,u.value.scopes]]),e("span",ae,p(s.label),1)])),64))])]),e("div",ne,[e("button",{type:"button",onClick:t[5]||(t[5]=s=>r.value=!1),class:"flex-1 px-4 py-2 text-slate-700 bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors"}," Отмена "),e("button",{type:"submit",disabled:m.value,class:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"},[m.value?(o(),N(d(H),{key:0,class:"h-4 w-4 animate-spin"})):f("",!0),I(" "+p(m.value?"Создание...":"Создать ключ"),1)],8,re)])],32)])):f("",!0),d(j)?(o(),a("div",ie,[...t[13]||(t[13]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"},null,-1)])])):d(h).length===0?(o(),a("div",de,[g(d($),{class:"h-12 w-12 text-slate-400 mx-auto mb-4"}),t[14]||(t[14]=e("h3",{class:"text-lg font-medium text-slate-900 mb-2"},"Нет API ключей",-1)),t[15]||(t[15]=e("p",{class:"text-slate-600 mb-4"},"Создайте свой первый API ключ для доступа к системе",-1)),d(x)?(o(),a("button",{key:0,onClick:t[6]||(t[6]=s=>r.value=!0),class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"}," Создать ключ ")):f("",!0)])):(o(),a("div",ue,[(o(!0),a(C,null,P(d(h),s=>(o(),a("div",{key:s.id,class:"bg-white rounded-xl border border-slate-200 p-6"},[e("div",ce,[e("div",pe,[e("div",me,[g(d($),{class:"h-5 w-5 text-slate-600"}),e("h3",ve,p(s.name||`Ключ ${s.id.slice(-8)}`),1),e("span",{class:O(["px-2 py-1 text-xs font-medium rounded-full",s.revoked_at?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},p(s.revoked_at?"Отозван":"Активен"),3)]),e("div",xe,[t[16]||(t[16]=e("p",{class:"text-sm text-slate-600 mb-1"},"API Ключ:",-1)),e("code",be,p(s.key),1)]),e("div",fe,[t[17]||(t[17]=e("p",{class:"text-sm text-slate-600 mb-2"},"Разрешения:",-1)),e("div",ye,[(o(!0),a(C,null,P(s.scopes,y=>(o(),a("span",{key:y,class:"px-2 py-1 bg-slate-100 text-slate-700 text-xs rounded-full"},p(y),1))),128))])]),e("div",ge,[I(" Создан: "+p(new Date(s.created_at).toLocaleString("ru-RU"))+" ",1),s.expires_at?(o(),a("span",_e," • Истекает: "+p(new Date(s.expires_at).toLocaleString("ru-RU")),1)):f("",!0)])]),e("div",he,[s.revoked_at?f("",!0):(o(),a("button",{key:0,onClick:y=>d(w)(s.id),class:"px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors text-sm"}," Отозвать ",8,we))])])]))),128))])),g(M,{"is-open":n.value,onClose:t[7]||(t[7]=s=>n.value=!1),onAuthenticated:E},null,8,["is-open"])])}}});export{Ve as default};
