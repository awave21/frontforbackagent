import{u as Qe}from"./useLayoutState.B8IzXTUd.js";import{M as Se,k as j,bg as be,bf as Ze,f as Q,b6 as Pe,u as O,L as W,m as ae,o as v,c as A,s as Te,a as o,A as q,n as J,t as H,p as V,d as me,b as B,T as De,w as re,a_ as ze,q as ve,v as Ee,x as je,E as et,H as pe,N as tt,_ as Ce,a5 as Fe,F as ce,C as Ie,J as st,B as qe,D as nt,X as at,P as ot,b$ as lt}from"./entry.CBkKRCnV.js";import{u as it}from"./useAgents.C6xV-JRH.js";import{u as He,g as X}from"./useApiFetch.B9YviUBz.js";import{u as rt}from"./useAuth.CHSuA4zA.js";import{g as Ve}from"./authSessionManager.BK0upO_P.js";import{o as Ge}from"./index.DMX2BmNm.js";import{M as ke}from"./message-square.G28g8bWr.js";import{M as ct}from"./more-vertical.CGqW9Ll_.js";import{P as ut}from"./pencil.D22Vkj6_.js";import{T as dt}from"./trash-2.BLHjeIGf.js";import{C as gt}from"./chevron-down.BtGgxUEg.js";import{C as Je}from"./check.B0AA6R8j.js";import{S as ft}from"./search.CKKCnfcg.js";import{L as Me}from"./loader-2.CrTaI3Us.js";import{A as mt}from"./arrow-left.BVml2r7Y.js";import{c as vt}from"./safe-markdown._KYjoumJ.js";import{P as pt}from"./play.CbykjbVq.js";import{A as Ke}from"./alert-circle.DcUsP5Lj.js";import{P as xt}from"./plus.CAbVbV7B.js";import{M as yt}from"./message-circle.BQYN1L09.js";import{U as ht}from"./user-check.Cn_7imEa.js";import{S as bt}from"./send.Ce_61EZ2.js";import{_ as _t}from"./AuthModal.vue.DxMXnGuG.js";import"./index.C5R80SqK.js";import"./eye.DUCx08TH.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=Se("ArrowDownIcon",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=Se("ImageIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=Se("MicIcon",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=Se("PauseCircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=Se("PauseIcon",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),We=new Set(["active","paused"]),$e=e=>{const s=e.status&&We.has(e.status)?e.status:e.agent_status??"active";return{...e,agent_status:s,status:We.has(e.status)?"NORMAL":e.status||"NORMAL"}},N=j([]),_e=j(!1),ne=j(null),Re=j(null),xe=()=>{const e=He();return{dialogs:N,isLoading:_e,error:ne,currentAgentId:Re,fetchDialogs:async(l,a)=>{if(!l){console.warn("[useDialogs] fetchDialogs called without agentId");return}_e.value=!0,ne.value=null,Re.value=l;try{const i=new URLSearchParams;(a==null?void 0:a.archived)!==void 0&&i.set("archived",String(a.archived));const u=i.toString(),U=`agents/${l}/dialogs${u?`?${u}`:""}`,E=await e(U);let M=[];Array.isArray(E)?M=E:E&&typeof E=="object"&&"dialogs"in E?M=E.dialogs||[]:E&&typeof E=="object"&&"items"in E&&(M=E.items||[]),N.value=M.map($e)}catch(i){console.error("[useDialogs] Error fetching dialogs:",i),console.error("[useDialogs] Error details:",{status:(i==null?void 0:i.statusCode)||(i==null?void 0:i.status),data:i==null?void 0:i.data,message:i==null?void 0:i.message}),ne.value=X(i,"Не удалось загрузить диалоги"),N.value=[]}finally{_e.value=!1}},createDialog:async(l,a)=>{if(!l)return null;_e.value=!0,ne.value=null;try{const i=await e(`agents/${l}/dialogs`,{method:"POST",headers:{"Content-Type":"application/json"},body:a||{}}),u=$e(i);return N.value=[u,...N.value],u}catch(i){return ne.value=X(i,"Не удалось создать диалог"),null}finally{_e.value=!1}},updateDialog:async(l,a,i)=>{if(!l||!a)return null;try{const u=await e(`agents/${l}/dialogs/${encodeURIComponent(a)}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:i}),U=$e(u),E=N.value.findIndex(M=>M.id===a);return E!==-1&&(N.value[E]=U),U}catch(u){return ne.value=X(u,"Не удалось обновить диалог"),null}},deleteDialog:async(l,a)=>{if(!l||!a)return!1;try{return await e(`agents/${l}/dialogs/${encodeURIComponent(a)}`,{method:"DELETE"}),N.value=N.value.filter(i=>i.id!==a),!0}catch(i){return ne.value=X(i,"Не удалось удалить диалог"),!1}},toggleDialogAgentStatus:async(l,a)=>{if(!l||!a)return null;const i=N.value.findIndex(E=>E.id===a),u=i!==-1?N.value[i].agent_status??"active":"active",U=u==="active"?"paused":"active";i!==-1&&(N.value[i]={...N.value[i],agent_status:U});try{return await e(`agents/${l}/dialogs/${encodeURIComponent(a)}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:{status:U}}),U}catch(E){return i!==-1&&(N.value[i]={...N.value[i],agent_status:u}),ne.value=X(E,"Не удалось изменить статус агента"),console.error("[useDialogs] toggleDialogAgentStatus error:",E),null}},upsertDialog:l=>{const a=l.id||l.session_id;if(!a)return;const i=N.value.findIndex(y=>y.id===a),u=i!==-1?N.value[i]:null,U=l.user_info||(u==null?void 0:u.user_info);let E=null;U&&(U.first_name||U.last_name?E=[U.first_name,U.last_name].filter(Boolean).join(" "):U.username&&(E=`@${U.username}`));const M=l.platform||(u==null?void 0:u.platform)||(a.startsWith("telegram:")?"telegram":void 0),r=M==="telegram"||a.startsWith("telegram:")?`Telegram #${a.replace("telegram:","")}`:"Диалог",t=E||(u==null?void 0:u.title)||r,n=$e({...u||{},id:a,title:t,last_message_preview:l.last_message_preview||l.content||(u==null?void 0:u.last_message_preview)||"",last_message_at:l.last_message_at||l.created_at||(u==null?void 0:u.last_message_at)||new Date().toISOString(),unread_count:l.is_new?((u==null?void 0:u.unread_count)??0)+1:(u==null?void 0:u.unread_count)??0,status:l.status||(u==null?void 0:u.status)||"NORMAL",agent_status:l.agent_status||(u==null?void 0:u.agent_status),created_at:l.created_at||(u==null?void 0:u.created_at)||new Date().toISOString(),updated_at:new Date().toISOString(),platform:M,user_info:U||(u==null?void 0:u.user_info)});i!==-1?N.value=[n,...N.value.filter((y,c)=>c!==i)]:N.value=[n,...N.value]},updateDialogStatus:(l,a)=>{const i=N.value.findIndex(u=>u.id===l);i!==-1&&(N.value[i]={...N.value[i],status:a})},updateLastMessage:(l,a,i)=>{const u=N.value.findIndex(U=>U.id===l);if(u!==-1){N.value[u]={...N.value[u],last_message_preview:a,last_message_at:i};const U=N.value.splice(u,1)[0];N.value.unshift(U)}},incrementUnread:l=>{const a=N.value.findIndex(i=>i.id===l);a!==-1&&(N.value[a]={...N.value[a],unread_count:N.value[a].unread_count+1})},markAsRead:l=>{const a=N.value.findIndex(i=>i.id===l);a!==-1&&(N.value[a]={...N.value[a],unread_count:0})},getDialogById:l=>N.value.find(a=>a.id===l),resolveDialogId:l=>{if(!l)return null;const a=String(l),i=N.value.find(U=>U.id===a);if(i)return i.id;const u=N.value.find(U=>U.id.endsWith(`:${a}`));return(u==null?void 0:u.id)??a},clearDialogs:()=>{N.value=[],Re.value=null,ne.value=null}}},F=Ze({}),G=(e,s)=>{F[e]=[...s]},we=j(!1),ie=j(!1),ge=j(!1),fe=j(null),te=j(null),Le=j(new Map),Ct=(e,s)=>{const g=s.isUser??s.is_user,_=s.isAgent??s.is_agent;if(typeof g=="boolean")return g?"user":"agent";if(typeof _=="boolean")return _?"agent":"user";if(typeof e=="string"){const h=e.toLowerCase();if(["user","human","client","customer","visitor","requester"].includes(h))return"user";if(["manager","operator","admin","support"].includes(h))return"manager";if(["agent","assistant","bot","ai","system"].includes(h))return"agent"}return"agent"},At=e=>{if(typeof e=="string"){const s=e.toLowerCase();if(s.includes("image")||s.includes("photo")||s.includes("img"))return"image";if(s.includes("voice")||s.includes("audio")||s.includes("wav")||s.includes("mp3"))return"voice"}return"text"},Rt=e=>{if(typeof e!="string")return"sent";const s=e.toLowerCase();return s==="sending"?"sending":s==="failed"?"failed":s==="streaming"?"streaming":s==="done"?"done":"sent"},wt=new Set(["tool","function","tool_result","function_result","tool_call","function_call","tool_use"]),Lt=new Set(["tool_result","tool_call","function_call","function_result","tool_use"]),Tt=e=>{const s=e.trim();if(s.length<20||!(s.startsWith("{")&&s.endsWith("}")||s.startsWith("[")&&s.endsWith("]")))return!1;try{const _=JSON.parse(s);if(typeof _=="object"&&_!==null)return!0}catch{if(/^\{\s*'[^']+'\s*:/.test(s))return!0}return!1},Be=(e,s)=>{var l;const g=(e==null?void 0:e.role)??(e==null?void 0:e.sender)??(e==null?void 0:e.author)??(e==null?void 0:e.from)??(e==null?void 0:e.direction);if(typeof g=="string"&&wt.has(g.toLowerCase()))return null;const _=(e==null?void 0:e.type)??(e==null?void 0:e.message_type)??(e==null?void 0:e.content_type)??(e==null?void 0:e.kind);if(typeof _=="string"&&Lt.has(_.toLowerCase()))return null;const h=(e==null?void 0:e.content)??(e==null?void 0:e.text)??(e==null?void 0:e.message)??(e==null?void 0:e.body)??(e==null?void 0:e.payload)??((l=e==null?void 0:e.data)==null?void 0:l.content)??"";if(typeof h=="object"&&h!==null)return null;const R=typeof h=="string"?h:String(h);if(Tt(R))return null;const k=(e==null?void 0:e.dialog_id)??(e==null?void 0:e.dialogId)??(e==null?void 0:e.session_id)??(e==null?void 0:e.sessionId)??s,T=(e==null?void 0:e.id)??(e==null?void 0:e.message_id)??(e==null?void 0:e.messageId)??(e==null?void 0:e.uuid)??(e==null?void 0:e._id)??`${k}-${(e==null?void 0:e.created_at)??(e==null?void 0:e.createdAt)??Date.now()}`,w=Ct(g,{isUser:e==null?void 0:e.isUser,is_user:e==null?void 0:e.is_user,isAgent:e==null?void 0:e.isAgent,is_agent:e==null?void 0:e.is_agent}),m=At((e==null?void 0:e.type)??(e==null?void 0:e.message_type)??(e==null?void 0:e.content_type)??(e==null?void 0:e.kind)??(e==null?void 0:e.media_type)),x=(e==null?void 0:e.created_at)??(e==null?void 0:e.createdAt)??(e==null?void 0:e.timestamp)??(e==null?void 0:e.time)??(e==null?void 0:e.created)??new Date().toISOString(),D=Rt(e==null?void 0:e.status),I=(e==null?void 0:e.duration_seconds)??(e==null?void 0:e.durationSeconds)??(e==null?void 0:e.duration),p=typeof I=="number"?I:Number.isFinite(Number(I))?Number(I):void 0;return{id:String(T),dialog_id:String(k),role:w,type:m,content:R,status:D,duration_seconds:p,created_at:String(x)}},Xe=()=>{const e=He(),{updateDialogStatus:s,updateLastMessage:g,resolveDialogId:_}=xe(),h=r=>F[r]||[],R=async(r,t,n)=>{if(!r||!t){console.warn("[useMessages] Missing agentId or dialogId:",{agentId:r,dialogId:t});return}we.value=!0,te.value=null;let y=!1;const c=new URLSearchParams;n!=null&&n.before&&c.set("before",n.before),n!=null&&n.limit&&c.set("limit",String(n.limit));const d=c.toString(),b=encodeURIComponent(t),C=`agents/${r}/dialogs/${b}/messages${d?`?${d}`:""}`;try{console.log("[useMessages] fetchMessages URL:",C);const f=await e(C,{method:"GET"});console.log("[useMessages] fetchMessages raw response:",f),console.log("[useMessages] fetchMessages response type:",typeof f,Array.isArray(f)?"array":"");let L=[];Array.isArray(f)?(L=f,y=!1):f&&typeof f=="object"&&"messages"in f?(L=f.messages||[],y=f.has_more||!1):f&&typeof f=="object"&&"items"in f?(L=f.items||[],y=f.has_more||!1):f&&typeof f=="object"&&"data"in f?(L=f.data||[],y=f.has_more||!1):console.error("[useMessages] Unexpected response format:",f),console.log("[useMessages] rawMessages count:",L.length),L.length>0&&console.log("[useMessages] first raw message sample:",L[0]);const $=[];for(const S of L){const P=Be(S,t);P?$.push(P):console.warn("[useMessages] Message filtered out by normalizeMessage:",{id:S==null?void 0:S.id,role:(S==null?void 0:S.role)??(S==null?void 0:S.sender),type:(S==null?void 0:S.type)??(S==null?void 0:S.message_type),content_type:typeof(S==null?void 0:S.content),content_preview:typeof(S==null?void 0:S.content)=="string"?S.content.slice(0,80):typeof(S==null?void 0:S.content)})}const z=F[t]||[];n!=null&&n.before?G(t,[...$,...z]):G(t,$),Le.value.set(t,y),console.log("[useMessages] Final messages count for dialog",t,":",(F[t]||[]).length)}catch(f){console.error("[useMessages] fetchMessages error:",f),console.error("[useMessages] fetchMessages error details:",{status:(f==null?void 0:f.statusCode)||(f==null?void 0:f.status),data:f==null?void 0:f.data,message:f==null?void 0:f.message,url:C}),te.value=X(f,"Не удалось загрузить сообщения")}finally{we.value=!1}},k=async(r,t,n,y="text",c=!0)=>{if(!r||!t||!n.trim())return null;ie.value=!0,te.value=null;const d=`temp-${Date.now()}`,b={id:d,dialog_id:t,role:"user",type:y,content:n.trim(),status:"sending",created_at:new Date().toISOString()},C=F[t]||[];G(t,[...C,b]);try{const f={content:n.trim(),type:y},L=encodeURIComponent(t),$=await e(`agents/${r}/dialogs/${L}/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:f}),z=F[t]||[],S=z.findIndex(P=>P.id===d);if(S!==-1){const P=[...z];P[S]={...P[S],status:"sent"},G(t,P)}if(g(t,n.trim().slice(0,100),$.created_at||new Date().toISOString()),c){const P=($==null?void 0:$.id)||($==null?void 0:$.message_id);P&&await a(r,t,P)}return $}catch(f){const L=F[t]||[],$=L.findIndex(z=>z.id===d);if($!==-1){const z=[...L];z[$]={...z[$],status:"failed",error_message:X(f,"Ошибка отправки")},G(t,z)}return te.value=X(f,"Не удалось отправить сообщение"),null}finally{ie.value=!1}},T=async(r,t,n,y=!0)=>{const c=F[t]||[],d=c.find(b=>b.id===n);!d||d.status!=="failed"||(G(t,c.filter(b=>b.id!==n)),await k(r,t,d.content,d.type,y))},w=async(r,t,n)=>{if(!r||!t||!n.trim())return null;ie.value=!0,te.value=null;const y=`temp-mgr-${Date.now()}`,c={id:y,dialog_id:t,role:"manager",type:"text",content:n.trim(),status:"sending",created_at:new Date().toISOString()},d=F[t]||[];G(t,[...d,c]);try{const b={content:n.trim()},C=encodeURIComponent(t);await e(`agents/${r}/dialogs/${C}/manager-message`,{method:"POST",headers:{"Content-Type":"application/json"},body:b});const f=F[t]||[],L=f.findIndex($=>$.id===y);if(L!==-1){const $=[...f];$[L]={...$[L],status:"sent"},G(t,$)}return g(t,n.trim().slice(0,100),new Date().toISOString()),{...c,status:"sent"}}catch(b){const C=F[t]||[],f=C.findIndex(L=>L.id===y);if(f!==-1){const L=[...C];L[f]={...L[f],status:"failed",error_message:X(b,"Ошибка отправки")},G(t,L)}return te.value=X(b,"Не удалось отправить сообщение менеджера"),null}finally{ie.value=!1}},m=(r,t,n="text")=>{const y=`temp-${Date.now()}`,c={id:y,dialog_id:r,role:"user",type:n,content:t.trim(),status:"sending",created_at:new Date().toISOString()},d=F[r]||[];return G(r,[...d,c]),ie.value=!0,y},x=(r,t,n)=>{const y=F[r]||[],c=y.findIndex(d=>d.id===t);if(c!==-1){const d=[...y];d[c]={...d[c],status:"sent"},G(r,d)}ie.value=!1},D=(r,t,n)=>{const y=n||"Не удалось отправить сообщение",c=F[r]||[],d=c.findIndex(b=>b.id===t);if(d!==-1){const b=[...c];b[d]={...b[d],status:"failed",error_message:y},G(r,b)}ie.value=!1,te.value=y},I=(r,t)=>{ge.value=!0;const n=`agent-${r}`;fe.value=n;const y={id:n,dialog_id:t,role:"agent",type:"text",content:"",status:"streaming",created_at:new Date().toISOString()},c=F[t]||[];G(t,[...c,y])},p=(r,t,n)=>{const y=`agent-${r}`,c=F[t]||[],d=c.findIndex(b=>b.id===y);if(d!==-1){const b=[...c];b[d]={...b[d],content:n,status:"done"},G(t,b)}ge.value=!1,fe.value=null},l=(r,t,n)=>{const y=`agent-${r}`,c=F[t]||[],d=c.findIndex(b=>b.id===y);if(d!==-1){const b=[...c];b[d]={...b[d],content:`Ошибка: ${n}`,status:"failed",error_message:n},G(t,b)}ge.value=!1,fe.value=null,te.value=n},a=async(r,t,n)=>{var b,C,f,L,$;ge.value=!0,s(t,"IN_PROGRESS");const y=`agent-${Date.now()}`;fe.value=y;const c={id:y,dialog_id:t,role:"agent",type:"text",content:"",status:"streaming",created_at:new Date().toISOString()},d=F[t]||[];G(t,[...d,c]);try{const z=Ve(),S=encodeURIComponent(t),P=await fetch(`/api/v1/agents/${r}/dialogs/${S}/messages/stream`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"text/event-stream",...z?{Authorization:`Bearer ${z}`}:{}},body:JSON.stringify({user_message_id:n})});if(!P.ok)throw new Error(X({status:P.status},"Не удалось получить ответ агента"));const Z=(b=P.body)==null?void 0:b.getReader();if(!Z)throw new Error("No reader available");const ye=new TextDecoder;let ee="";for(;;){const{done:Y,value:de}=await Z.read();if(Y)break;ee+=ye.decode(de,{stream:!0});const Oe=ee.split(`
`);ee=Oe.pop()||"";for(const Ne of Oe)if(Ne.startsWith("data: ")){const Ue=Ne.slice(6);if(Ue==="[DONE]")continue;try{const se=JSON.parse(Ue);if(se.type==="delta"&&((C=se.data)!=null&&C.content)){const he=F[t]||[],le=he.findIndex(K=>K.id===y);if(le!==-1){const K=[...he];K[le]={...K[le],content:K[le].content+se.data.content},G(t,K)}}else if(se.type==="done"){const he=F[t]||[],le=he.findIndex(K=>K.id===y);if(le!==-1){const K=[...he];K[le]={...K[le],id:((f=se.data)==null?void 0:f.message_id)||y,status:"done"},G(t,K)}}else if(se.type==="error")throw new Error(((L=se.data)==null?void 0:L.error)||"Stream error")}catch(se){console.warn("Failed to parse SSE event:",se)}}}const ue=F[t]||[],oe=ue.findIndex(Y=>Y.id===y||Y.status==="streaming");if(oe!==-1&&ue[oe].status==="streaming"){const Y=[...ue];Y[oe]={...Y[oe],status:"done"},G(t,Y)}const Ae=(($=ue[oe])==null?void 0:$.content)||"";Ae&&g(t,Ae.slice(0,100),new Date().toISOString()),s(t,"NORMAL")}catch(z){console.error("Stream error:",z);const S=F[t]||[],P=S.findIndex(Z=>Z.id===y);if(P!==-1){const Z=S.filter((ye,ee)=>ee!==P);G(t,Z)}s(t,"ERROR"),te.value=X(z,"Не удалось получить ответ агента")}finally{ge.value=!1,fe.value=null}},i=(r,t)=>{const n=_(r)??r,y=F[n]||[];G(n,[...y,{...t,dialog_id:n}])},u=(r,t,n)=>{const y=_(r)??r,c=F[y]||[],d=c.findIndex(b=>b.id===t);if(d!==-1){const b=[...c];b[d]={...b[d],...n},G(y,b)}},U=r=>{const t=_(r)??r;delete F[t],Le.value.delete(t)},E=r=>Le.value.get(r)??!0,M=r=>{const t=(r==null?void 0:r.dialog_id)??(r==null?void 0:r.session_id),n=_(t);if(!n)return;const y=F[n]||[],c=Be({...r,dialog_id:n},n);if(!c||y.some(C=>C.id===c.id))return;const d=Date.now();y.some(C=>C.role===c.role&&C.content.trim()===c.content.trim()&&C.status!=="failed"&&d-new Date(C.created_at).getTime()<15e3)||(G(n,[...y,c]),g(n,c.content.slice(0,100),c.created_at))};return{isLoading:be(we),isSending:be(ie),isStreaming:be(ge),streamingMessageId:be(fe),error:be(te),messagesMap:F,getMessages:h,dialogHasMore:E,fetchMessages:R,sendMessage:k,sendManagerMessage:w,retryMessage:T,addMessage:i,addIncomingMessage:M,updateMessage:u,clearMessages:U,createOptimisticMessage:m,markMessageSent:x,markMessageFailed:D,handleRunStart:I,handleRunResult:p,handleRunError:l,startAgentStream:a}},It={maxAttempts:5,baseDelay:1e3,maxDelay:16e3},Et=(e,s)=>{const g=xe(),_=Xe(),{resolveDialogId:h}=g,R={...It,...s==null?void 0:s.reconnectConfig},k=j("disconnected"),T=j(0),w=j(null),m=j(null),x=j(null);let D=null,I=null,p=null;const l=C=>{if(typeof window>"u")return null;const f=Ve();if(!f)return console.error("[WebSocket] No auth token found"),null;const L=window.location.protocol==="https:"?"wss:":"ws:",$=window.location.host;return`${L}//${$}/api/v1/agents/${C}/ws?token=${f}`},a=C=>{if(!D||D.readyState!==WebSocket.OPEN)return console.warn("[WebSocket] Cannot send - connection not open"),!1;try{return D.send(JSON.stringify(C)),!0}catch(f){return console.error("[WebSocket] Send error:",f),!1}},i=C=>{try{const L=JSON.parse(C.data);switch(L.type){case"message_created":{const $=L.data,z=$.dialog_id??$.session_id,S=h(z)??(z?String(z):null);if(!S){console.warn("[WebSocket] message_created without dialog_id/session_id");break}const P=typeof $.role=="string"?$.role.toLowerCase():"";if(["tool","function","tool_result","function_result","tool_call","function_call","tool_use"].includes(P)||typeof $.content=="object"&&$.content!==null)break;const ye=S===x.value,ee=$.user_info,ue=(ee==null?void 0:ee.platform)||(S.startsWith("telegram:")?"telegram":void 0),oe=typeof $.content=="string"?$.content:"";g.upsertDialog({id:S,session_id:S,last_message_preview:oe,last_message_at:$.created_at,is_new:!ye,platform:ue,user_info:ee});const Y=_.getMessages(S).find(de=>de.status==="sending"&&(de.role==="user"||de.role==="manager")&&de.content.trim()===oe.trim());Y?_.markMessageSent(S,Y.id,$.id):_.addIncomingMessage({...$,dialog_id:S}),ye&&g.markAsRead(S);break}case"dialog_updated":{g.upsertDialog(L.data);break}case"run_start":{const{run_id:$,dialog_id:z}=L.data,S=h(z)??z;w.value=$,m.value=S,_.handleRunStart($,S),g.updateDialogStatus(S,"IN_PROGRESS");break}case"run_result":{const{run_id:$,output:z,dialog_id:S}=L.data,P=h(S)??S,Z=P===x.value;_.handleRunResult($,P,z),g.upsertDialog({id:P,last_message_preview:z.slice(0,100),last_message_at:new Date().toISOString(),is_new:!Z}),g.updateDialogStatus(P,"NORMAL"),Z&&g.markAsRead(P),w.value===$&&(w.value=null,m.value=null);break}case"run_error":{const{run_id:$,error:z,dialog_id:S}=L.data,P=h(S)??S;_.handleRunError($,P,z),g.updateDialogStatus(P,"ERROR"),w.value===$&&(w.value=null,m.value=null);break}case"ping":{a({type:"pong"}),u();break}case"error":{console.error("[WebSocket] Server error:",L.data.message);break}case"status":case"dialog_joined":case"dialog_left":break;default:console.warn("[WebSocket] Unknown message type:",L.type)}}catch(f){console.error("[WebSocket] Error parsing message:",f)}},u=()=>{p&&clearTimeout(p),p=setTimeout(()=>{console.warn("[WebSocket] No ping received in 60s, reconnecting..."),r()},6e4)},U=()=>{if(T.value>=R.maxAttempts){console.error("[WebSocket] Max reconnect attempts reached"),k.value="error";return}const C=Math.min(R.baseDelay*Math.pow(2,T.value),R.maxDelay);I=setTimeout(()=>{T.value++,E()},C)},E=()=>{const C=O(e);if(!C||typeof window>"u"){console.warn("[WebSocket] Cannot connect - no agent ID or not in browser");return}M(!1);const f=l(C);if(f){k.value="connecting";try{D=new WebSocket(f),D.onopen=()=>{k.value="connected",T.value=0,u()},D.onclose=L=>{k.value="disconnected",p&&(clearTimeout(p),p=null),L.code!==1e3&&L.code!==1008?U():L.code===1008&&(console.error("[WebSocket] Unauthorized - invalid token"),k.value="error")},D.onerror=L=>{console.error("[WebSocket] Error:",L),k.value="error"},D.onmessage=i}catch(L){console.error("[WebSocket] Connection error:",L),k.value="error",U()}}},M=(C=!0)=>{C&&I&&(clearTimeout(I),I=null),p&&(clearTimeout(p),p=null),D&&(D.close(1e3,"Client closed"),D=null),x.value=null,C&&(k.value="disconnected",T.value=0)},r=()=>{M(!1),T.value=0,E()},t=(C,f)=>a({type:"send_message",dialog_id:C,content:f}),n=C=>{const f=a({type:"join_dialog",dialog_id:C});return f&&(x.value=C),f},y=C=>{const f=a({type:"leave_dialog",dialog_id:C});return f&&x.value===C&&(x.value=null),f},c=()=>a({type:"get_status"});Q(()=>O(e),(C,f)=>{C!==f&&(C?E():M())},{immediate:(s==null?void 0:s.autoConnect)!==!1}),Pe(()=>{M()});const d=W(()=>k.value==="connected"),b=W(()=>k.value==="connecting");return{connectionState:k,isConnected:d,isConnecting:b,reconnectAttempts:T,connect:E,disconnect:M,reconnect:r,sendMessage:t,joinDialog:n,leaveDialog:y,getStatus:c}},jt={class:"flex-1 min-w-0"},Ot={class:"flex items-center gap-2"},Nt={key:0,class:"px-1.5 py-0.5 text-[10px] font-medium rounded bg-blue-100 text-blue-700"},Ut={key:0,class:"text-xs text-blue-500 truncate"},Wt={class:"text-xs text-slate-500 truncate mt-0.5"},Bt={class:"flex flex-col items-end gap-1 flex-shrink-0"},Pt={class:"text-xs text-slate-400"},zt={key:0,class:"px-1.5 py-0.5 text-[10px] font-medium rounded bg-green-100 text-green-700 flex items-center gap-0.5"},Ft={key:1,class:"px-1.5 py-0.5 text-[10px] font-medium rounded bg-amber-100 text-amber-700 flex items-center gap-0.5"},qt={key:0,class:"fixed inset-0 z-[110] flex items-center justify-center p-4"},Ht={class:"relative bg-white rounded-2xl shadow-xl p-6 max-w-sm w-full"},Vt={class:"flex gap-3 mt-4"},Gt=["disabled"],Jt={key:0,class:"fixed inset-0 z-[110] flex items-center justify-center p-4"},Kt={class:"relative bg-white rounded-2xl shadow-xl p-6 max-w-sm w-full"},Xt={class:"flex gap-3"},Yt=ae({__name:"DialogItem",props:{dialog:{},isSelected:{type:Boolean}},emits:["click","rename","delete"],setup(e,{emit:s}){const g=e,_=s,h=j(!1),R=j(null),k=j({x:0,y:0}),T=j(!1),w=j(""),m=j(null),x=j(!1);Ge(R,()=>{h.value=!1});const D=W(()=>{var t;return g.dialog.platform==="telegram"||((t=g.dialog.id)==null?void 0:t.startsWith("telegram:"))}),I=W(()=>{var t;return((t=g.dialog.user_info)==null?void 0:t.username)||null}),p=W(()=>{const t=g.dialog.user_info;return t!=null&&t.first_name||t!=null&&t.last_name?[t.first_name,t.last_name].filter(Boolean).join(" "):t!=null&&t.username?`@${t.username}`:D.value&&g.dialog.id?`Telegram #${g.dialog.id.replace("telegram:","")}`:"Диалог"}),l=W(()=>{if(!g.dialog.last_message_at)return"";const t=new Date(g.dialog.last_message_at),y=new Date().getTime()-t.getTime(),c=Math.floor(y/(1e3*60*60*24));return c===0?t.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}):c===1?"Вчера":c<7?t.toLocaleDateString("ru-RU",{weekday:"short"}):t.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}),a=W(()=>(g.dialog.agent_status??"active")==="active"),i=W(()=>{const t=g.dialog.status;return t==="IN_PROGRESS"&&!a.value?g.dialog.unread_count>0?"UNREAD":null:t==="IN_PROGRESS"?"IN_PROGRESS":t==="ERROR"?"ERROR":g.dialog.unread_count>0?"UNREAD":t==="NEW"?"NEW":null}),u=t=>{t.preventDefault(),k.value={x:t.clientX,y:t.clientY},h.value=!0},U=()=>{h.value=!1,w.value=g.dialog.title||"",T.value=!0,pe(()=>{var t,n;(t=m.value)==null||t.focus(),(n=m.value)==null||n.select()})},E=()=>{w.value.trim()&&(_("rename",g.dialog.id,w.value.trim()),T.value=!1)},M=()=>{h.value=!1,x.value=!0},r=()=>{_("delete",g.dialog.id),x.value=!1};return(t,n)=>{const y=tt("StatusIndicator");return v(),A("div",{class:"relative group",onContextmenu:Te(u,["prevent"])},[o("button",{onClick:n[0]||(n[0]=c=>t.$emit("click")),class:q(["w-full px-4 py-3 flex items-start gap-3 text-left transition-colors",[e.isSelected?"bg-indigo-50":"hover:bg-slate-50"]])},[o("div",{class:q(["w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",[D.value?e.isSelected?"bg-blue-100":"bg-blue-50":e.isSelected?"bg-indigo-100":"bg-slate-100"]])},[D.value?(v(),A("svg",{key:0,class:q(["w-5 h-5",[e.isSelected?"text-blue-600":"text-blue-500"]]),viewBox:"0 0 24 24",fill:"currentColor"},[...n[6]||(n[6]=[o("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"},null,-1)])],2)):(v(),J(O(ke),{key:1,class:q(["w-5 h-5",[e.isSelected?"text-indigo-600":"text-slate-500"]])},null,8,["class"]))],2),o("div",jt,[o("div",Ot,[o("h3",{class:q(["text-sm font-semibold truncate",[e.isSelected?"text-indigo-900":"text-slate-900"]])},H(p.value),3),D.value?(v(),A("span",Nt," TG ")):V("",!0),i.value?(v(),J(y,{key:1,status:i.value,count:e.dialog.unread_count},null,8,["status","count"])):V("",!0)]),I.value?(v(),A("p",Ut," @"+H(I.value),1)):V("",!0),o("p",Wt,H(e.dialog.last_message_preview||"Нет сообщений"),1)]),o("div",Bt,[o("span",Pt,H(l.value),1),a.value?(v(),A("span",zt,[...n[7]||(n[7]=[o("span",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1),me(" Агент ",-1)])])):(v(),A("span",Ft,[B(O($t),{class:"w-3 h-3"}),n[8]||(n[8]=me(" Пауза ",-1))]))])],2),o("button",{onClick:Te(u,["stop"]),class:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 rounded-lg opacity-0 group-hover:opacity-100 hover:bg-slate-200 transition-opacity lg:block hidden"},[B(O(ct),{class:"w-4 h-4 text-slate-500"})]),(v(),J(De,{to:"body"},[B(ve,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:re(()=>[h.value?(v(),A("div",{key:0,ref_key:"contextMenuRef",ref:R,class:"fixed bg-white rounded-xl shadow-lg border border-slate-200 py-1 z-[100] min-w-[160px]",style:ze({top:`${k.value.y}px`,left:`${k.value.x}px`})},[o("button",{onClick:U,class:"w-full px-4 py-2 text-left text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-2"},[B(O(ut),{class:"w-4 h-4"}),n[9]||(n[9]=me(" Переименовать ",-1))]),o("button",{onClick:M,class:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2"},[B(O(dt),{class:"w-4 h-4"}),n[10]||(n[10]=me(" Удалить ",-1))])],4)):V("",!0)]),_:1})])),(v(),J(De,{to:"body"},[B(ve,{name:"modal-fade"},{default:re(()=>[T.value?(v(),A("div",qt,[o("div",{class:"absolute inset-0 bg-black/50",onClick:n[1]||(n[1]=c=>T.value=!1)}),o("div",Ht,[n[11]||(n[11]=o("h3",{class:"text-lg font-bold text-slate-900 mb-4"},"Переименовать диалог",-1)),Ee(o("input",{"onUpdate:modelValue":n[2]||(n[2]=c=>w.value=c),type:"text",placeholder:"Название диалога",class:"w-full px-4 py-2.5 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent",onKeyup:et(E,["enter"]),ref_key:"renameInputRef",ref:m},null,544),[[je,w.value]]),o("div",Vt,[o("button",{onClick:n[3]||(n[3]=c=>T.value=!1),class:"flex-1 px-4 py-2.5 rounded-xl text-sm font-medium text-slate-600 bg-slate-100 hover:bg-slate-200 transition-colors"}," Отмена "),o("button",{onClick:E,disabled:!w.value.trim(),class:"flex-1 px-4 py-2.5 rounded-xl text-sm font-bold text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-slate-300 disabled:cursor-not-allowed transition-colors"}," Сохранить ",8,Gt)])])])):V("",!0)]),_:1})])),(v(),J(De,{to:"body"},[B(ve,{name:"modal-fade"},{default:re(()=>[x.value?(v(),A("div",Jt,[o("div",{class:"absolute inset-0 bg-black/50",onClick:n[4]||(n[4]=c=>x.value=!1)}),o("div",Kt,[n[12]||(n[12]=o("h3",{class:"text-lg font-bold text-slate-900 mb-2"},"Удалить диалог?",-1)),n[13]||(n[13]=o("p",{class:"text-sm text-slate-500 mb-6"}," Это действие нельзя отменить. Все сообщения будут удалены. ",-1)),o("div",Xt,[o("button",{onClick:n[5]||(n[5]=c=>x.value=!1),class:"flex-1 px-4 py-2.5 rounded-xl text-sm font-medium text-slate-600 bg-slate-100 hover:bg-slate-200 transition-colors"}," Отмена "),o("button",{onClick:r,class:"flex-1 px-4 py-2.5 rounded-xl text-sm font-bold text-white bg-red-600 hover:bg-red-700 transition-colors"}," Удалить ")])])])):V("",!0)]),_:1})]))],32)}}}),Qt=Ce(Yt,[["__scopeId","data-v-1509f877"]]),Zt={class:"h-full flex flex-col"},es={class:"p-4 border-b border-slate-200"},ts={class:"w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0"},ss={class:"text-white font-bold text-sm"},ns={class:"flex-1 text-left min-w-0"},as={class:"text-sm font-semibold text-slate-900 truncate"},os={class:"text-xs text-slate-500"},ls={key:0,class:"absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-lg border border-slate-200 z-50 max-h-64 overflow-y-auto"},is={class:"p-2"},rs=["onClick"],cs={class:"w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0"},us={class:"text-white font-bold text-xs"},ds={class:"text-sm font-medium truncate"},gs={key:0,class:"px-3 py-4 text-center text-sm text-slate-500"},fs={class:"px-4 py-3"},ms={class:"relative"},vs={class:"flex-1 overflow-y-auto"},ps={key:0,class:"flex items-center justify-center py-8"},xs={key:1,class:"px-4 py-8 text-center"},ys={class:"text-sm text-slate-500"},hs=ae({__name:"DialogsSidebar",props:{agents:{},selectedAgentId:{},selectedDialogId:{},isLoading:{type:Boolean}},emits:["select-agent","select-dialog","create-dialog"],setup(e,{emit:s}){const g=e,_=s,{dialogs:h,isLoading:R,updateDialog:k,deleteDialog:T}=xe(),w=j(null),m=j(!1),x=j("");Ge(w,()=>{m.value=!1});const D=W(()=>g.agents.find(M=>M.id===g.selectedAgentId)),I=W(()=>{var M;return((M=D.value)==null?void 0:M.name)||"Выберите агента"}),p=W(()=>{var M;return i(((M=D.value)==null?void 0:M.name)||"")}),l=W(()=>{const M=g.agents.length;return M===1?"агент":M>=2&&M<=4?"агента":"агентов"}),a=W(()=>{if(!x.value.trim())return h.value;const M=x.value.toLowerCase();return h.value.filter(r=>{const t=r.title||"Диалог",n=r.last_message_preview||"";return t.toLowerCase().includes(M)||n.toLowerCase().includes(M)})}),i=M=>M?M.split(" ").map(r=>r.charAt(0)).join("").toUpperCase().slice(0,2):"?",u=M=>{m.value=!1,_("select-agent",M)},U=async(M,r)=>{g.selectedAgentId&&await k(g.selectedAgentId,M,{title:r})},E=async M=>{g.selectedAgentId&&await T(g.selectedAgentId,M)};return Q(()=>g.selectedAgentId,()=>{x.value=""}),(M,r)=>(v(),A("div",Zt,[o("div",es,[o("div",{class:"relative",ref_key:"dropdownRef",ref:w},[o("button",{onClick:r[0]||(r[0]=t=>m.value=!m.value),class:"w-full flex items-center gap-3 px-3 py-2.5 bg-slate-50 hover:bg-slate-100 rounded-xl transition-colors"},[o("div",ts,[o("span",ss,H(p.value),1)]),o("div",ns,[o("p",as,H(I.value),1),o("p",os,H(e.agents.length)+" "+H(l.value),1)]),B(O(gt),{class:q(["w-5 h-5 text-slate-400 transition-transform",{"rotate-180":m.value}])},null,8,["class"])]),B(ve,{"enter-active-class":"transition duration-150 ease-out","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition duration-100 ease-in","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:re(()=>[m.value?(v(),A("div",ls,[o("div",is,[(v(!0),A(ce,null,Ie(e.agents,t=>(v(),A("button",{key:t.id,onClick:n=>u(t.id),class:q(["w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors",[t.id===e.selectedAgentId?"bg-indigo-50 text-indigo-900":"hover:bg-slate-50 text-slate-700"]])},[o("div",cs,[o("span",us,H(i(t.name)),1)]),o("span",ds,H(t.name),1),t.id===e.selectedAgentId?(v(),J(O(Je),{key:0,class:"w-4 h-4 text-indigo-600 ml-auto flex-shrink-0"})):V("",!0)],10,rs))),128)),e.agents.length===0?(v(),A("div",gs," Нет доступных агентов ")):V("",!0)])])):V("",!0)]),_:1})],512)]),o("div",fs,[o("div",ms,[B(O(ft),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),Ee(o("input",{"onUpdate:modelValue":r[1]||(r[1]=t=>x.value=t),type:"text",placeholder:"Поиск диалогов...",class:"w-full pl-9 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"},null,512),[[je,x.value]])])]),o("div",vs,[e.isLoading||O(R)?(v(),A("div",ps,[B(O(Me),{class:"w-6 h-6 text-indigo-600 animate-spin"})])):a.value.length===0?(v(),A("div",xs,[B(O(ke),{class:"w-12 h-12 text-slate-300 mx-auto mb-3"}),o("p",ys,H(x.value?"Диалоги не найдены":"Нет диалогов"),1),!x.value&&e.selectedAgentId?(v(),A("button",{key:0,onClick:r[2]||(r[2]=t=>M.$emit("create-dialog")),class:"mt-3 text-sm text-indigo-600 hover:text-indigo-700 font-medium"}," Создать первый диалог ")):V("",!0)])):(v(),J(Fe,{key:2,tag:"div",class:"divide-y divide-slate-100",name:"dialog-list"},{default:re(()=>[(v(!0),A(ce,null,Ie(a.value,t=>(v(),J(Qt,{key:t.id,dialog:t,"is-selected":t.id===e.selectedDialogId,onClick:n=>M.$emit("select-dialog",t.id),onRename:U,onDelete:E},null,8,["dialog","is-selected","onClick"]))),128))]),_:1}))])]))}}),bs=Ce(hs,[["__scopeId","data-v-26ed367c"]]),_s={class:"bg-white border-b border-slate-200 px-4 py-3 flex items-center gap-3 flex-shrink-0"},ks={key:0,class:"w-5 h-5 text-blue-600",viewBox:"0 0 24 24",fill:"currentColor"},Ss={key:1,class:"text-white font-bold text-sm"},Ms={class:"flex-1 min-w-0"},$s={class:"text-sm font-semibold text-slate-900 truncate"},Ds={key:0,class:"text-xs text-blue-600 truncate"},Cs={class:"flex items-center gap-1.5 mt-0.5"},As={class:"text-xs text-slate-500"},Rs={class:"text-xs text-slate-500"},ws={class:"flex items-center gap-2"},Ls=["aria-checked","title"],Ts=ae({__name:"ChatHeader",props:{agent:{},dialog:{},isStreaming:{type:Boolean}},emits:["back"],setup(e){const s=e,{toggleDialogAgentStatus:g}=xe(),_=W(()=>{var m;return(((m=s.dialog)==null?void 0:m.agent_status)??"active")==="active"}),h=W(()=>{var m,x,D;return((m=s.dialog)==null?void 0:m.platform)==="telegram"||((D=(x=s.dialog)==null?void 0:x.id)==null?void 0:D.startsWith("telegram:"))}),R=W(()=>{var m,x;return((x=(m=s.dialog)==null?void 0:m.user_info)==null?void 0:x.username)||""}),k=W(()=>{var x,D;const m=(x=s.dialog)==null?void 0:x.user_info;return m!=null&&m.first_name||m!=null&&m.last_name?[m.first_name,m.last_name].filter(Boolean).join(" "):m!=null&&m.username?`@${m.username}`:h.value&&((D=s.dialog)!=null&&D.id)?`Telegram #${s.dialog.id.replace("telegram:","")}`:"Диалог"}),T=W(()=>{var x,D;const m=(x=s.dialog)==null?void 0:x.user_info;if(m!=null&&m.first_name){const I=m.first_name.charAt(0),p=((D=m.last_name)==null?void 0:D.charAt(0))||"";return(I+p).toUpperCase()}return m!=null&&m.username?m.username.charAt(0).toUpperCase():"?"}),w=()=>{var m;(m=s.dialog)!=null&&m.id&&g(s.agent.id,s.dialog.id)};return(m,x)=>(v(),A("div",_s,[o("button",{onClick:x[0]||(x[0]=D=>m.$emit("back")),class:"lg:hidden p-2 -ml-2 rounded-lg text-slate-600 hover:bg-slate-100 transition-colors"},[B(O(mt),{class:"w-5 h-5"})]),o("div",{class:q(["w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",[h.value?"bg-blue-100":"bg-gradient-to-br from-indigo-500 to-purple-600"]])},[h.value?(v(),A("svg",ks,[...x[1]||(x[1]=[o("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"},null,-1)])])):(v(),A("span",Ss,H(T.value),1))],2),o("div",Ms,[o("h2",$s,H(k.value),1),h.value&&R.value?(v(),A("p",Ds," @"+H(R.value),1)):V("",!0),o("div",Cs,[e.isStreaming&&_.value?(v(),A(ce,{key:0},[B(O(Me),{class:"w-3 h-3 text-indigo-600 animate-spin"}),x[2]||(x[2]=o("span",{class:"text-xs text-indigo-600 font-medium"},"В работе...",-1))],64)):_.value?(v(),A(ce,{key:2},[x[4]||(x[4]=o("span",{class:"w-2 h-2 bg-green-500 rounded-full"},null,-1)),o("span",Rs,H(e.agent.name),1)],64)):(v(),A(ce,{key:1},[x[3]||(x[3]=o("span",{class:"w-2 h-2 bg-slate-400 rounded-full"},null,-1)),o("span",As,H(e.agent.name)+" · Выкл.",1)],64))])]),o("div",ws,[o("button",{onClick:w,class:q(["relative w-11 h-6 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",[_.value?"bg-indigo-600":"bg-slate-300"]]),role:"switch","aria-checked":_.value,title:_.value?"Выключить агента":"Включить агента"},[o("span",{class:q(["absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform",[_.value?"translate-x-5":"translate-x-0"]])},null,2)],10,Ls)])]))}}),Is=["innerHTML"],Es=["src"],js={key:2,class:"flex items-center gap-3 min-w-[200px]"},Os={class:"flex-1"},Ns={key:3,class:"flex items-center gap-1 mt-1"},Us={class:"text-[10px] text-slate-400"},Ws={key:2,class:"flex items-center gap-1"},Bs=ae({__name:"MessageBubble",props:{message:{}},emits:["retry","image-click"],setup(e){const s=e,g=vt({linkify:!0,breaks:!0}),_=j(!1),h=j(0),R=j(null),k=W(()=>s.message.role==="agent"),T=W(()=>s.message.role==="manager"),w=W(()=>k.value||T.value),m=W(()=>T.value?"bg-emerald-600 text-white rounded-br-sm":k.value?"bg-indigo-600 text-white rounded-br-sm":"bg-white border border-slate-200 text-slate-900 rounded-bl-sm shadow-sm"),x=W(()=>s.message.type!=="text"?"":g.render(s.message.content)),D=W(()=>new Date(s.message.created_at).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})),I=W(()=>{const l=s.message.duration_seconds||0,a=Math.floor(l/60),i=l%60;return`${a}:${i.toString().padStart(2,"0")}`}),p=()=>{R.value||(R.value=new Audio(s.message.content),R.value.addEventListener("timeupdate",()=>{R.value&&(h.value=R.value.currentTime/R.value.duration*100)}),R.value.addEventListener("ended",()=>{_.value=!1,h.value=0})),_.value?R.value.pause():R.value.play(),_.value=!_.value};return(l,a)=>(v(),A("div",{class:q(["flex",[w.value?"justify-end":"justify-start"]])},[o("div",{class:q(["max-w-[85%] sm:max-w-[70%] lg:max-w-[60%]",[w.value?"order-1":"order-2"]])},[o("div",{class:q(["text-[11px] font-medium mb-1 px-1",[T.value?"text-right text-emerald-600":k.value?"text-right text-indigo-600":"text-left text-slate-500"]])},H(T.value?"Менеджер":k.value?"Агент":"Пользователь"),3),o("div",{class:q(["rounded-2xl px-4 py-2.5 relative",m.value])},[e.message.type==="text"?(v(),A("div",{key:0,class:q(["text-sm whitespace-pre-wrap break-words prose prose-sm max-w-none",[w.value?"prose-invert":""]]),innerHTML:x.value},null,10,Is)):e.message.type==="image"?(v(),A("img",{key:1,src:e.message.content,alt:"Image",class:"rounded-lg max-w-full cursor-pointer hover:opacity-90 transition-opacity",onClick:a[0]||(a[0]=i=>l.$emit("image-click",e.message.content))},null,8,Es)):e.message.type==="voice"?(v(),A("div",js,[o("button",{onClick:p,class:q(["w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 transition-colors",[w.value?"bg-white/20 hover:bg-white/30 text-white":"bg-slate-200 hover:bg-slate-300 text-slate-700"]])},[_.value?(v(),J(O(Dt),{key:0,class:"w-5 h-5"})):(v(),J(O(pt),{key:1,class:"w-5 h-5 ml-0.5"}))],2),o("div",Os,[o("div",{class:q(["h-1 rounded-full overflow-hidden",[w.value?"bg-white/30":"bg-slate-300"]])},[o("div",{class:q(["h-full transition-all",[w.value?"bg-white":"bg-slate-600"]]),style:ze({width:`${h.value}%`})},null,6)],2),o("span",{class:q(["text-xs mt-1 block",[w.value?"text-white/70":"text-slate-500"]])},H(I.value),3)])])):V("",!0),e.message.status==="streaming"?(v(),A("div",Ns,[...a[2]||(a[2]=[o("span",{class:"w-1.5 h-1.5 bg-current rounded-full animate-pulse opacity-60"},null,-1)])])):V("",!0)],2),o("div",{class:q(["flex items-center gap-2 mt-1 px-1",[w.value?"justify-end":"justify-start"]])},[o("span",Us,H(D.value),1),w.value?(v(),A(ce,{key:0},[e.message.status==="sending"?(v(),J(O(Me),{key:0,class:"w-3 h-3 text-slate-400 animate-spin"})):e.message.status==="sent"?(v(),J(O(Je),{key:1,class:"w-3 h-3 text-slate-400"})):e.message.status==="failed"?(v(),A("div",Ws,[B(O(Ke),{class:"w-3 h-3 text-red-500"}),o("button",{onClick:a[1]||(a[1]=i=>l.$emit("retry")),class:"text-[10px] text-red-500 hover:text-red-600 font-medium"}," Повторить ")])):V("",!0)],64)):V("",!0)],2)],2)],2))}}),Ps=Ce(Bs,[["__scopeId","data-v-44947884"]]),zs={class:"flex-1 flex items-center justify-center p-8"},Fs={class:"text-center max-w-sm"},qs={class:"w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6"},Hs={class:"text-lg font-semibold text-slate-900 mb-2"},Vs={class:"text-sm text-slate-500 mb-6"},Ye=ae({__name:"DialogsEmptyState",props:{type:{default:"no-dialog"},errorMessage:{}},emits:["create","retry"],setup(e){const s=e,g=W(()=>{switch(s.type){case"no-agent":return{icon:ke,title:"Выберите агента",description:"Выберите агента из списка слева, чтобы начать диалог.",showAction:!1,actionLabel:""};case"no-dialog":return{icon:yt,title:"Выберите диалог",description:"Выберите существующий диалог или создайте новый, чтобы начать общение с агентом.",showAction:!0,actionLabel:"Новый диалог"};case"no-messages":return{icon:ke,title:"Начните диалог",description:"Напишите сообщение, чтобы начать общение с агентом.",showAction:!1,actionLabel:""};case"error":return{icon:Ke,title:"Ошибка загрузки",description:s.errorMessage||"Не удалось загрузить данные. Попробуйте обновить страницу.",showAction:!0,actionLabel:"Повторить"};default:return{icon:ke,title:"Нет данных",description:"Данные отсутствуют.",showAction:!1,actionLabel:""}}}),_=W(()=>g.value.icon),h=W(()=>g.value.title),R=W(()=>g.value.description),k=W(()=>g.value.showAction),T=W(()=>g.value.actionLabel);return(w,m)=>(v(),A("div",zs,[o("div",Fs,[o("div",qs,[(v(),J(st(_.value),{class:"w-10 h-10 text-slate-400"}))]),o("h3",Hs,H(h.value),1),o("p",Vs,H(R.value),1),k.value?(v(),A("button",{key:0,onClick:m[0]||(m[0]=x=>w.$emit("create")),class:"inline-flex items-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-sm font-semibold transition-colors"},[B(O(xt),{class:"w-4 h-4"}),me(" "+H(T.value),1)])):V("",!0)])]))}}),Gs={key:0,class:"flex justify-center py-3"},Js={key:1,class:"flex justify-center py-3"},Ks={key:2,class:"h-full flex items-center justify-center"},Xs={key:4,class:"flex items-center gap-2 py-2 px-3 text-slate-500"},Ys=["src"],Qs=ae({__name:"MessagesFeed",props:{dialogId:{},messages:{},isLoading:{type:Boolean},isStreaming:{type:Boolean},hasMore:{type:Boolean}},emits:["load-more","retry"],setup(e){const s=e,g=j(null),_=j(!1),h=j(!0),R=j(null),k=j(!1),T=()=>{if(!g.value)return;const{scrollTop:p,scrollHeight:l,clientHeight:a}=g.value,i=l-p-a;h.value=i<100,h.value&&(_.value=!1)},w=(p=!0)=>{g.value&&(g.value.scrollTo({top:g.value.scrollHeight,behavior:p?"smooth":"auto"}),_.value=!1)},m=()=>{w(!0)};Q(()=>s.messages.length,(p,l)=>{if(p>l){!k.value&&l>0&&(k.value=!0);const a=s.messages[s.messages.length-1];h.value||(a==null?void 0:a.role)==="user"||(a==null?void 0:a.role)==="manager"?pe(()=>w(!1)):(a==null?void 0:a.role)==="agent"&&(_.value=!0)}}),Q(()=>s.dialogId,()=>{k.value=!1}),Q(()=>s.isStreaming,p=>{p&&h.value&&pe(()=>w(!1))});const x=p=>{R.value=p,document.body.style.overflow="hidden"},D=()=>{R.value=null,document.body.style.overflow=""},I=p=>{p.key==="Escape"&&R.value&&D()};return qe(()=>{window.addEventListener("keydown",I),pe(()=>w(!1))}),Pe(()=>{window.removeEventListener("keydown",I),document.body.style.overflow=""}),(p,l)=>(v(),A("div",{ref_key:"scrollContainerRef",ref:g,class:"flex-1 overflow-y-auto px-4 py-4",onScroll:T},[e.hasMore&&!e.isLoading?(v(),A("div",Gs,[o("button",{onClick:l[0]||(l[0]=a=>p.$emit("load-more")),class:"text-sm text-indigo-600 hover:text-indigo-700 font-medium"}," Загрузить ранние сообщения ")])):V("",!0),e.isLoading&&e.messages.length>0?(v(),A("div",Js,[B(O(Me),{class:"w-5 h-5 text-indigo-600 animate-spin"})])):V("",!0),!e.isLoading&&e.messages.length===0?(v(),A("div",Ks,[B(Ye,{type:"no-messages"})])):(v(),J(Fe,{key:3,tag:"div",class:"space-y-4",name:k.value?"msg":"",css:k.value},{default:re(()=>[(v(!0),A(ce,null,Ie(e.messages,a=>(v(),J(Ps,{key:a.id,message:a,onRetry:i=>p.$emit("retry",a.id),onImageClick:x},null,8,["message","onRetry"]))),128))]),_:1},8,["name","css"])),e.isStreaming?(v(),A("div",Xs,[...l[2]||(l[2]=[nt('<div class="flex gap-1" data-v-50b57f6b><span class="w-2 h-2 bg-indigo-400 rounded-full animate-bounce" style="animation-delay:0ms;" data-v-50b57f6b></span><span class="w-2 h-2 bg-indigo-400 rounded-full animate-bounce" style="animation-delay:150ms;" data-v-50b57f6b></span><span class="w-2 h-2 bg-indigo-400 rounded-full animate-bounce" style="animation-delay:300ms;" data-v-50b57f6b></span></div><span class="text-xs" data-v-50b57f6b>Агент печатает...</span>',2)])])):V("",!0),B(ve,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"opacity-0 translate-y-4","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition duration-150 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-4"},{default:re(()=>[_.value?(v(),A("button",{key:0,onClick:m,class:"fixed bottom-24 left-1/2 -translate-x-1/2 lg:left-auto lg:translate-x-0 lg:right-8 px-4 py-2 bg-indigo-600 text-white rounded-full text-sm font-medium shadow-lg hover:bg-indigo-700 transition-colors flex items-center gap-2 z-10"},[B(O(kt),{class:"w-4 h-4"}),l[3]||(l[3]=me(" Новые сообщения ",-1))])):V("",!0)]),_:1}),(v(),J(De,{to:"body"},[B(ve,{name:"lightbox-fade"},{default:re(()=>[R.value?(v(),A("div",{key:0,class:"fixed inset-0 z-[200] bg-black/90 flex items-center justify-center p-4",onClick:D},[o("button",{onClick:D,class:"absolute top-4 right-4 p-2 text-white/80 hover:text-white transition-colors"},[B(O(at),{class:"w-6 h-6"})]),o("img",{src:R.value,class:"max-w-full max-h-full object-contain",onClick:l[1]||(l[1]=Te(()=>{},["stop"]))},null,8,Ys)])):V("",!0)]),_:1})]))],544))}}),Zs=Ce(Qs,[["__scopeId","data-v-50b57f6b"]]),en={class:"bg-white border-t border-slate-200 px-4 py-3 flex-shrink-0"},tn={key:0,class:"mb-3 px-3 py-2 bg-emerald-50 border border-emerald-200 rounded-lg flex items-center gap-2"},sn={class:"flex items-end gap-2"},nn=["disabled"],an={class:"flex-1 relative"},on=["disabled"],ln={disabled:!0,class:"p-2.5 rounded-xl text-slate-400 cursor-not-allowed transition-colors flex-shrink-0",title:"Голосовое сообщение (скоро)"},rn=["disabled"],cn={key:1,class:"mt-1 text-right"},un=ae({__name:"MessageComposer",props:{isSending:{type:Boolean},isStreaming:{type:Boolean},agentEnabled:{type:Boolean}},emits:["send","attach-image"],setup(e,{emit:s}){const g=e,_=s,h=j(null),R=j(null),k=j(""),T=W(()=>k.value.trim().length>0&&k.value.length<=4e3&&!g.isSending&&!g.isStreaming),w=()=>{T.value&&(_("send",k.value.trim()),k.value="",pe(()=>{var p;x(),(p=h.value)==null||p.focus()}))},m=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),w())},x=()=>{h.value&&(h.value.style.height="auto",h.value.style.height=`${Math.min(h.value.scrollHeight,150)}px`)},D=()=>{var p;(p=R.value)==null||p.click()},I=p=>{var i;const l=p.target,a=(i=l.files)==null?void 0:i[0];a&&_("attach-image",a),l.value=""};return Q(k,p=>{p||pe(x)}),(p,l)=>(v(),A("div",en,[e.agentEnabled?V("",!0):(v(),A("div",tn,[B(O(ht),{class:"w-4 h-4 text-emerald-600 flex-shrink-0"}),l[1]||(l[1]=o("span",{class:"text-xs text-emerald-700"}," Режим менеджера. Сообщения будут отправлены от вашего имени. ",-1))])),o("div",sn,[o("button",{onClick:D,disabled:e.isSending||e.isStreaming,class:"p-2.5 rounded-xl text-slate-500 hover:text-slate-700 hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex-shrink-0",title:"Прикрепить изображение"},[B(O(St),{class:"w-5 h-5"})],8,nn),o("input",{ref_key:"fileInputRef",ref:R,type:"file",accept:"image/*",class:"hidden",onChange:I},null,544),o("div",an,[Ee(o("textarea",{ref_key:"textareaRef",ref:h,"onUpdate:modelValue":l[0]||(l[0]=a=>k.value=a),onKeydown:m,onInput:x,disabled:e.isSending||e.isStreaming,placeholder:"Напишите сообщение...",rows:"1",class:"w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm resize-none placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed transition-all",style:{maxHeight:"150px"}},null,40,on),[[je,k.value]])]),o("button",ln,[B(O(Mt),{class:"w-5 h-5"})]),o("button",{onClick:w,disabled:!T.value,class:"p-2.5 rounded-xl bg-indigo-600 text-white hover:bg-indigo-700 disabled:bg-slate-300 disabled:cursor-not-allowed transition-colors flex-shrink-0",title:"Отправить"},[e.isSending?(v(),J(O(Me),{key:0,class:"w-5 h-5 animate-spin"})):(v(),J(O(bt),{key:1,class:"w-5 h-5"}))],8,rn)]),k.value.length>500?(v(),A("div",cn,[o("span",{class:q(["text-xs",k.value.length>4e3?"text-red-500":"text-slate-400"])},H(k.value.length)+" / 4000 ",3)])):V("",!0)]))}}),dn={class:"flex-1 flex flex-col h-full overflow-hidden"},gn={key:0,class:"px-4 py-2 bg-red-50 border-b border-red-200 text-red-700 text-sm flex items-center gap-2"},fn=ae({__name:"ChatArea",props:{dialogId:{},agent:{},wsSendMessage:{type:Function},isWsConnected:{type:Boolean}},emits:["back"],setup(e){const s=e,{messagesMap:g,fetchMessages:_,sendMessage:h,sendManagerMessage:R,retryMessage:k,createOptimisticMessage:T,markMessageFailed:w,isLoading:m,isSending:x,isStreaming:D,error:I,dialogHasMore:p}=Xe(),{markAsRead:l,getDialogById:a}=xe(),i=W(()=>g[s.dialogId]??[]),u=W(()=>a(s.dialogId)),U=W(()=>p(s.dialogId)),E=W(()=>{var c;return(((c=u.value)==null?void 0:c.agent_status)??"active")==="active"}),M=async()=>{console.log("[ChatArea] loadMessages for dialog:",s.dialogId,"agent:",s.agent.id),await _(s.agent.id,s.dialogId,{limit:50}),console.log("[ChatArea] Messages loaded, count:",i.value.length,"error:",I.value),l(s.dialogId)},r=async()=>{const c=i.value[0];c&&await _(s.agent.id,s.dialogId,{before:c.id,limit:30})},t=async c=>{if(!E.value){await R(s.agent.id,s.dialogId,c);return}if(s.isWsConnected&&s.wsSendMessage){const d=T(s.dialogId,c,"text");s.wsSendMessage(s.dialogId,c)||w(s.dialogId,d,"WebSocket отключен")}else await h(s.agent.id,s.dialogId,c,"text",E.value)},n=async c=>{},y=async c=>{await k(s.agent.id,s.dialogId,c,E.value)};return Q(()=>s.dialogId,()=>M(),{immediate:!0}),(c,d)=>(v(),A("div",dn,[B(Ts,{agent:e.agent,dialog:u.value,"is-streaming":O(D),onBack:d[0]||(d[0]=b=>c.$emit("back"))},null,8,["agent","dialog","is-streaming"]),O(I)?(v(),A("div",gn,[d[1]||(d[1]=o("span",{class:"font-medium"},"Ошибка загрузки:",-1)),o("span",null,H(O(I)),1),o("button",{onClick:M,class:"ml-auto text-red-600 hover:text-red-800 underline text-xs"}," Повторить ")])):V("",!0),B(Zs,{"dialog-id":e.dialogId,messages:i.value,"is-loading":O(m),"is-streaming":O(D),"has-more":U.value,onLoadMore:r,onRetry:y},null,8,["dialog-id","messages","is-loading","is-streaming","has-more"]),B(un,{"is-sending":O(x),"is-streaming":O(D),"agent-enabled":E.value,onSend:t,onAttachImage:n},null,8,["is-sending","is-streaming","agent-enabled"])]))}}),Bn=ae({__name:"dialogs",setup(e){const{pageTitle:s,isCollapsed:g}=Qe(),{isAuthenticated:_}=rt(),h=j(!1),R=ot(),k=lt(),{agents:T,isLoading:w,fetchAgents:m}=it(),{fetchDialogs:x,createDialog:D}=xe(),I=j(R.query.agentId||null),p=j(R.query.dialogId||null),l=j(!p.value),a=j(null),{isConnected:i,sendMessage:u,joinDialog:U,leaveDialog:E}=Et(W(()=>I.value)),M=W(()=>{if(I.value)return T.value.find(d=>d.id===I.value)}),r=async d=>{I.value=d,p.value=null,k.push({query:{...R.query,agentId:d,dialogId:void 0}}),await x(d)},t=d=>{p.value=d,l.value=!1,k.push({query:{...R.query,dialogId:d}})};Q(()=>R.query.agentId,d=>{I.value=typeof d=="string"?d:null}),Q(()=>R.query.dialogId,d=>{p.value=typeof d=="string"?d:null,p.value&&(l.value=!1)}),Q([i,p],([d,b])=>{if(!d){a.value=null;return}a.value&&a.value!==b&&(E(a.value),a.value=null),b&&a.value!==b&&(U(b)?a.value=b:console.warn("[Page] Failed to join dialog (WebSocket not ready):",b))},{immediate:!0});const n=async()=>{if(!I.value){T.value.length>0&&await r(T.value[0].id);return}const d=await D(I.value);d&&t(d.id)},y=()=>{h.value=!1,c()},c=async()=>{await m(),I.value?await x(I.value):T.value.length>0&&await r(T.value[0].id)};return Q(_,d=>{d&&c()}),qe(()=>{s.value="Диалоги",_.value?c():h.value=!0}),(d,b)=>(v(),A("div",{class:q(["fixed inset-0 top-[60px] flex overflow-hidden bg-muted transition-all duration-300",[O(g)?"lg:left-16":"lg:left-64"]])},[o("div",{class:q(["w-full lg:w-80 xl:w-96 flex-shrink-0 border-r border-border bg-background",!l.value&&p.value?"hidden lg:flex lg:flex-col":"flex flex-col"])},[B(bs,{agents:O(T),"selected-agent-id":I.value,"selected-dialog-id":p.value,"is-loading":O(w),onSelectAgent:r,onSelectDialog:t,onCreateDialog:n},null,8,["agents","selected-agent-id","selected-dialog-id","is-loading"])],2),o("div",{class:q(["flex-1 flex flex-col bg-muted",l.value&&p.value?"hidden lg:flex":"flex"])},[p.value&&M.value?(v(),J(fn,{key:p.value,"dialog-id":p.value,agent:M.value,"ws-send-message":O(u),"is-ws-connected":O(i),onBack:b[0]||(b[0]=C=>l.value=!0)},null,8,["dialog-id","agent","ws-send-message","is-ws-connected"])):(v(),J(Ye,{key:1,type:"no-dialog",onCreate:n}))],2),B(_t,{"is-open":h.value,onClose:b[1]||(b[1]=C=>h.value=!1),onAuthenticated:y},null,8,["is-open"])],2))}});export{Bn as default};
