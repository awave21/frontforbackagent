import{_ as P}from"./nuxt-link.BLS_a--H.js";import{m as U,B as q,c as d,a as s,b as w,u as r,t as p,w as D,s as F,v as _,bM as N,A as T,n as f,p as g,x as R,d as V,L as z,k as i,N as J,c0 as $,o as l,z as G}from"./entry.CVvpXMAV.js";import{u as H,a as K}from"./useAuth.Bu6P1IiJ.js";import{A as Q}from"./alert-circle.DxAvbiuF.js";import{C as W}from"./check-circle.DrbZcjcA.js";import{L as j}from"./loader-2.CJ85gz1d.js";import{a as A,E as L}from"./eye.CUTpVi36.js";const X={class:"min-h-screen flex items-center justify-center bg-slate-50 px-4 py-12"},Y={class:"max-w-md w-full"},Z={key:0,class:"bg-white rounded-xl shadow-lg border border-red-200 p-8 text-center"},ee={class:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"},te={class:"text-slate-600 mb-6"},se={key:1,class:"bg-white rounded-xl shadow-lg border border-green-200 p-8 text-center"},oe={class:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"},ae={key:2,class:"bg-white rounded-xl shadow-lg border border-slate-200 p-8"},le={class:"relative"},ne=["type"],re={key:0,class:"mt-1 text-sm text-red-600"},ie={class:"relative"},de=["type"],ue={key:0,class:"mt-1 text-sm text-red-600"},ce={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-3"},me={class:"text-sm text-red-800"},pe=["disabled"],_e=U({__name:"accept",setup(fe){const B=J(),E=$(),k=H(),{login:M}=K(),C=G(),v=z(()=>B.query.token),a=i({password:"",passwordConfirmation:"",full_name:""}),u=i(!1),c=i(null),m=i(null),S=i(!1),x=i(!1),b=i(!1),n=i({}),O=()=>(n.value={},a.value.password.length<8?(n.value.password="Пароль должен содержать минимум 8 символов",!1):a.value.password!==a.value.passwordConfirmation?(n.value.passwordConfirmation="Пароли не совпадают",!1):!0),I=async()=>{var h,e;if(!v.value){m.value="Отсутствует токен приглашения";return}if(O()){u.value=!0,c.value=null;try{let t;try{t=await k("/invitations/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:{token:v.value,password:a.value.password,full_name:a.value.full_name||void 0}})}catch(o){if((o==null?void 0:o.status)===404||(o==null?void 0:o.statusCode)===404)t=await k("/auth/register-by-invite",{method:"POST",headers:{"Content-Type":"application/json"},body:{token:v.value,password:a.value.password,full_name:a.value.full_name||void 0}});else throw o}if(t.token)localStorage.setItem("auth_token",t.token),t.refresh_token&&localStorage.setItem("auth_refresh_token",t.refresh_token),t.user&&localStorage.setItem("auth_user",JSON.stringify(t.user)),t.tenant&&localStorage.setItem("auth_tenant",JSON.stringify(t.tenant)),await M({email:((h=t.user)==null?void 0:h.email)||"",password:a.value.password}).catch(()=>{}),S.value=!0,C.success("Добро пожаловать!","Вы успешно присоединились к организации"),setTimeout(()=>{E.push("/dashboard")},2e3);else throw new Error("Не получен токен авторизации")}catch(t){const o=(t==null?void 0:t.apiError)||t,y=(t==null?void 0:t.status)||(t==null?void 0:t.statusCode)||((e=t==null?void 0:t.response)==null?void 0:e.status);y===400||y===404||y===410?m.value=(o==null?void 0:o.message)||"Ссылка приглашения недействительна или истекла":(c.value=(o==null?void 0:o.message)||"Не удалось завершить регистрацию",C.error("Ошибка",c.value))}finally{u.value=!1}}};return q(()=>{v.value||(m.value="Отсутствует токен приглашения в URL")}),(h,e)=>{const t=P;return l(),d("div",X,[s("div",Y,[m.value?(l(),d("div",Z,[s("div",ee,[w(r(Q),{class:"h-8 w-8 text-red-600"})]),e[6]||(e[6]=s("h1",{class:"text-2xl font-bold text-slate-900 mb-2"}," Недействительная ссылка ",-1)),s("p",te,p(m.value),1),w(t,{to:"/",class:"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"},{default:D(()=>[...e[5]||(e[5]=[V(" Вернуться на главную ",-1)])]),_:1})])):S.value?(l(),d("div",se,[s("div",oe,[w(r(W),{class:"h-8 w-8 text-green-600"})]),e[7]||(e[7]=s("h1",{class:"text-2xl font-bold text-slate-900 mb-2"}," Добро пожаловать! ",-1)),e[8]||(e[8]=s("p",{class:"text-slate-600 mb-6"}," Вы успешно присоединились к организации. Перенаправление... ",-1)),w(r(j),{class:"h-6 w-6 text-indigo-600 animate-spin mx-auto"})])):(l(),d("div",ae,[e[12]||(e[12]=s("div",{class:"text-center mb-8"},[s("h1",{class:"text-2xl font-bold text-slate-900 mb-2"}," Присоединиться к организации "),s("p",{class:"text-slate-600"}," Завершите регистрацию, чтобы получить доступ ")],-1)),s("form",{onSubmit:F(I,["prevent"]),class:"space-y-4"},[s("div",null,[e[9]||(e[9]=s("label",{class:"block text-sm font-medium text-slate-700 mb-2"}," Пароль ",-1)),s("div",le,[_(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.password=o),type:x.value?"text":"password",required:"",minlength:"8",maxlength:"128",class:T(["w-full px-3 py-2 pr-10 text-slate-900 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",n.value.password?"border-red-500":"border-slate-300"]),placeholder:"Минимум 8 символов"},null,10,ne),[[N,a.value.password]]),s("button",{type:"button",onClick:e[1]||(e[1]=o=>x.value=!x.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center"},[x.value?(l(),f(r(A),{key:0,class:"h-4 w-4 text-slate-400"})):(l(),f(r(L),{key:1,class:"h-4 w-4 text-slate-400"}))])]),n.value.password?(l(),d("p",re,p(n.value.password),1)):g("",!0)]),s("div",null,[e[10]||(e[10]=s("label",{class:"block text-sm font-medium text-slate-700 mb-2"}," Подтверждение пароля ",-1)),s("div",ie,[_(s("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.passwordConfirmation=o),type:b.value?"text":"password",required:"",minlength:"8",maxlength:"128",class:T(["w-full px-3 py-2 pr-10 text-slate-900 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",n.value.passwordConfirmation?"border-red-500":"border-slate-300"]),placeholder:"Повторите пароль"},null,10,de),[[N,a.value.passwordConfirmation]]),s("button",{type:"button",onClick:e[3]||(e[3]=o=>b.value=!b.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center"},[b.value?(l(),f(r(A),{key:0,class:"h-4 w-4 text-slate-400"})):(l(),f(r(L),{key:1,class:"h-4 w-4 text-slate-400"}))])]),n.value.passwordConfirmation?(l(),d("p",ue,p(n.value.passwordConfirmation),1)):g("",!0)]),s("div",null,[e[11]||(e[11]=s("label",{class:"block text-sm font-medium text-slate-700 mb-2"}," Имя (необязательно) ",-1)),_(s("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.full_name=o),type:"text",maxlength:"255",class:"w-full px-3 py-2 text-slate-900 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Ваше имя"},null,512),[[R,a.value.full_name]])]),c.value?(l(),d("div",ce,[s("p",me,p(c.value),1)])):g("",!0),s("button",{type:"submit",disabled:u.value,class:"w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"},[u.value?(l(),f(r(j),{key:0,class:"h-4 w-4 animate-spin"})):g("",!0),V(" "+p(u.value?"Регистрация...":"Присоединиться"),1)],8,pe)],32)]))])])}}});export{_e as default};
